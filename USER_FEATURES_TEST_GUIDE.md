# ç”¨æˆ·åŠŸèƒ½æµ‹è¯•æŒ‡å—

## é—®é¢˜ä¿®å¤

### 1. åå¥½æ ‡ç­¾ä¿å­˜å¤±è´¥ä¿®å¤

**é—®é¢˜**: `preference_type` å­—æ®µæ•°æ®è¢«æˆªæ–­
**åŸå› **: æ•°æ®åº“å­—æ®µæ˜¯ ENUM ç±»å‹ï¼Œä¸æ”¯æŒ 'hiking_preference' å€¼
**ä¿®å¤**: å°†å­—æ®µæ”¹ä¸º VARCHAR(50)

**æ‰§è¡Œä¿®å¤**:

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
fix-preferences.bat
```

ä¿®å¤åï¼Œåå¥½æ ‡ç­¾å°†æ­£å¸¸ä¿å­˜ã€‚

---

## åŠŸèƒ½æµ‹è¯•æ¸…å•

### âœ… 1. åå¥½æ ‡ç­¾åŠŸèƒ½

#### æµ‹è¯•æ­¥éª¤ï¼š

1. è®¿é—® http://localhost:5173/edit-profile
2. åœ¨"å¾’æ­¥åå¥½"åŒºåŸŸæ·»åŠ æ ‡ç­¾ï¼š
   - ç‚¹å‡»æ¨èæ ‡ç­¾ï¼ˆå¦‚"å‘¨æœ«å‡ºå‘"ï¼‰
   - æˆ–è‡ªå®šä¹‰è¾“å…¥æ ‡ç­¾
3. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
4. è¿”å›ä¸ªäººä¸»é¡µ http://localhost:5173/profile
5. éªŒè¯"æˆ‘çš„å¾’æ­¥åå¥½"åŒºåŸŸæ˜¾ç¤ºå·²ä¿å­˜çš„æ ‡ç­¾

#### é¢„æœŸç»“æœï¼š

- âœ… æ ‡ç­¾æˆåŠŸä¿å­˜
- âœ… ä¸ªäººä¸»é¡µæ­£ç¡®æ˜¾ç¤ºæ ‡ç­¾
- âœ… å†æ¬¡ç¼–è¾‘æ—¶èƒ½åŠ è½½å·²æœ‰æ ‡ç­¾

---

### ğŸš§ 2. å¤´åƒä¸Šä¼ åŠŸèƒ½

#### å½“å‰çŠ¶æ€ï¼š

- âœ… å‰ç«¯ UI å®Œæˆï¼ˆç‚¹å‡»å¤´åƒè§¦å‘é€‰æ‹©ï¼‰
- âœ… å‰ç«¯é¢„è§ˆåŠŸèƒ½å®Œæˆï¼ˆé€‰æ‹©åç«‹å³é¢„è§ˆï¼‰
- âš ï¸ åç«¯æ¥å£å­˜åœ¨ä½†æœªå®Œå…¨é›†æˆ
- âŒ å®é™…ä¸Šä¼ åˆ°æœåŠ¡å™¨åŠŸèƒ½å¾…å®Œå–„

#### æµ‹è¯•æ­¥éª¤ï¼š

1. è®¿é—® http://localhost:5173/edit-profile
2. ç‚¹å‡»å¤´åƒåŒºåŸŸ
3. é€‰æ‹©å›¾ç‰‡ï¼ˆæ”¯æŒæ‹ç…§æˆ–ä»ç›¸å†Œé€‰æ‹©ï¼‰
4. æŸ¥çœ‹é¢„è§ˆæ•ˆæœ
5. ç‚¹å‡»"ä¿å­˜"

#### å½“å‰è¡Œä¸ºï¼š

- å›¾ç‰‡ä¼šåœ¨ç¼–è¾‘é¡µé¢é¢„è§ˆ
- ä¿å­˜æ—¶ä¼šå°† URL ä¿å­˜åˆ° `avatar_url` å­—æ®µ
- ä½†å›¾ç‰‡æ˜¯ base64 æ ¼å¼ï¼Œè¾ƒå¤§ï¼Œå®é™…åº”ä¸Šä¼ åˆ°æœåŠ¡å™¨è·å– URL

#### éœ€è¦å®Œå–„ï¼š

```javascript
// EditProfile.vue ä¸­éœ€è¦æ·»åŠ å®é™…ä¸Šä¼ é€»è¾‘
const uploadAvatar = async () => {
  // 1. é€‰æ‹©æ–‡ä»¶
  // 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨ POST /api/v1/users/avatar
  // 3. è·å–è¿”å›çš„ URL
  // 4. æ›´æ–° formData.avatar_url
}
```

---

### ğŸš§ 3. ç”Ÿæ´»ç›¸å†ŒåŠŸèƒ½

#### å½“å‰çŠ¶æ€ï¼š

- âœ… åç«¯æ¥å£å®Œæ•´ï¼š
  - POST /api/v1/users/photos - æ·»åŠ ç…§ç‰‡
  - DELETE /api/v1/users/photos/:photoId - åˆ é™¤ç…§ç‰‡
  - GET /api/v1/users/profile - è·å–ç›¸å†Œï¼ˆåŒ…å«åœ¨ç”¨æˆ·èµ„æ–™ä¸­ï¼‰
- âœ… å‰ç«¯æ˜¾ç¤ºé€»è¾‘å®Œæˆ
- âš ï¸ å‰ç«¯ä¸Šä¼ åŠŸèƒ½éƒ¨åˆ†å®ç°
- âŒ åˆ é™¤åŠŸèƒ½æœªå®ç°

#### æµ‹è¯•æ­¥éª¤ï¼š

1. è®¿é—® http://localhost:5173/profile
2. ç‚¹å‡»"æ·»åŠ ç…§ç‰‡"æŒ‰é’®
3. é€‰æ‹©ä¸€å¼ æˆ–å¤šå¼ å›¾ç‰‡
4. éªŒè¯ç…§ç‰‡æ˜¯å¦æ˜¾ç¤ºåœ¨ç›¸å†Œä¸­

#### å½“å‰è¡Œä¸ºï¼š

- ç‚¹å‡»"æ·»åŠ ç…§ç‰‡"å¯ä»¥é€‰æ‹©æ–‡ä»¶
- ä½†å®é™…ä¸Šä¼ é€»è¾‘è¢«æ³¨é‡Šäº†ï¼ˆTODO æ ‡è®°ï¼‰
- éœ€è¦å®ç°å®é™…çš„æ–‡ä»¶ä¸Šä¼ 

#### éœ€è¦å®Œå–„ï¼š

```javascript
// Profile.vue ä¸­éœ€è¦å–æ¶ˆæ³¨é‡Šå¹¶å®Œå–„ä¸Šä¼ é€»è¾‘
const addPhoto = async () => {
  // 1. é€‰æ‹©æ–‡ä»¶ï¼ˆå·²å®ç°ï¼‰
  // 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨ POST /api/v1/users/photosï¼ˆéœ€è¦å®ç°ï¼‰
  // 3. åˆ·æ–°ç”¨æˆ·èµ„æ–™æ˜¾ç¤ºæ–°ç…§ç‰‡ï¼ˆéœ€è¦å®ç°ï¼‰
}
```

---

## API ç«¯ç‚¹è¯´æ˜

### ç”¨æˆ·èµ„æ–™ç›¸å…³

**è·å–ç”¨æˆ·èµ„æ–™**:

```
GET /api/v1/users/profile
Authorization: Bearer <token>

Response: {
  code: 200,
  data: {
    id: "user-011",
    nickname: "é™ˆæ¾æŸ",
    avatar_url: "...",
    preferences: [
      { id: "pref-001", preference_type: "hiking_preference", preference_value: "å‘¨æœ«å‡ºå‘" }
    ],
    photos: [
      { id: "photo-001", photo_url: "..." }
    ]
  }
}
```

**æ›´æ–°ç”¨æˆ·èµ„æ–™**:

```
PUT /api/v1/users/profile
Authorization: Bearer <token>
Content-Type: application/json

Body: {
  "nickname": "æ–°æ˜µç§°",
  "gender": "female",
  "age": 25,
  "bio": "ä¸ªäººç®€ä»‹",
  "avatar_url": "https://..."
}
```

**æ›´æ–°ç”¨æˆ·åå¥½**:

```
PUT /api/v1/users/preferences
Authorization: Bearer <token>
Content-Type: application/json

Body: {
  "preferences": [
    { "type": "hiking_preference", "value": "å‘¨æœ«å‡ºå‘" },
    { "type": "hiking_preference", "value": "5-10km" }
  ]
}
```

**æ›´æ–°å¤´åƒ**:

```
POST /api/v1/users/avatar
Authorization: Bearer <token>
Content-Type: multipart/form-data

Body: FormData with 'avatar' field containing image file
```

**æ·»åŠ ç…§ç‰‡**:

```
POST /api/v1/users/photos
Authorization: Bearer <token>
Content-Type: multipart/form-data

Body: FormData with 'photo' field containing image file
```

**åˆ é™¤ç…§ç‰‡**:

```
DELETE /api/v1/users/photos/:photoId
Authorization: Bearer <token>
```

---

## å¾…å®Œå–„åŠŸèƒ½ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ ğŸ”´

1. **å®Œå–„å¤´åƒä¸Šä¼ åŠŸèƒ½**

   - å®ç°çœŸå®æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨
   - å¤„ç†ä¸Šä¼ è¿›åº¦æç¤º
   - é”™è¯¯å¤„ç†

2. **å®Œå–„ç›¸å†Œä¸Šä¼ åŠŸèƒ½**
   - å®ç°çœŸå®æ–‡ä»¶ä¸Šä¼ 
   - å®ç°ç…§ç‰‡åˆ é™¤åŠŸèƒ½
   - å®ç°ç…§ç‰‡æ’åºåŠŸèƒ½

### ä¸­ä¼˜å…ˆçº§ ğŸŸ¡

3. **å›¾ç‰‡å‹ç¼©å’Œä¼˜åŒ–**

   - ä¸Šä¼ å‰å‹ç¼©å›¾ç‰‡
   - ç”Ÿæˆç¼©ç•¥å›¾
   - é™åˆ¶æ–‡ä»¶å¤§å°

4. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - æ·»åŠ ä¸Šä¼ è¿›åº¦æ¡
   - æ·»åŠ å›¾ç‰‡é¢„è§ˆ
   - æ·»åŠ åŠ è½½çŠ¶æ€

### ä½ä¼˜å…ˆçº§ ğŸŸ¢

5. **ç›¸å†Œç®¡ç†**
   - æ‰¹é‡åˆ é™¤
   - ç…§ç‰‡ç¼–è¾‘ï¼ˆè£å‰ªã€æ»¤é•œï¼‰
   - ç…§ç‰‡åˆ†äº«

---

## æµ‹è¯•æ•°æ®

### æµ‹è¯•ç”¨æˆ·

- Email: user1@test.com
- Password: password123
- User ID: user-011

### åå¥½æ ‡ç­¾ç¤ºä¾‹

- å‘¨æœ«å‡ºå‘
- é«˜æµ·æ‹”
- 5-10km
- æ‘„å½±çˆ±å¥½è€…
- éœ²è¥

---

## å¸¸è§é—®é¢˜

### Q: åå¥½æ ‡ç­¾ä¿å­˜å¤±è´¥ï¼Ÿ

A: ç¡®ä¿å·²æ‰§è¡Œæ•°æ®åº“ä¿®å¤è„šæœ¬ `fix-preferences.bat`

### Q: å¤´åƒæ˜¾ç¤ºä¸å‡ºæ¥ï¼Ÿ

A: å½“å‰ä½¿ç”¨ base64 é¢„è§ˆï¼Œå®é™…éœ€è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨è·å– URL

### Q: ç›¸å†Œç…§ç‰‡æ˜¾ç¤ºä¸å‡ºæ¥ï¼Ÿ

A: æ£€æŸ¥åç«¯æ˜¯å¦æ­£ç¡®è¿”å› photos æ•°ç»„ï¼ŒURL æ˜¯å¦æœ‰æ•ˆ

### Q: å¦‚ä½•æµ‹è¯•æ–‡ä»¶ä¸Šä¼ ï¼Ÿ

A: éœ€è¦å…ˆå®Œå–„ä¸Šä¼ é€»è¾‘ï¼Œå°†æ³¨é‡Šçš„ TODO éƒ¨åˆ†å®ç°
