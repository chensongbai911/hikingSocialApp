# 📱 iOS 手机安装和使用指南

## 🎯 概述

这个徒步社交应用已转换为 **PWA（渐进式 Web 应用）**，可以在 iOS Safari 浏览器中像原生应用一样运行，无需通过 App Store 安装。

---

## 📋 系统要求

- **iOS 版本**: iOS 11.3 或更高版本
- **浏览器**: Safari（必须）
- **网络**: 需要联网访问后端 API

---

## 🚀 快速开始

### 第一步：启动后端服务器

在您的 Windows 电脑上：

```powershell
# 1. 进入后端目录
cd d:\coze\backend

# 2. 启动服务器
npm start
```

确保看到：

```
🚀 徒步社交后端服务启动成功
📡 API 服务: http://localhost:3000/api/v1
```

### 第二步：启动前端开发服务器

打开新的 PowerShell 窗口：

```powershell
# 1. 进入前端目录
cd d:\coze\frontend

# 2. 启动开发服务器
npm run dev
```

确保看到：

```
VITE ready in XXX ms
➜  Local:   http://localhost:5173/
➜  Network: http://192.168.X.X:5173/
```

**重要**: 记住 `Network` 那一行的 IP 地址（如 `192.168.1.100:5173`）

### 第三步：在 iPhone 上访问应用

1. **确保 iPhone 和 Windows 电脑在同一个 WiFi 网络**

2. **打开 Safari 浏览器**（必须是 Safari，Chrome 不支持 PWA）

3. **输入网址**：

   ```
   http://192.168.X.X:5173
   ```

   （使用第二步中显示的实际 IP 地址）

4. **看到应用页面后，点击底部的"分享"按钮**
   - 📱 iPhone X 及更新机型：底部中间的分享图标
   - 📱 老款 iPhone：底部的方框加箭头图标

5. **向下滚动，点击"添加到主屏幕"**
   - 图标显示为: ➕ "添加到主屏幕"

6. **点击右上角的"添加"**

7. **完成！** 🎉 现在您的主屏幕上有一个"徒步社交"应用图标

---

## 📱 使用应用

### 启动应用

从主屏幕点击"徒步社交"图标，应用会全屏打开（没有 Safari 地址栏）。

### 核心功能

#### 1. 浏览活动

- 首页显示推荐的徒步活动
- 点击"换一批"查看更多活动
- 点击活动卡片查看详情

#### 2. 加入活动

- 在活动列表或详情页点击"加入"按钮
- 查看活动详细信息（路线、装备、注意事项等）

#### 3. 地图功能

- 使用高德地图查看活动位置
- 可以放大缩小和移动地图
- 支持定位到当前位置

#### 4. 个人中心

- 查看我的活动
- 管理个人资料

---

## 🔧 功能说明

### 支持的 Web API 功能

✅ **定位服务**

- 使用浏览器的 Geolocation API
- 需要授予位置权限

✅ **相机和相册**

- 使用 `<input type="file" accept="image/*">` 调用相机
- 使用 `<input type="file" accept="image/*" capture="environment">` 直接拍照
- 需要授予相机/相册权限

✅ **本地存储**

- 使用 LocalStorage 和 IndexedDB
- 自动保存登录状态和用户数据

✅ **离线缓存**

- Service Worker 缓存静态资源
- 无网络时仍可查看已加载的内容

✅ **推送通知**

- 支持浏览器通知
- 需要授予通知权限

---

## ⚙️ 权限设置

应用首次使用时需要授予以下权限：

### 位置权限

当应用请求位置时：

1. 点击"允许"
2. 如误点"不允许"，前往：
   - **设置 → Safari → 位置 → 选择"使用应用期间"**

### 相机权限

当上传照片时：

1. 点击"好"允许访问
2. 如误拒绝，前往：
   - **设置 → Safari → 相机 → 开启**

### 通知权限

接收活动通知：

1. 点击"允许"
2. 如需修改，前往：
   - **设置 → 通知 → Safari**

---

## 🌐 网络要求

### 开发模式（当前）

- ✅ iPhone 和 Windows 电脑必须在同一个 WiFi
- ✅ 可以使用 `http://` 协议
- ✅ 适合本地测试

### 生产模式（正式部署）

- 📌 需要部署到公网服务器
- 📌 必须使用 `https://` 协议（PWA 要求）
- 📌 可以从任何网络访问

---

## 🎨 PWA 特性

### 安装后的优势

✅ **像原生应用一样**

- 从主屏幕启动
- 全屏显示（无浏览器 UI）
- 独立的应用窗口

✅ **离线支持**

- Service Worker 缓存
- 无网络时可查看已加载内容

✅ **性能优化**

- 预缓存关键资源
- 更快的启动速度

✅ **更新机制**

- 自动检测新版本
- 后台更新资源

---

## 📊 与原生应用对比

| 功能     | PWA (当前)           | 原生应用        |
| -------- | -------------------- | --------------- |
| 安装方式 | Safari 添加到主屏幕  | App Store       |
| 开发环境 | Windows + iOS        | macOS + Xcode   |
| 更新     | 自动更新             | 需提交审核      |
| 定位     | ✅ Geolocation API   | ✅ CoreLocation |
| 相机     | ✅ File Input API    | ✅ AVFoundation |
| 地图     | ✅ 高德 Web API      | ✅ 高德 iOS SDK |
| 推送通知 | ✅ Web Notifications | ✅ APNs         |
| 离线功能 | ✅ Service Worker    | ✅ 本地数据库   |
| 性能     | 良好                 | 优秀            |

---

## 🐛 常见问题

### 1. 无法添加到主屏幕

**问题**: 没有看到"添加到主屏幕"选项

**解决方案**:

- 确保使用 **Safari 浏览器**（不是 Chrome）
- 确保已完全加载网页
- 尝试刷新页面后再操作

### 2. 地图不显示

**问题**: 地图区域空白

**解决方案**:

- 检查网络连接
- 确认后端服务器正在运行
- 清除 Safari 缓存：
  - 设置 → Safari → 清除历史记录与网站数据

### 3. 定位失败

**问题**: 无法获取位置信息

**解决方案**:

- 确认已授予位置权限
- 前往：设置 → 隐私与安全性 → 定位服务 → 开启
- 前往：设置 → Safari → 位置 → 使用应用期间

### 4. 照片上传失败

**问题**: 无法选择照片

**解决方案**:

- 确认已授予相册权限
- 前往：设置 → 隐私与安全性 → 照片 → Safari → 允许访问

### 5. 应用崩溃或白屏

**问题**: 应用无法正常显示

**解决方案**:

1. 从主屏幕删除应用图标
2. 清除 Safari 缓存
3. 重新在 Safari 打开网址
4. 重新添加到主屏幕

---

## 🔄 更新应用

### 自动更新

- 应用会自动检测新版本
- 后台静默更新资源

### 手动更新

如需强制更新：

1. 长按主屏幕上的应用图标
2. 点击"删除 App"
3. 重新在 Safari 打开网址
4. 重新添加到主屏幕

---

## 📈 性能优化建议

### 网络优化

- 使用 WiFi 获得最佳体验
- 4G/5G 网络也可正常使用
- 开启"低数据模式"可减少流量

### 电池优化

- 应用已优化电池消耗
- 不使用时从多任务中关闭

### 存储管理

- 应用占用空间很小（< 10MB）
- 缓存会自动清理

---

## 🚀 生产部署（可选）

如需部署到公网供所有人使用：

### 方案 A：使用云服务器

1. **租用服务器**（阿里云、腾讯云等）
2. **部署后端**:

   ```bash
   cd backend
   npm install
   npm run build
   pm2 start dist/server.js
   ```

3. **构建前端**:

   ```bash
   cd frontend
   npm run build
   ```

4. **配置 Nginx**:

   ```nginx
   server {
       listen 443 ssl;
       server_name yourdomain.com;

       ssl_certificate /path/to/cert.pem;
       ssl_certificate_key /path/to/key.pem;

       location / {
           root /path/to/frontend/dist;
           try_files $uri $uri/ /index.html;
       }

       location /api/ {
           proxy_pass http://localhost:3000;
       }
   }
   ```

5. **获取 SSL 证书**（必须 HTTPS）:
   ```bash
   # 使用 Let's Encrypt 免费证书
   certbot --nginx -d yourdomain.com
   ```

### 方案 B：使用 Vercel（免费）

1. 前端部署到 Vercel
2. 后端部署到 Railway 或 Render
3. 配置环境变量连接数据库

---

## 📞 技术支持

如遇到问题：

1. **检查控制台日志**:
   - Safari → 设置 → 高级 → Web 检查器
   - 连接电脑后在 Safari 开发菜单查看

2. **查看网络状态**:
   - 确保后端服务器运行中
   - 检查防火墙设置

3. **重新安装应用**:
   - 删除主屏幕图标
   - 清除 Safari 缓存
   - 重新添加

---

## ✨ 总结

现在您可以在 **iOS 手机** 上使用这个徒步社交应用了！

**开发环境配置**:

1. ✅ Windows 电脑运行后端和前端服务器
2. ✅ iPhone 通过 WiFi 访问应用
3. ✅ 添加到主屏幕作为 PWA 使用

**享受徒步社交的所有功能**! 🏔️🚶‍♀️🚶‍♂️
