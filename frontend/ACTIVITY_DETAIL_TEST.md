# 活动详情页测试文档

## 功能概览

根据设计图完善了"记录"页面（徒步记录）的功能，包括：

1. **我加入的**活动详情页面，带有完整的路线数据和海拔图表
2. **我发布的**活动状态管理（招募中/进行中/已结束）
3. 分享功能（微信、朋友圈、复制链接、生成图片）

---

## 一、活动详情页面 (ActivityDetail.vue)

### 访问路径

- 从"记录"页面点击任意活动卡片进入
- 直接访问：`http://localhost:5173/activity/:id`
- 示例：`http://localhost:5173/activity/1`

### 页面结构

#### 1. 顶部导航栏

- **返回按钮**（左侧）：点击返回上一页
- **标题**（居中）：显示"活动详情"
- **分享按钮**（右侧）：点击打开分享弹窗

#### 2. 活动封面

- 全宽封面图片（高度264px）
- **左上角状态标签**：
  - 招募中 - 青色背景 (teal-500)
  - 进行中 - 橙色背景 (orange-500)
  - 已结束 - 灰色背景 (gray-400)
- **右上角难度标签**：橙色背景显示难度等级（如"难度 3.0"）

#### 3. 路线详情卡片

包含以下关键数据：

##### a) 全程距离

- 显示在卡片右上角
- 格式：`全程 12.5km`

##### b) 累计爬升/下降

- 两列网格布局
- 左侧：累计爬升（向上箭头图标）
  - 大号数字显示（青色）
  - 单位：米(m)
  - 示例：642m
- 右侧：累计下降（向下箭头图标）
  - 大号数字显示（青色）
  - 单位：米(m)
  - 示例：638m

##### c) 海拔图表 (SVG)

- **设计特点**：
  - 渐变填充区域（青色渐变）
  - 青色曲线 (#14b8a6)
  - 背景网格线

- **关键标注**：
  - **最高点 (Max)**：
    - 圆形标记点
    - 文本标注 "Max 840m"
    - 位置：曲线最高处上方
  - **最低点 (Min)**：
    - 圆形标记点
    - 文本标注 "Min 210m"
    - 位置：曲线最低处下方

- **X轴刻度**：
  - 显示距离节点：0km, 4km, 8km, 12.5km
  - 均匀分布在图表底部

- **技术实现**：
  - 使用 computed 属性计算路径
  - 根据海拔数据动态生成曲线
  - 自动识别最高/最低点位置

#### 4. 日程安排卡片

- **日期和时间**：
  - 青色背景容器
  - 显示完整日期：`2023-12-15 (周六)`
  - 显示出发时间：`09:00 准时出发`

- **集合地点**：
  - 地点图标（青色）
  - 地点名称：粗体显示
  - 提示文字："请自行前往集合地点"

#### 5. 活动简介

- 白色卡片
- 标题："活动简介"
- 详细的活动描述文本

#### 6. 参与者列表

- 头像叠加显示（最多显示5个）
- 超过5人显示 "+N" 数量标识
- 显示总人数："X人已报名"

#### 7. 底部操作栏

固定在底部，包含三个按钮：

##### a) 收藏按钮

- 圆形边框按钮
- 未收藏：灰色边框 + 灰色图标
- 已收藏：红色边框 + 红色填充
- 点击切换收藏状态

##### b) 咨询按钮

- 圆形边框按钮
- 消息图标
- 点击跳转到聊天页面

##### c) 报名按钮

- 主要操作按钮（最宽）
- 青色背景 (teal-500)
- 三种状态：
  - "立即报名"（未报名）
  - "已报名"（已报名，灰色背景）
  - "活动已结束"（已结束，灰色背景不可点击）

---

## 二、分享功能弹窗

### 触发方式

点击顶部导航栏右侧的分享按钮

### 弹窗设计

- 从底部滑入动画
- 半透明黑色遮罩
- 白色圆角卡片

### 分享选项（4个）

#### 1. 微信

- 绿色圆形图标
- 微信 logo
- 文字："微信"

#### 2. 朋友圈

- 深绿色圆形图标
- 朋友圈 logo（圆形点阵）
- 文字："朋友圈"

#### 3. 复制链接

- 灰色圆形图标
- 链接图标
- 文字："复制链接"
- **功能**：点击复制当前页面URL到剪贴板

#### 4. 生成图片

- 紫色圆形图标
- 图片图标
- 文字："生成图片"
- **功能**：生成活动分享图片

### 取消按钮

- 全宽灰色按钮
- 文字："取消"
- 点击关闭弹窗

---

## 三、我发布的活动状态管理 (MyHiking.vue)

### 访问路径

- 底部导航 → "记录" → "我发布的" 标签

### 三种活动状态

#### 1. 招募中 (青色标签)

**显示内容**：

- 青色背景卡片底部区域
- 左侧：申请者头像（最多显示3个）
- 中间："`X人申请中`"
- 右侧："`查看申请`" 按钮（青色文字）

**交互**：

- 点击"查看申请"按钮 → 跳转到申请者管理页面

#### 2. 进行中 (橙色标签)

**显示内容**：

- 橙色背景卡片底部区域
- 左侧：参与者头像（最多显示8个）
- 中间："`活动进行中`"
- 右侧："`详情`" 按钮（橙色文字）

**交互**：

- 点击"详情"按钮 → 跳转到活动详情页面

#### 3. 已结束 (灰色标签)

**显示内容**：

- 灰色背景卡片底部区域
- 左侧：参与者头像（最多显示2个）
- 中间："`已圆满结束`"
- 右侧："`查看回顾`" 按钮（灰色文字）

**交互**：

- 点击"查看回顾"按钮 → 跳转到活动回顾页面

---

## 四、测试步骤

### 测试1：查看活动详情

1. 启动开发服务器：`npm run dev`
2. 访问：`http://localhost:5173`
3. 点击底部导航栏 "记录" 图标
4. 默认显示 "我加入的" 标签页
5. 点击任意活动卡片
6. **验证**：
   - ✅ 页面跳转到活动详情
   - ✅ 顶部显示返回按钮和分享按钮
   - ✅ 封面图正常显示
   - ✅ 状态标签显示正确（招募中/进行中/已结束）
   - ✅ 难度标签显示在右上角

### 测试2：海拔图表显示

在活动详情页面：

1. 滚动到"路线详情"卡片
2. **验证**：
   - ✅ 累计爬升数据显示（642m）
   - ✅ 累计下降数据显示（638m）
   - ✅ 海拔图表正常渲染
   - ✅ 最高点标注"Max 840m"显示在曲线顶部
   - ✅ 最低点标注"Min 210m"显示在曲线底部
   - ✅ X轴刻度显示：0km, 4km, 8km, 12.5km
   - ✅ 曲线平滑连接所有数据点
   - ✅ 渐变填充区域正常显示

### 测试3：日程安排

1. 继续滚动到"日程安排"卡片
2. **验证**：
   - ✅ 日期格式正确：`2023-12-15 (周六)`
   - ✅ 时间显示：`09:00 准时出发`
   - ✅ 集合地点显示：`昌平螺山公园售票处`
   - ✅ 提示文字显示

### 测试4：分享功能

1. 点击右上角分享按钮
2. **验证**：
   - ✅ 弹窗从底部滑入
   - ✅ 显示4个分享选项（微信、朋友圈、复制链接、生成图片）
   - ✅ 每个选项有图标和文字
3. 点击"复制链接"
4. **验证**：
   - ✅ 浏览器弹出"链接已复制"提示
   - ✅ 弹窗自动关闭
5. 粘贴测试
6. **验证**：
   - ✅ 剪贴板包含当前页面URL

### 测试5：底部操作栏

1. 滚动到页面底部
2. **验证**：
   - ✅ 三个按钮横向排列
   - ✅ 收藏按钮（心形图标）
   - ✅ 咨询按钮（消息图标）
   - ✅ 报名按钮（最宽，青色背景）
3. 点击收藏按钮
4. **验证**：
   - ✅ 图标从灰色变为红色
   - ✅ 边框从灰色变为红色
5. 再次点击收藏按钮
6. **验证**：
   - ✅ 恢复为灰色未收藏状态
7. 点击报名按钮
8. **验证**：
   - ✅ 弹出"报名成功！"提示
   - ✅ 按钮文字变为"已报名"
   - ✅ 按钮背景变为灰色

### 测试6：我发布的活动状态

1. 返回"记录"页面
2. 点击"我发布的"标签
3. **验证第一个活动（招募中）**：
   - ✅ 左上角显示青色"招募中"标签
   - ✅ 底部显示申请者头像（最多3个）
   - ✅ 显示"5人申请中"
   - ✅ 右侧有"查看申请"按钮
4. **验证第二个活动（进行中）**：
   - ✅ 左上角显示橙色"进行中"标签
   - ✅ 底部显示参与者头像（最多8个）
   - ✅ 显示"活动进行中"
   - ✅ 右侧有"详情"按钮
5. **验证第三个活动（已结束）**：
   - ✅ 左上角显示灰色"已结束"标签
   - ✅ 底部显示参与者头像（2个）
   - ✅ 显示"已圆满结束"
   - ✅ 右侧有"查看回顾"按钮

### 测试7：点击状态操作按钮

1. 点击"招募中"活动的"查看申请"按钮
2. **验证**：
   - ✅ 控制台输出："查看申请者列表: 3"
   - ✅ 尝试跳转到 `/activity/3/applicants`（页面可能未实现）
3. 返回，点击"进行中"活动的"详情"按钮
4. **验证**：
   - ✅ 跳转到活动详情页面
   - ✅ 显示该活动的完整信息
5. 返回，点击"已结束"活动的"查看回顾"按钮
6. **验证**：
   - ✅ 控制台输出："查看活动回顾: 5"
   - ✅ 尝试跳转到 `/activity/5/feedback`（页面可能未实现）

---

## 五、技术实现要点

### 1. 海拔图表算法

```typescript
// 计算海拔曲线路径
const elevationPath = computed(() => {
  const data = activity.value.elevationData
  const maxElev = Math.max(...data)
  const minElev = Math.min(...data)
  const range = maxElev - minElev

  const points = data.map((elevation, index) => {
    const x = (index / (data.length - 1)) * chartWidth
    const y = chartHeight - ((elevation - minElev) / range) * (chartHeight - 20) - 10
    return `${x},${y}`
  })

  return `M ${points.join(' L ')}`
})
```

### 2. 最高/最低点定位

```typescript
const maxElevationPoint = computed(() => {
  const data = activity.value.elevationData
  const maxIndex = data.indexOf(Math.max(...data))

  return {
    x: (maxIndex / (data.length - 1)) * chartWidth,
    y: chartHeight - ((maxElev - minElev) / range) * (chartHeight - 20) - 10,
  }
})
```

### 3. 活动状态样式动态绑定

```vue
<span :class="[
  'text-xs font-semibold px-3 py-1 rounded-full text-white',
  activity.status === '招募中' ? 'bg-teal-500' :
  activity.status === '进行中' ? 'bg-orange-500' :
  activity.status === '已结束' ? 'bg-gray-400' : 'bg-teal-500'
]">
```

### 4. 分享功能实现

```typescript
// 复制链接到剪贴板
const copyLink = () => {
  const link = window.location.href
  navigator.clipboard.writeText(link).then(() => {
    alert('链接已复制')
    showShareModal.value = false
  })
}
```

### 5. 数据模拟

```typescript
// 模拟海拔数据（20个点）
elevationData: [
  210, 280, 350, 420, 520, 650, 720, 780, 840, 800, 720, 650, 580, 520, 480, 420, 380, 340, 280,
  210,
]
```

---

## 六、浏览器兼容性

### 支持的浏览器

- ✅ Chrome 90+ (推荐)
- ✅ Edge 90+
- ✅ Firefox 88+
- ✅ Safari 14+

### 移动端支持

- ✅ iOS Safari 14+
- ✅ Chrome for Android
- ✅ 微信内置浏览器

### 关键API兼容性

- SVG 路径绘制：所有现代浏览器支持
- Clipboard API (`navigator.clipboard`)：需要HTTPS或localhost
- Flexbox 布局：所有现代浏览器支持
- CSS Grid：所有现代浏览器支持

---

## 七、已知问题和待实现功能

### 待实现功能

1. **申请者管理页面** (`/activity/:id/applicants`)
   - 查看申请者列表
   - 同意/拒绝申请
   - 申请者详细信息

2. **活动回顾页面** (`/activity/:id/feedback`)
   - 活动照片墙
   - 参与者评价
   - 活动数据统计

3. **分享功能完善**
   - 微信分享SDK集成
   - 生成分享图片功能
   - 社交媒体分享

4. **后端集成**
   - 从API获取真实活动数据
   - 海拔数据计算（基于高德地图API）
   - 用户报名/取消报名

### 优化建议

1. 海拔图表增加交互：
   - 鼠标悬停显示详细海拔
   - 点击切换单位（米/英尺）

2. 性能优化：
   - SVG路径缓存
   - 图片懒加载
   - 组件按需加载

3. 用户体验：
   - 添加骨架屏加载
   - 下拉刷新
   - 上拉加载更多

---

## 八、API接口说明（待后端实现）

### 获取活动详情

```
GET /api/activities/:id

Response:
{
  "id": 1,
  "title": "螺山国家森林公园健行",
  "coverImage": "...",
  "status": "招募中",
  "difficulty": "3.0",
  "distance": 12.5,
  "elevationGain": 642,
  "elevationLoss": 638,
  "maxElevation": 840,
  "minElevation": 210,
  "elevationData": [210, 280, 350, ...],
  "startTime": "2023-12-15T09:00:00",
  "meetingPoint": "昌平螺山公园售票处",
  "description": "...",
  "participants": [...]
}
```

### 报名活动

```
POST /api/activities/:id/join

Response:
{
  "success": true,
  "message": "报名成功"
}
```

### 取消报名

```
DELETE /api/activities/:id/join

Response:
{
  "success": true,
  "message": "已取消报名"
}
```

---

## 总结

✅ **已完成功能**：

1. 活动详情页面完整UI实现
2. SVG海拔图表带最高/最低点标注
3. 路线数据展示（距离、爬升、下降）
4. 日程安排和集合地点
5. 分享功能弹窗（4种分享方式）
6. 底部操作栏（收藏、咨询、报名）
7. 我发布的活动三种状态管理
8. 所有交互动画和状态切换

🔄 **待后端集成**：

- 真实活动数据API
- 用户报名系统
- 海拔数据计算
- 图片上传和存储

📝 **下一步建议**：

1. 实现申请者管理页面
2. 实现活动回顾页面
3. 集成后端API
4. 完善分享功能（微信SDK）
5. 添加骨架屏加载状态
