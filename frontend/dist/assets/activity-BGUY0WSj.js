import{d as h}from"./state-COm4LJOs.js";import"./index-Bhs_HTB-.js";import{a as o}from"./activity-B4jLDCAZ.js";import{r as u,d as g}from"./vue-Dq4PaVdn.js";const G=h("activity",()=>{const n=u([]),y=u([]),d=u([]),l=u(null),i=u(!1),r=u(null),v=u({page:1,page_size:10,total:0,total_pages:0}),p=g(()=>n.value.length>0);return{activities:n,joinedActivities:y,createdActivities:d,currentActivity:l,loading:i,error:r,pagination:v,hasActivities:p,fetchActivities:async a=>{i.value=!0,r.value=null;try{const e=await o.getActivities(a);if(e.code===200&&e.data){const t=e.data;n.value=t.items,v.value=t.pagination}}catch(e){r.value=e.message||"获取活动列表失败",console.error("Fetch activities error:",e)}finally{i.value=!1}},fetchActivityDetail:async a=>{i.value=!0,r.value=null;try{const e=await o.getActivityDetail(a);return e.code===200&&e.data?(l.value=e.data,e.data):null}catch(e){return r.value=e.message||"获取活动详情失败",console.error("Fetch activity detail error:",e),null}finally{i.value=!1}},getActivityById:async a=>{i.value=!0,r.value=null;try{const e=await o.getActivityDetail(a);return e.code===200&&e.data?e.data:null}catch(e){return r.value=e.message||"获取活动失败",console.error("Get activity by ID error:",e),null}finally{i.value=!1}},createActivity:async a=>{i.value=!0,r.value=null;try{const e=await o.createActivity(a);if(e.code===201&&e.data){const t=e.data;return n.value.unshift(t),t}throw new Error(e.message||"创建活动失败")}catch(e){throw r.value=e.message||"创建活动失败",console.error("Create activity error:",e),e}finally{i.value=!1}},updateActivity:async(a,e)=>{var t;i.value=!0,r.value=null;try{const c=await o.updateActivity(a,e);if(c.code===200&&c.data){const s=c.data,f=n.value.findIndex(A=>A.id===a);return f!==-1&&(n.value[f]=s),((t=l.value)==null?void 0:t.id)===a&&(l.value=s),s}throw new Error(c.message||"更新活动失败")}catch(c){throw r.value=c.message||"更新活动失败",console.error("Update activity error:",c),c}finally{i.value=!1}},deleteActivity:async a=>{var e;i.value=!0,r.value=null;try{const t=await o.deleteActivity(a);(t.code===204||t.code===200)&&(n.value=n.value.filter(c=>c.id!==a),((e=l.value)==null?void 0:e.id)===a&&(l.value=null))}catch(t){throw r.value=t.message||"删除活动失败",console.error("Delete activity error:",t),t}finally{i.value=!1}},joinActivity:async a=>{var e;i.value=!0,r.value=null;try{const t=await o.joinActivity(a);if(t.code===201||t.code===200){const c=n.value.find(s=>s.id===a);c&&(c.is_joined=!0,c.participant_count!==void 0&&c.participant_count++),((e=l.value)==null?void 0:e.id)===a&&(l.value.is_joined=!0,l.value.participant_count!==void 0&&l.value.participant_count++)}}catch(t){throw r.value=t.message||"参加活动失败",console.error("Join activity error:",t),t}finally{i.value=!1}},leaveActivity:async a=>{var e;i.value=!0,r.value=null;try{const t=await o.leaveActivity(a);if(t.code===204||t.code===200){const c=n.value.find(s=>s.id===a);c&&(c.is_joined=!1,c.participant_count!==void 0&&c.participant_count>0&&c.participant_count--),((e=l.value)==null?void 0:e.id)===a&&(l.value.is_joined=!1,l.value.participant_count!==void 0&&l.value.participant_count>0&&l.value.participant_count--)}}catch(t){throw r.value=t.message||"退出活动失败",console.error("Leave activity error:",t),t}finally{i.value=!1}},fetchMyJoinedActivities:async a=>{i.value=!0,r.value=null;try{const e=await o.getMyJoinedActivities(a);if(e.code===200&&e.data){const t=e.data;y.value=t.items}}catch(e){r.value=e.message||"获取参加的活动失败",console.error("Fetch joined activities error:",e)}finally{i.value=!1}},fetchMyCreatedActivities:async a=>{i.value=!0,r.value=null;try{const e=await o.getMyCreatedActivities(a);if(e.code===200&&e.data){const t=e.data;d.value=t.items}}catch(e){r.value=e.message||"获取创建的活动失败",console.error("Fetch created activities error:",e)}finally{i.value=!1}},clearCurrentActivity:()=>{l.value=null},reset:()=>{n.value=[],l.value=null,i.value=!1,r.value=null,v.value={page:1,page_size:10,total:0,total_pages:0}}}});export{G as u};
