import{r as y,d as L,k as K,v as c,q as n,S as N,L as $,M as x,Q as I,z as t,l as O,p as Q,x as m,O as X,P as H,X as J,G as _,A as h,y as C}from"./vue-B6Xl8iL6.js";import{d as W,s as Y}from"./state-BRWMog1q.js";import{a as k,_ as G,k as V,l as Z,t as F}from"./index-Bs01uyeg.js";const ee=async o=>k.post("/friends/request",o),se=async()=>k.get("/friends"),te=async()=>k.get("/friends/requests/pending"),ae=async o=>k.get("/friends/search",{params:{keyword:o}}),ne=async(o=10)=>k.get("/friends/recommendations",{params:{limit:o}}),le=async o=>k.get(`/friends/${o}/status`),ce=async o=>k.put(`/friends/${o}/accept`),ie=async o=>k.put(`/friends/${o}/reject`),oe=async o=>k.delete(`/friends/${o}`),re=W("friend",()=>{const o=y([]),u=y([]),v=y([]),p=y([]),d=y(!1),i=y(null),S=L(()=>o.value.length),R=L(()=>u.value.length),b=async(l,s)=>{d.value=!0,i.value=null;try{const a=await ee({friend_id:l,message:s});if(a.code===200)return a.data;throw i.value=a.message,new Error(a.message)}catch(a){throw i.value=a.message||"å‘é€å¥½å‹è¯·æ±‚å¤±è´¥",a}finally{d.value=!1}},f=async()=>{d.value=!0,i.value=null;try{const l=await se();l.code===200?o.value=l.data:i.value=l.message}catch(l){i.value=l.message||"èŽ·å–å¥½å‹åˆ—è¡¨å¤±è´¥"}finally{d.value=!1}};return{friends:o,pendingRequests:u,searchResults:v,recommendedUsers:p,loading:d,error:i,friendCount:S,pendingRequestCount:R,sendFriendRequest:b,fetchFriends:f,fetchPendingRequests:async()=>{d.value=!0,i.value=null;try{const l=await te();l.code===200?u.value=l.data:i.value=l.message}catch(l){i.value=l.message||"èŽ·å–å¥½å‹è¯·æ±‚å¤±è´¥"}finally{d.value=!1}},searchUsers:async l=>{if(!l.trim()){v.value=[];return}d.value=!0,i.value=null;try{const s=await ae(l);s.code===200?v.value=s.data:(i.value=s.message,v.value=[])}catch(s){i.value=s.message||"æœç´¢ç”¨æˆ·å¤±è´¥",v.value=[]}finally{d.value=!1}},fetchRecommendedUsers:async(l=10)=>{d.value=!0,i.value=null;try{const s=await ne(l);s.code===200?p.value=s.data:i.value=s.message}catch(s){i.value=s.message||"èŽ·å–æŽ¨èç”¨æˆ·å¤±è´¥"}finally{d.value=!1}},getFriendshipStatus:async l=>{try{const s=await le(l);return s.code===200?s.data.status:null}catch(s){return console.error("èŽ·å–å¥½å‹å…³ç³»çŠ¶æ€å¤±è´¥:",s),null}},acceptFriendRequest:async l=>{d.value=!0,i.value=null;try{const s=await ce(l);if(s.code===200){const a=u.value.findIndex(r=>r.user_id===l);return a!==-1&&u.value.splice(a,1),await f(),s.data}else throw i.value=s.message,new Error(s.message)}catch(s){throw i.value=s.message||"æŽ¥å—å¥½å‹è¯·æ±‚å¤±è´¥",s}finally{d.value=!1}},rejectFriendRequest:async l=>{d.value=!0,i.value=null;try{const s=await ie(l);if(s.code===200){const a=u.value.findIndex(r=>r.user_id===l);return a!==-1&&u.value.splice(a,1),s.data}else throw i.value=s.message,new Error(s.message)}catch(s){throw i.value=s.message||"æ‹’ç»å¥½å‹è¯·æ±‚å¤±è´¥",s}finally{d.value=!1}},removeFriend:async l=>{d.value=!0,i.value=null;try{const s=await oe(l);if(s.code===200){const a=o.value.findIndex(r=>r.user_id===l);a!==-1&&o.value.splice(a,1)}else throw i.value=s.message,new Error(s.message)}catch(s){throw i.value=s.message||"åˆ é™¤å¥½å‹å¤±è´¥",s}finally{d.value=!1}},clearSearchResults:()=>{v.value=[]},clearFriendData:()=>{o.value=[],u.value=[],v.value=[],p.value=[],i.value=null}}}),de={class:"skeleton"},ue={key:0,class:"skeleton-card"},ve={key:1,class:"skeleton-list"},he={key:2,class:"skeleton-user"},_e=K({__name:"Skeleton",props:{type:{},count:{},width:{},height:{}},setup(o){return(u,v)=>(n(),c("div",de,[o.type==="card"?(n(),c("div",ue,[...v[0]||(v[0]=[N('<div class="skeleton-image" data-v-06814528></div><div class="skeleton-content" data-v-06814528><div class="skeleton-title" data-v-06814528></div><div class="skeleton-text" data-v-06814528></div><div class="skeleton-text short" data-v-06814528></div></div>',2)])])):o.type==="list"?(n(),c("div",ve,[(n(!0),c($,null,x(o.count,p=>(n(),c("div",{key:p,class:"skeleton-list-item"},[...v[1]||(v[1]=[t("div",{class:"skeleton-avatar"},null,-1),t("div",{class:"skeleton-list-content"},[t("div",{class:"skeleton-title"}),t("div",{class:"skeleton-text"})],-1)])]))),128))])):o.type==="user"?(n(),c("div",he,[...v[2]||(v[2]=[N('<div class="skeleton-avatar large" data-v-06814528></div><div class="skeleton-user-info" data-v-06814528><div class="skeleton-title" data-v-06814528></div><div class="skeleton-text" data-v-06814528></div><div class="skeleton-text short" data-v-06814528></div></div>',2)])])):(n(),c("div",{key:3,class:"skeleton-block",style:I({width:o.width,height:o.height})},null,4))]))}}),me=G(_e,[["__scopeId","data-v-06814528"]]),ge={class:"add-friend"},fe={class:"search-section"},ye={class:"search-box"},ke=["disabled"],pe={key:0},be={key:1},we={key:1,class:"section"},Re={class:"user-list"},Fe=["src","alt"],$e={class:"user-info"},xe={class:"nickname"},Se={key:0,class:"bio"},qe={class:"meta"},Ce={key:0,class:"gender"},Ue=["onClick","disabled"],je={key:0},Te={key:1},De={key:2,class:"section"},Me={class:"section-title"},Pe=["disabled"],Ee={class:"user-list"},ze=["src","alt"],Ae={class:"user-info"},Be={class:"nickname"},Le={key:0,class:"bio"},Ne={key:1,class:"tags"},Ve={class:"meta"},Ke={key:0,class:"mutual"},Ge=["onClick","disabled"],Ie={key:0},Oe={key:1},Qe={key:3,class:"section"},Xe={class:"section-title"},He={class:"request-list"},Je=["src","alt"],We={class:"request-info"},Ye={class:"nickname"},Ze={key:0,class:"message"},es={class:"meta"},ss={class:"time"},ts={class:"request-actions"},as=["onClick","disabled"],ns=["onClick","disabled"],ls={key:4,class:"section"},cs={class:"section-title"},is={class:"friend-grid"},os=["src","alt"],rs={class:"nickname"},ds=K({__name:"AddFriend",setup(o){const u=re(),{friends:v,friendCount:p,pendingRequests:d,searchResults:i,recommendedUsers:S,loading:R}=Y(u),b=y(""),f=y(null),w=y(null);O(async()=>{const a=V.get("cached_friends");a&&(v.value=a),await Promise.all([u.fetchFriends(),u.fetchPendingRequests(),q()]),V.set("cached_friends",v.value,5*60*1e3)});const T=Z(async a=>{a.trim()&&await u.searchUsers(a.trim())},300),D=()=>{T(b.value)},U=async()=>{b.value.trim()&&await u.searchUsers(b.value.trim())},q=async()=>{await u.fetchRecommendedUsers(10)},j=async a=>{try{f.value=a,await u.sendFriendRequest(a),F.success("å¥½å‹è¯·æ±‚å·²å‘é€"),u.clearSearchResults(),await q()}catch(r){F.error(r.message||"å‘é€å¤±è´¥")}finally{f.value=null}},M=async a=>{try{w.value=a,await u.acceptFriendRequest(a),F.success("å·²æŽ¥å—å¥½å‹è¯·æ±‚")}catch(r){F.error(r.message||"æŽ¥å—å¤±è´¥")}finally{w.value=null}},P=async a=>{try{w.value=a,await u.rejectFriendRequest(a),F.info("å·²æ‹’ç»å¥½å‹è¯·æ±‚")}catch(r){F.error(r.message||"æ‹’ç»å¤±è´¥")}finally{w.value=null}},E=a=>{const r=new Date(a),g=new Date().getTime()-r.getTime(),z=Math.floor(g/6e4),A=Math.floor(g/36e5),B=Math.floor(g/864e5);return z<60?`${z}åˆ†é’Ÿå‰`:A<24?`${A}å°æ—¶å‰`:B<7?`${B}å¤©å‰`:r.toLocaleDateString("zh-CN")},l=a=>({beginner:"å…¥é—¨",intermediate:"è¿›é˜¶",advanced:"é«˜çº§",expert:"ä¸“å®¶"})[a||"beginner"]||"å…¥é—¨",s=a=>({male:"ç”·",female:"å¥³",other:"å…¶ä»–"})[a||""]||"";return(a,r)=>(n(),c("div",ge,[t("div",fe,[t("div",ye,[X(t("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>b.value=e),type:"text",placeholder:"æœç´¢ç”¨æˆ·æ˜µç§°æˆ–é‚®ç®±",class:"search-input",onInput:D,onKeyup:J(U,["enter"])},null,544),[[H,b.value]]),t("button",{class:"search-btn",onClick:U,disabled:_(R)},[_(R)?(n(),c("span",pe,"æœç´¢ä¸­...")):(n(),c("span",be,"ðŸ” æœç´¢"))],8,ke)])]),_(R)&&!_(i).length&&!_(S).length?(n(),Q(me,{key:0,type:"list",count:5})):m("",!0),_(i).length>0?(n(),c("div",we,[r[1]||(r[1]=t("h3",{class:"section-title"},"æœç´¢ç»“æžœ",-1)),t("div",Re,[(n(!0),c($,null,x(_(i),e=>(n(),c("div",{key:e.user_id,class:"user-card"},[t("img",{src:e.avatar_url||"/default-avatar.png",alt:e.nickname,class:"avatar"},null,8,Fe),t("div",$e,[t("h4",xe,h(e.nickname),1),e.bio?(n(),c("p",Se,h(e.bio),1)):m("",!0),t("div",qe,[t("span",{class:C(["level",`level-${e.hiking_level}`])},h(l(e.hiking_level)),3),e.gender?(n(),c("span",Ce,h(s(e.gender)),1)):m("",!0)])]),t("button",{class:"btn-add",onClick:g=>j(e.user_id),disabled:f.value===e.user_id},[f.value===e.user_id?(n(),c("span",je,"å‘é€ä¸­...")):(n(),c("span",Te,"+ æ·»åŠ "))],8,Ue)]))),128))])])):m("",!0),_(S).length>0?(n(),c("div",De,[t("h3",Me,[r[2]||(r[2]=t("span",null,"å¯èƒ½è®¤è¯†çš„äºº",-1)),t("button",{class:"refresh-btn",onClick:q,disabled:_(R)}," ðŸ”„ åˆ·æ–° ",8,Pe)]),t("div",Ee,[(n(!0),c($,null,x(_(S),e=>(n(),c("div",{key:e.user_id,class:"user-card"},[t("img",{src:e.avatar_url||"/default-avatar.png",alt:e.nickname,class:"avatar"},null,8,ze),t("div",Ae,[t("h4",Be,h(e.nickname),1),e.bio?(n(),c("p",Le,h(e.bio),1)):m("",!0),e.common_preferences&&e.common_preferences.length>0?(n(),c("div",Ne,[(n(!0),c($,null,x(e.common_preferences.slice(0,3),g=>(n(),c("span",{key:g,class:"tag"},h(g),1))),128))])):m("",!0),t("div",Ve,[t("span",{class:C(["level",`level-${e.hiking_level}`])},h(l(e.hiking_level)),3),e.mutual_friends_count?(n(),c("span",Ke,h(e.mutual_friends_count)+"ä¸ªå…±åŒå¥½å‹ ",1)):m("",!0)])]),t("button",{class:"btn-add",onClick:g=>j(e.user_id),disabled:f.value===e.user_id},[f.value===e.user_id?(n(),c("span",Ie,"å‘é€ä¸­...")):(n(),c("span",Oe,"+ æ·»åŠ "))],8,Ge)]))),128))])])):m("",!0),_(d).length>0?(n(),c("div",Qe,[t("h3",Xe,"å¥½å‹è¯·æ±‚ ("+h(_(d).length)+")",1),t("div",He,[(n(!0),c($,null,x(_(d),e=>(n(),c("div",{key:e.friendship_id,class:"request-card"},[t("img",{src:e.avatar_url||"/default-avatar.png",alt:e.nickname,class:"avatar"},null,8,Je),t("div",We,[t("h4",Ye,h(e.nickname),1),e.message?(n(),c("p",Ze,h(e.message),1)):m("",!0),t("div",es,[t("span",{class:C(["level",`level-${e.hiking_level}`])},h(l(e.hiking_level)),3),t("span",ss,h(E(e.created_at)),1)])]),t("div",ts,[t("button",{class:"btn btn-accept",onClick:g=>M(e.user_id),disabled:w.value===e.user_id}," âœ“ æŽ¥å— ",8,as),t("button",{class:"btn btn-reject",onClick:g=>P(e.user_id),disabled:w.value===e.user_id}," âœ— æ‹’ç» ",8,ns)])]))),128))])])):m("",!0),_(v).length>0?(n(),c("div",ls,[t("h3",cs,"æˆ‘çš„å¥½å‹ ("+h(_(p))+")",1),t("div",is,[(n(!0),c($,null,x(_(v),e=>(n(),c("div",{key:e.id,class:"friend-card"},[t("img",{src:e.avatar_url||"/default-avatar.png",alt:e.nickname,class:"avatar"},null,8,os),t("h4",rs,h(e.nickname),1),t("span",{class:C(["level",`level-${e.hiking_level}`])},h(l(e.hiking_level)),3)]))),128))])])):m("",!0)]))}}),_s=G(ds,[["__scopeId","data-v-7c4889e1"]]);export{_s as default};
