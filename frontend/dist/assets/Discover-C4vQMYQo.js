import{r as m,k as q,J as E,d as S,l as G,v as u,q as v,z as e,x as z,L as U,M as C,O as A,P as L,A as g,Q as $,y as V}from"./vue-Eb8ZdQV1.js";import{d as J}from"./state-WzMdx_T8.js";import{a as R,_ as H}from"./index-BQQdwWu-.js";const j={async getRecommendedActivities(d){return R.get("/discovery/activities",{params:d})},async getRecommendedUsers(d){return R.get("/discovery/users",{params:d})},async searchActivities(d){return R.get("/discovery/search/activities",{params:d})},async searchUsers(d){return R.get("/discovery/search/users",{params:d})}},K=J("discovery",()=>{const d=m([]),h=m([]),p=m([]),l=m(!1),o=m(null),y=m({page:1,page_size:10,total:0,total_pages:0}),b=m({keyword:"",difficulty:void 0,location:void 0,gender:void 0,hiking_level:void 0}),F=async c=>{l.value=!0,o.value=null;try{const a=await j.getRecommendedActivities(c);if(a.code===200&&a.data){const r=a.data;d.value=r.items,y.value=r.pagination}}catch(a){o.value=a.message||"è·å–æ¨èæ´»åŠ¨å¤±è´¥",console.error("Fetch recommended activities error:",a)}finally{l.value=!1}},n=async c=>{l.value=!0,o.value=null;try{const a=await j.getRecommendedUsers(c);if(a.code===200&&a.data){const r=a.data;h.value=r.items,y.value=r.pagination}}catch(a){o.value=a.message||"è·å–æ¨èç”¨æˆ·å¤±è´¥",console.error("Fetch recommended users error:",a)}finally{l.value=!1}},i=async c=>{l.value=!0,o.value=null;try{const a=await j.searchActivities(c);if(a.code===200&&a.data){const r=a.data;p.value=r.items,y.value=r.pagination}}catch(a){o.value=a.message||"æœç´¢æ´»åŠ¨å¤±è´¥",console.error("Search activities error:",a)}finally{l.value=!1}},x=async c=>{l.value=!0,o.value=null;try{const a=await j.searchUsers(c);if(a.code===200&&a.data){const r=a.data;p.value=r.items,y.value=r.pagination}}catch(a){o.value=a.message||"æœç´¢ç”¨æˆ·å¤±è´¥",console.error("Search users error:",a)}finally{l.value=!1}},w=c=>{b.value={...b.value,...c}},k=()=>{b.value={keyword:"",difficulty:void 0,location:void 0,gender:void 0,hiking_level:void 0}};return{recommendedActivities:d,recommendedUsers:h,searchResults:p,loading:l,error:o,pagination:y,filters:b,fetchRecommendedActivities:F,fetchRecommendedUsers:n,searchActivities:i,searchUsers:x,updateFilters:w,clearFilters:k,reset:()=>{d.value=[],h.value=[],p.value=[],l.value=!1,o.value=null,y.value={page:1,page_size:10,total:0,total_pages:0},k()}}}),W={class:"discover-page min-h-screen bg-white pb-24"},X={class:"bg-white pt-6 pb-4 px-4 border-b border-gray-100"},Y={class:"container mx-auto"},Z={class:"relative"},T={key:0,class:"fixed inset-0 bg-white z-50 overflow-y-auto",style:{"padding-top":"env(safe-area-inset-top)"}},ee={class:"min-h-screen"},te={class:"flex items-center justify-between px-4 py-4 border-b border-gray-100"},se={class:"px-4 py-6 space-y-8"},ae={class:"flex gap-3"},le=["onClick"],ne={class:"px-2"},oe={class:"flex justify-between mb-3"},ie={class:"text-2xl font-bold text-gray-800"},re={class:"text-2xl font-bold text-gray-800"},de={class:"relative"},ce={class:"h-2 bg-gray-200 rounded-full relative"},ue={class:"flex gap-3"},ve=["onClick"],ge={class:"flex gap-3 flex-wrap"},me=["onClick"],fe={class:"flex items-center justify-between mb-4"},pe={class:"text-teal-500 text-base font-semibold"},ye={class:"px-2"},xe={class:"h-2 bg-gray-200 rounded-full relative overflow-hidden"},be={class:"container mx-auto px-3 py-6"},he={key:0,class:"flex justify-center py-12"},_e={key:1,class:"grid grid-cols-2 gap-3"},we=["onClick"],ke=["src","alt"],Ue={key:1,class:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"},Ce={class:"absolute inset-0 flex flex-col justify-between p-4"},Ae={class:"flex justify-end"},Le={class:"px-3 py-1 bg-white/90 backdrop-blur text-xs font-semibold text-gray-700 rounded-full"},Re={class:"space-y-1"},je={class:"font-bold text-white text-base"},Fe={class:"text-xs text-white/90"},Ie={class:"text-xs text-white/80"},Se={key:2,class:"text-center py-12"},ze=q({__name:"Discover",setup(d){const h=E(),p=K(),l=m(""),o=m(!1),y=["ç”·","å¥³"],b=["æ–°æ‰‹","ä¸­çº§","é«˜æ‰‹"],F=["æ‘„å½±","éœ²è¥","ç¾é£Ÿ","å® ç‰©"],n=m({gender:[],level:[],interests:[]}),i=m([18,50]),x=m(50),w=["linear-gradient(135deg, #ffb6c1 0%, #ffd700 100%)","linear-gradient(135deg, #4db8a8 0%, #d4e157 100%)","linear-gradient(135deg, #d4a574 0%, #f4a460 100%)","linear-gradient(135deg, #8b7355 0%, #f4e4c1 100%)","linear-gradient(135deg, #c9b998 0%, #6b5b4a 100%)","linear-gradient(135deg, #5f9ea0 0%, #e0f7fa 100%)"],k=S(()=>p.recommendedUsers),D=S(()=>p.loading),c=S(()=>k.value.map((t,s)=>({id:parseInt(t.user_id),nickname:t.nickname,gender:t.gender==="male"?"ç”·":t.gender==="female"?"å¥³":"å…¶ä»–",age:t.age||0,bio:t.bio||"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡å†™...",hikingLevel:t.hiking_level||"æ–°æ‰‹",level:t.hiking_level||"æ–°æ‰‹",tags:[],recentActivity:"æœ€è¿‘æ´»è·ƒ",avatar:t.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=user${t.user_id}`,coverImage:t.avatar_url||"",gradient:w[s%w.length],commonPreferences:t.common_preferences||0})).filter(t=>{const s=l.value.toLowerCase(),_=!l.value||t.nickname.toLowerCase().includes(s)||t.bio.toLowerCase().includes(s)||t.tags.some(I=>I.toLowerCase().includes(s)),M=n.value.gender.length===0||n.value.gender.includes(t.gender),P=t.age>=i.value[0]&&t.age<=i.value[1],N=n.value.level.length===0||n.value.level.includes(t.hikingLevel),Q=n.value.interests.length===0||n.value.interests.some(I=>t.tags.includes(I));return _&&M&&P&&N&&Q})),a=(f,t)=>{const s=n.value[f].indexOf(t);s>-1?n.value[f].splice(s,1):n.value[f].push(t)},r=()=>{n.value={gender:[],level:[],interests:[]},i.value=[18,50],x.value=50,l.value=""},O=f=>{h.push({name:"user-profile",params:{id:f}})},B=async()=>{try{await p.fetchRecommendedUsers({page:1,page_size:20})}catch(f){console.error("åŠ è½½æ¨èç”¨æˆ·å¤±è´¥:",f)}};return G(()=>{B()}),(f,t)=>(v(),u("div",W,[e("div",X,[e("div",Y,[t[8]||(t[8]=e("div",{class:"flex items-center justify-center mb-4"},[e("h1",{class:"text-2xl font-bold text-gray-800"},"å‘ç°å¾’æ­¥ä¼´ä¾£")],-1)),e("div",Z,[t[7]||(t[7]=e("span",{class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"},"ğŸ”",-1)),U(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.value=s),type:"text",placeholder:"æœç´¢æ˜µç§°æˆ–å…±åŒä¹‰è¶£",class:"w-full pl-12 pr-14 py-3 bg-gray-100 rounded-full border-0 focus:outline-none focus:ring-2 focus:ring-green-500 transition"},null,512),[[C,l.value]]),e("button",{onClick:t[1]||(t[1]=s=>o.value=!0),class:"absolute right-2 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-white rounded-full flex items-center justify-center hover:bg-gray-50 transition shadow-sm",title:"ç­›é€‰"},[...t[6]||(t[6]=[e("span",{class:"text-lg"},"âš™ï¸",-1)])])])])]),o.value?(v(),u("div",T,[e("div",ee,[e("div",te,[e("button",{onClick:r,class:"text-gray-600 text-base font-medium"}," é‡ç½® "),t[9]||(t[9]=e("h2",{class:"text-lg font-bold text-gray-800"},"ç­›é€‰",-1)),e("button",{onClick:t[2]||(t[2]=s=>o.value=!1),class:"px-6 py-2 bg-teal-500 text-white rounded-full text-sm font-medium hover:bg-teal-600 transition"}," å®Œæˆ ")]),e("div",se,[e("div",null,[t[10]||(t[10]=e("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"æ€§åˆ«",-1)),e("div",ae,[(v(),u(A,null,L(y,s=>e("button",{key:s,onClick:_=>a("gender",s),class:V(["flex-1 py-3 rounded-full font-medium text-base transition",n.value.gender.includes(s)?"bg-teal-500 text-white":"bg-gray-100 text-gray-700"])},g(s),11,le)),64))])]),e("div",null,[t[11]||(t[11]=e("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"å¹´é¾„èŒƒå›´",-1)),e("div",ne,[e("div",oe,[e("span",ie,g(i.value[0]),1),e("span",re,g(i.value[1]),1)]),e("div",de,[U(e("input",{type:"range","onUpdate:modelValue":t[3]||(t[3]=s=>i.value[0]=s),min:"18",max:"50",class:"range-slider",style:{position:"absolute",width:"100%","pointer-events":"auto"}},null,512),[[C,i.value[0],void 0,{number:!0}]]),U(e("input",{type:"range","onUpdate:modelValue":t[4]||(t[4]=s=>i.value[1]=s),min:"18",max:"50",class:"range-slider",style:{position:"absolute",width:"100%","pointer-events":"auto"}},null,512),[[C,i.value[1],void 0,{number:!0}]]),e("div",ce,[e("div",{class:"absolute h-2 bg-teal-500 rounded-full",style:$({left:(i.value[0]-18)/32*100+"%",right:100-(i.value[1]-18)/32*100+"%"})},null,4)])])])]),e("div",null,[t[12]||(t[12]=e("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"å¾’æ­¥ç»éªŒ",-1)),e("div",ue,[(v(),u(A,null,L(b,s=>e("button",{key:s,onClick:_=>a("level",s),class:V(["flex-1 py-3 rounded-full font-medium text-base transition",n.value.level.includes(s)?"bg-teal-500 text-white":"bg-gray-100 text-gray-700"])},g(s),11,ve)),64))])]),e("div",null,[t[13]||(t[13]=e("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"å…±åŒå…´è¶£",-1)),e("div",ge,[(v(),u(A,null,L(F,s=>e("button",{key:s,onClick:_=>a("interests",s),class:V(["px-6 py-3 rounded-full font-medium text-base transition",n.value.interests.includes(s)?"bg-teal-500 text-white":"bg-gray-100 text-gray-700"])},g(s),11,me)),64))])]),e("div",null,[e("div",fe,[t[14]||(t[14]=e("h3",{class:"text-lg font-bold text-gray-800"},"è·ç¦»èŒƒå›´",-1)),e("span",pe,g(x.value)+"kmå†…",1)]),e("div",ye,[U(e("input",{type:"range","onUpdate:modelValue":t[5]||(t[5]=s=>x.value=s),min:"1",max:"100",class:"range-slider w-full"},null,512),[[C,x.value,void 0,{number:!0}]]),e("div",xe,[e("div",{class:"absolute h-2 bg-teal-500 rounded-full left-0",style:$({width:x.value+"%"})},null,4)])])])])])])):z("",!0),e("div",be,[D.value?(v(),u("div",he,[...t[15]||(t[15]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-500 mx-auto mb-4"}),e("p",{class:"text-gray-600"},"åŠ è½½ä¸­...")],-1)])])):c.value.length>0?(v(),u("div",_e,[(v(!0),u(A,null,L(c.value,s=>(v(),u("div",{key:s.id,class:"user-card group cursor-pointer",onClick:_=>O(s.id)},[e("div",{class:"relative rounded-3xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300",style:$([{"aspect-ratio":"3/4"},{background:s.coverImage?"transparent":s.gradient}])},[s.coverImage?(v(),u("img",{key:0,src:s.coverImage,alt:s.nickname,class:"absolute inset-0 w-full h-full object-cover"},null,8,ke)):z("",!0),s.coverImage?(v(),u("div",Ue)):z("",!0),e("div",Ce,[e("div",Ae,[e("span",Le,g(s.hikingLevel),1)]),e("div",Re,[e("h3",je,g(s.nickname),1),e("p",Fe,g(s.gender)+", "+g(s.age)+"å², "+g(s.hikingLevel),1),e("p",Ie,"æœ€è¿‘æ´»åŠ¨: "+g(s.recentActivity),1)])])],4)],8,we))),128))])):(v(),u("div",Se,[...t[16]||(t[16]=[e("div",{class:"text-6xl mb-4"},"ğŸ”",-1),e("p",{class:"text-gray-600 text-lg"},"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å¾’æ­¥ä¼™ä¼´",-1),e("p",{class:"text-gray-500 text-sm mt-2"},"è¯•è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰æ¡ä»¶",-1)])]))])]))}}),Oe=H(ze,[["__scopeId","data-v-fe7f790b"]]);export{Oe as default};
