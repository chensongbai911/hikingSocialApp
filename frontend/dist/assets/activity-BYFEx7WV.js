import{d as A}from"./state-WzMdx_T8.js";import{a as l}from"./index-BQQdwWu-.js";import{r as y,d as g}from"./vue-Eb8ZdQV1.js";const o={async getActivities(a){return l.get("/activities",{params:a})},async getActivityDetail(a){return l.get(`/activities/${a}`)},async createActivity(a){return l.post("/activities",a)},async updateActivity(a,n){return l.put(`/activities/${a}`,n)},async deleteActivity(a){return l.delete(`/activities/${a}`)},async joinActivity(a){return l.post(`/activities/${a}/join`)},async leaveActivity(a){return l.post(`/activities/${a}/leave`)},async getMyJoinedActivities(a){return l.get("/activities/my-joined",{params:a})},async getMyCreatedActivities(a){return l.get("/activities/my-created",{params:a})}},S=A("activity",()=>{const a=y([]),n=y(null),r=y(!1),s=y(null),u=y({page:1,page_size:10,total:0,total_pages:0}),f=g(()=>a.value.length>0);return{activities:a,currentActivity:n,loading:r,error:s,pagination:u,hasActivities:f,fetchActivities:async i=>{r.value=!0,s.value=null;try{const t=await o.getActivities(i);if(t.code===200&&t.data){const e=t.data;a.value=e.items,u.value=e.pagination}}catch(t){s.value=t.message||"获取活动列表失败",console.error("Fetch activities error:",t)}finally{r.value=!1}},fetchActivityDetail:async i=>{r.value=!0,s.value=null;try{const t=await o.getActivityDetail(i);t.code===200&&t.data&&(n.value=t.data)}catch(t){s.value=t.message||"获取活动详情失败",console.error("Fetch activity detail error:",t)}finally{r.value=!1}},createActivity:async i=>{r.value=!0,s.value=null;try{const t=await o.createActivity(i);if(t.code===201&&t.data){const e=t.data;return a.value.unshift(e),e}throw new Error(t.message||"创建活动失败")}catch(t){throw s.value=t.message||"创建活动失败",console.error("Create activity error:",t),t}finally{r.value=!1}},updateActivity:async(i,t)=>{var e;r.value=!0,s.value=null;try{const c=await o.updateActivity(i,t);if(c.code===200&&c.data){const v=c.data,d=a.value.findIndex(p=>p.id===i);return d!==-1&&(a.value[d]=v),((e=n.value)==null?void 0:e.id)===i&&(n.value=v),v}throw new Error(c.message||"更新活动失败")}catch(c){throw s.value=c.message||"更新活动失败",console.error("Update activity error:",c),c}finally{r.value=!1}},deleteActivity:async i=>{var t;r.value=!0,s.value=null;try{const e=await o.deleteActivity(i);(e.code===204||e.code===200)&&(a.value=a.value.filter(c=>c.id!==i),((t=n.value)==null?void 0:t.id)===i&&(n.value=null))}catch(e){throw s.value=e.message||"删除活动失败",console.error("Delete activity error:",e),e}finally{r.value=!1}},joinActivity:async i=>{var t;r.value=!0,s.value=null;try{const e=await o.joinActivity(i);if(e.code===201||e.code===200){const c=a.value.find(v=>v.id===i);c&&(c.is_joined=!0,c.participant_count!==void 0&&c.participant_count++),((t=n.value)==null?void 0:t.id)===i&&(n.value.is_joined=!0,n.value.participant_count!==void 0&&n.value.participant_count++)}}catch(e){throw s.value=e.message||"参加活动失败",console.error("Join activity error:",e),e}finally{r.value=!1}},leaveActivity:async i=>{var t;r.value=!0,s.value=null;try{const e=await o.leaveActivity(i);if(e.code===204||e.code===200){const c=a.value.find(v=>v.id===i);c&&(c.is_joined=!1,c.participant_count!==void 0&&c.participant_count>0&&c.participant_count--),((t=n.value)==null?void 0:t.id)===i&&(n.value.is_joined=!1,n.value.participant_count!==void 0&&n.value.participant_count>0&&n.value.participant_count--)}}catch(e){throw s.value=e.message||"退出活动失败",console.error("Leave activity error:",e),e}finally{r.value=!1}},fetchMyJoinedActivities:async i=>{r.value=!0,s.value=null;try{const t=await o.getMyJoinedActivities(i);if(t.code===200&&t.data){const e=t.data;a.value=e.items,u.value=e.pagination}}catch(t){s.value=t.message||"获取参加的活动失败",console.error("Fetch joined activities error:",t)}finally{r.value=!1}},fetchMyCreatedActivities:async i=>{r.value=!0,s.value=null;try{const t=await o.getMyCreatedActivities(i);if(t.code===200&&t.data){const e=t.data;a.value=e.items,u.value=e.pagination}}catch(t){s.value=t.message||"获取创建的活动失败",console.error("Fetch created activities error:",t)}finally{r.value=!1}},clearCurrentActivity:()=>{n.value=null},reset:()=>{a.value=[],n.value=null,r.value=!1,s.value=null,u.value={page:1,page_size:10,total:0,total_pages:0}}}});export{S as u};
