import{r as d,k as J,J as K,d as $,l as W,v as g,q as m,z as t,x as M,L as U,M as C,O as L,P as A,A as p,Q as V,y as D}from"./vue-Dq4PaVdn.js";import{d as X}from"./state-COm4LJOs.js";import{a as F,b as Y,_ as Z}from"./index-BHhpTfea.js";const R={async getRecommendedActivities(u){return F.get("/discovery/activities",{params:u})},async getRecommendedUsers(u){return F.get("/discovery/users",{params:u})},async searchActivities(u){return F.get("/discovery/search/activities",{params:u})},async searchUsers(u){return F.get("/discovery/search/users",{params:u})}},T=X("discovery",()=>{const u=d([]),_=d([]),f=d([]),n=d(!1),i=d(null),y=d({page:1,page_size:10,total:0,total_pages:0}),h=d({keyword:"",difficulty:void 0,location:void 0,gender:void 0,hiking_level:void 0}),S=async v=>{n.value=!0,i.value=null;try{const a=await R.getRecommendedActivities(v);if(a.code===200&&a.data){const r=a.data;u.value=r.items,y.value=r.pagination}}catch(a){i.value=a.message||"è·å–æ¨èæ´»åŠ¨å¤±è´¥",console.error("Fetch recommended activities error:",a)}finally{n.value=!1}},o=async v=>{n.value=!0,i.value=null;try{const a=await R.getRecommendedUsers(v);if(a.code===200&&a.data){const r=a.data;_.value=r.items,y.value=r.pagination}}catch(a){i.value=a.message||"è·å–æ¨èç”¨æˆ·å¤±è´¥",console.error("Fetch recommended users error:",a)}finally{n.value=!1}},c=async v=>{n.value=!0,i.value=null;try{const a=await R.searchActivities(v);if(a.code===200&&a.data){const r=a.data;f.value=r.items,y.value=r.pagination}}catch(a){i.value=a.message||"æœç´¢æ´»åŠ¨å¤±è´¥",console.error("Search activities error:",a)}finally{n.value=!1}},b=async v=>{n.value=!0,i.value=null;try{const a=await R.searchUsers(v);if(a.code===200&&a.data){const r=a.data;f.value=r.items,y.value=r.pagination}}catch(a){i.value=a.message||"æœç´¢ç”¨æˆ·å¤±è´¥",console.error("Search users error:",a)}finally{n.value=!1}},k=v=>{h.value={...h.value,...v}},w=()=>{h.value={keyword:"",difficulty:void 0,location:void 0,gender:void 0,hiking_level:void 0}};return{recommendedActivities:u,recommendedUsers:_,searchResults:f,loading:n,error:i,pagination:y,filters:h,fetchRecommendedActivities:S,fetchRecommendedUsers:o,searchActivities:c,searchUsers:b,updateFilters:k,clearFilters:w,reset:()=>{u.value=[],_.value=[],f.value=[],n.value=!1,i.value=null,y.value={page:1,page_size:10,total:0,total_pages:0},w()}}}),ee={class:"discover-page min-h-screen bg-white pb-24"},te={class:"bg-white pt-6 pb-4 px-4 border-b border-gray-100 sticky top-0 z-10"},se={class:"container mx-auto"},ae={class:"relative"},le={key:0,class:"fixed inset-0 bg-white z-50 overflow-y-auto",style:{"padding-top":"env(safe-area-inset-top)"}},ne={class:"min-h-screen"},oe={class:"flex items-center justify-between px-4 py-4 border-b border-gray-100"},ie={class:"px-4 py-6 space-y-8"},re={class:"flex gap-3"},de=["onClick"],ce={class:"px-2"},ue={class:"flex justify-between mb-3"},ve={class:"text-2xl font-bold text-gray-800"},ge={class:"text-2xl font-bold text-gray-800"},me={class:"relative"},pe={class:"h-2 bg-gray-200 rounded-full relative"},fe={class:"flex gap-3"},ye=["onClick"],be={class:"flex gap-3 flex-wrap"},xe=["onClick"],he={class:"flex items-center justify-between mb-4"},_e={class:"text-teal-500 text-base font-semibold"},we={class:"px-2"},ke={class:"h-2 bg-gray-200 rounded-full relative overflow-hidden"},Ue={class:"container mx-auto px-3 py-6"},Ce={key:0,class:"flex justify-center py-12"},Le={key:1,class:"grid grid-cols-2 gap-3"},Ae=["onClick"],Fe=["src","alt"],Re={key:1,class:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"},Se={class:"absolute inset-0 flex flex-col justify-between p-4"},je={class:"flex justify-between items-start"},ze={class:"px-3 py-1 bg-white/90 backdrop-blur text-xs font-semibold text-gray-700 rounded-full"},$e={class:"space-y-1"},Me={class:"font-bold text-white text-base"},Ve={class:"text-xs text-white/90"},De={class:"text-xs text-white/80"},Ie={key:2,class:"text-center py-12"},Oe=J({__name:"Discover",setup(u){const _=K(),f=T(),n=d(""),i=d(!1),y=["ç”·","å¥³"],h=["æ–°æ‰‹","ä¸­çº§","é«˜æ‰‹"],S=["æ‘„å½±","éœ²è¥","ç¾é£Ÿ","å® ç‰©"],o=d({gender:[],level:[],interests:[]}),c=d([18,50]),b=d(50),k=["linear-gradient(135deg, #ffb6c1 0%, #ffd700 100%)","linear-gradient(135deg, #4db8a8 0%, #d4e157 100%)","linear-gradient(135deg, #d4a574 0%, #f4a460 100%)","linear-gradient(135deg, #8b7355 0%, #f4e4c1 100%)","linear-gradient(135deg, #c9b998 0%, #6b5b4a 100%)","linear-gradient(135deg, #5f9ea0 0%, #e0f7fa 100%)"],w=$(()=>f.recommendedUsers),I=$(()=>f.loading),v=d(new Map),a=d(new Map),r=l=>l?{beginner:"æ–°æ‰‹",intermediate:"ä¸­çº§",advanced:"é«˜æ‰‹",expert:"ä¸“å®¶"}[l]||l:"æ–°æ‰‹",O=$(()=>w.value.map((e,s)=>({id:e.id,nickname:e.nickname,gender:e.gender==="male"?"ç”·":e.gender==="female"?"å¥³":"å…¶ä»–",age:e.age||0,bio:e.bio||"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡å†™...",hikingLevel:r(e.hiking_level),level:r(e.hiking_level),tags:e.preferences?e.preferences.map(x=>x.preference_value):[],recentActivity:"æœ€è¿‘æ´»è·ƒ",avatar:e.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=user${e.id}`,coverImage:e.avatar_url||"",gradient:k[s%k.length],commonPreferences:e.common_preferences||0,isFollowing:v.value.get(e.id)??!1,followingLoading:a.value.get(e.id)??!1})).filter(e=>{const s=n.value.toLowerCase(),x=!n.value||e.nickname.toLowerCase().includes(s)||e.bio.toLowerCase().includes(s)||e.tags.length>0&&e.tags.some(z=>z.toLowerCase().includes(s)),q=o.value.gender.length===0||o.value.gender.includes(e.gender),E=e.age===0||e.age>=c.value[0]&&e.age<=c.value[1],G=o.value.level.length===0||o.value.level.includes(e.hikingLevel),H=o.value.interests.length===0||e.tags.length>0&&o.value.interests.some(z=>e.tags.includes(z));return x&&q&&E&&G&&H})),j=(l,e)=>{const s=o.value[l].indexOf(e);s>-1?o.value[l].splice(s,1):o.value[l].push(e)},B=()=>{o.value={gender:[],level:[],interests:[]},c.value=[18,50],b.value=50,n.value=""},P=l=>{_.push({name:"user-profile",params:{id:l}})},N=async()=>{try{await f.fetchRecommendedUsers({page:1,page_size:20})}catch(l){console.error("åŠ è½½æ¨èç”¨æˆ·å¤±è´¥:",l)}},Q=async l=>{try{const e=await Y.getFollowStatus(String(l));e.code===200&&e.data&&v.value.set(l,e.data.is_following)}catch(e){console.error(`åŠ è½½å…³æ³¨çŠ¶æ€å¤±è´¥ (${l}):`,e)}};return W(async()=>{await N();for(const l of w.value)await Q(l.id)}),(l,e)=>(m(),g("div",ee,[t("div",te,[t("div",se,[e[8]||(e[8]=t("div",{class:"flex items-center justify-center mb-4"},[t("h1",{class:"text-2xl font-bold text-gray-800"},"å‘ç°å¾’æ­¥ä¼´ä¾£")],-1)),t("div",ae,[e[7]||(e[7]=t("span",{class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"},"ğŸ”",-1)),U(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>n.value=s),type:"text",placeholder:"æœç´¢æ˜µç§°æˆ–å…±åŒä¹‰è¶£",class:"w-full pl-12 pr-14 py-3 bg-gray-100 rounded-full border-0 focus:outline-none focus:ring-2 focus:ring-green-500 transition"},null,512),[[C,n.value]]),t("button",{onClick:e[1]||(e[1]=s=>i.value=!0),class:"absolute right-2 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-white rounded-full flex items-center justify-center hover:bg-gray-50 transition shadow-sm",title:"ç­›é€‰"},[...e[6]||(e[6]=[t("span",{class:"text-lg"},"âš™ï¸",-1)])])])])]),i.value?(m(),g("div",le,[t("div",ne,[t("div",oe,[t("button",{onClick:B,class:"text-gray-600 text-base font-medium"}," é‡ç½® "),e[9]||(e[9]=t("h2",{class:"text-lg font-bold text-gray-800"},"ç­›é€‰",-1)),t("button",{onClick:e[2]||(e[2]=s=>i.value=!1),class:"px-6 py-2 bg-teal-500 text-white rounded-full text-sm font-medium hover:bg-teal-600 transition"}," å®Œæˆ ")]),t("div",ie,[t("div",null,[e[10]||(e[10]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"æ€§åˆ«",-1)),t("div",re,[(m(),g(L,null,A(y,s=>t("button",{key:s,onClick:x=>j("gender",s),class:D(["flex-1 py-3 rounded-full font-medium text-base transition",o.value.gender.includes(s)?"bg-teal-500 text-white":"bg-gray-100 text-gray-700"])},p(s),11,de)),64))])]),t("div",null,[e[11]||(e[11]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"å¹´é¾„èŒƒå›´",-1)),t("div",ce,[t("div",ue,[t("span",ve,p(c.value[0]),1),t("span",ge,p(c.value[1]),1)]),t("div",me,[U(t("input",{type:"range","onUpdate:modelValue":e[3]||(e[3]=s=>c.value[0]=s),min:"18",max:"50",class:"range-slider",style:{position:"absolute",width:"100%","pointer-events":"auto"}},null,512),[[C,c.value[0],void 0,{number:!0}]]),U(t("input",{type:"range","onUpdate:modelValue":e[4]||(e[4]=s=>c.value[1]=s),min:"18",max:"50",class:"range-slider",style:{position:"absolute",width:"100%","pointer-events":"auto"}},null,512),[[C,c.value[1],void 0,{number:!0}]]),t("div",pe,[t("div",{class:"absolute h-2 bg-teal-500 rounded-full",style:V({left:(c.value[0]-18)/32*100+"%",right:100-(c.value[1]-18)/32*100+"%"})},null,4)])])])]),t("div",null,[e[12]||(e[12]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"å¾’æ­¥ç»éªŒ",-1)),t("div",fe,[(m(),g(L,null,A(h,s=>t("button",{key:s,onClick:x=>j("level",s),class:D(["flex-1 py-3 rounded-full font-medium text-base transition",o.value.level.includes(s)?"bg-teal-500 text-white":"bg-gray-100 text-gray-700"])},p(s),11,ye)),64))])]),t("div",null,[e[13]||(e[13]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"å…±åŒå…´è¶£",-1)),t("div",be,[(m(),g(L,null,A(S,s=>t("button",{key:s,onClick:x=>j("interests",s),class:D(["px-6 py-3 rounded-full font-medium text-base transition",o.value.interests.includes(s)?"bg-teal-500 text-white":"bg-gray-100 text-gray-700"])},p(s),11,xe)),64))])]),t("div",null,[t("div",he,[e[14]||(e[14]=t("h3",{class:"text-lg font-bold text-gray-800"},"è·ç¦»èŒƒå›´",-1)),t("span",_e,p(b.value)+"kmå†…",1)]),t("div",we,[U(t("input",{type:"range","onUpdate:modelValue":e[5]||(e[5]=s=>b.value=s),min:"1",max:"100",class:"range-slider w-full"},null,512),[[C,b.value,void 0,{number:!0}]]),t("div",ke,[t("div",{class:"absolute h-2 bg-teal-500 rounded-full left-0",style:V({width:b.value+"%"})},null,4)])])])])])])):M("",!0),t("div",Ue,[I.value?(m(),g("div",Ce,[...e[15]||(e[15]=[t("div",{class:"text-center"},[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-500 mx-auto mb-4"}),t("p",{class:"text-gray-600"},"åŠ è½½ä¸­...")],-1)])])):O.value.length>0?(m(),g("div",Le,[(m(!0),g(L,null,A(O.value,s=>(m(),g("div",{key:s.id,class:"user-card group cursor-pointer",onClick:x=>P(s.id)},[t("div",{class:"relative rounded-3xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300",style:V([{"aspect-ratio":"3/4"},{background:s.coverImage?"transparent":s.gradient}])},[s.coverImage?(m(),g("img",{key:0,src:s.coverImage,alt:s.nickname,class:"absolute inset-0 w-full h-full object-cover"},null,8,Fe)):M("",!0),s.coverImage?(m(),g("div",Re)):M("",!0),t("div",Se,[t("div",je,[t("span",ze,p(s.hikingLevel),1)]),t("div",$e,[t("h3",Me,p(s.nickname),1),t("p",Ve,p(s.gender)+", "+p(s.age)+"å², "+p(s.hikingLevel),1),t("p",De,"æœ€è¿‘æ´»åŠ¨: "+p(s.recentActivity),1)])])],4)],8,Ae))),128))])):(m(),g("div",Ie,[...e[16]||(e[16]=[t("div",{class:"text-6xl mb-4"},"ğŸ”",-1),t("p",{class:"text-gray-600 text-lg"},"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å¾’æ­¥ä¼™ä¼´",-1),t("p",{class:"text-gray-500 text-sm mt-2"},"è¯•è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰æ¡ä»¶",-1)])]))])]))}}),Qe=Z(Oe,[["__scopeId","data-v-b9494ab1"]]);export{Qe as default};
