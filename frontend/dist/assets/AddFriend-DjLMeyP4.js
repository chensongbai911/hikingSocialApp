import{r as k,d as B,k as V,v as c,q as n,S as L,L as F,M as $,Q as G,z as t,l as I,p as O,x as m,O as Q,P as X,X as H,G as h,A as v,y as C}from"./vue-B6Xl8iL6.js";import{d as J,s as W}from"./state-BRWMog1q.js";import{s as Y,a as Z,b as ee,c as se,d as te,g as ae,e as ne,r as le,f as ce}from"./friendApi-Bm7JRLHm.js";import{_ as K,k as N,l as ie,t as R}from"./index-C2PV4XN9.js";const oe=J("friend",()=>{const _=k([]),d=k([]),u=k([]),y=k([]),r=k(!1),i=k(null),x=B(()=>_.value.length),w=B(()=>d.value.length),p=async(l,s)=>{r.value=!0,i.value=null;try{const a=await Y({friend_id:l,message:s});if(a.code===200)return a.data;throw i.value=a.message,new Error(a.message)}catch(a){throw i.value=a.message||"å‘é€å¥½å‹è¯·æ±‚å¤±è´¥",a}finally{r.value=!1}},f=async()=>{r.value=!0,i.value=null;try{const l=await Z();l.code===200?_.value=l.data:i.value=l.message}catch(l){i.value=l.message||"èŽ·å–å¥½å‹åˆ—è¡¨å¤±è´¥"}finally{r.value=!1}};return{friends:_,pendingRequests:d,searchResults:u,recommendedUsers:y,loading:r,error:i,friendCount:x,pendingRequestCount:w,sendFriendRequest:p,fetchFriends:f,fetchPendingRequests:async()=>{r.value=!0,i.value=null;try{const l=await ee();l.code===200?d.value=l.data:i.value=l.message}catch(l){i.value=l.message||"èŽ·å–å¥½å‹è¯·æ±‚å¤±è´¥"}finally{r.value=!1}},searchUsers:async l=>{if(!l.trim()){u.value=[];return}r.value=!0,i.value=null;try{const s=await se(l);s.code===200?u.value=s.data:(i.value=s.message,u.value=[])}catch(s){i.value=s.message||"æœç´¢ç”¨æˆ·å¤±è´¥",u.value=[]}finally{r.value=!1}},fetchRecommendedUsers:async(l=10)=>{r.value=!0,i.value=null;try{const s=await te(l);s.code===200?y.value=s.data:i.value=s.message}catch(s){i.value=s.message||"èŽ·å–æŽ¨èç”¨æˆ·å¤±è´¥"}finally{r.value=!1}},getFriendshipStatus:async l=>{try{const s=await ae(l);return s.code===200?s.data.status:null}catch(s){return console.error("èŽ·å–å¥½å‹å…³ç³»çŠ¶æ€å¤±è´¥:",s),null}},acceptFriendRequest:async l=>{r.value=!0,i.value=null;try{const s=await ne(l);if(s.code===200){const a=d.value.findIndex(o=>o.user_id===l);return a!==-1&&d.value.splice(a,1),await f(),s.data}else throw i.value=s.message,new Error(s.message)}catch(s){throw i.value=s.message||"æŽ¥å—å¥½å‹è¯·æ±‚å¤±è´¥",s}finally{r.value=!1}},rejectFriendRequest:async l=>{r.value=!0,i.value=null;try{const s=await le(l);if(s.code===200){const a=d.value.findIndex(o=>o.user_id===l);return a!==-1&&d.value.splice(a,1),s.data}else throw i.value=s.message,new Error(s.message)}catch(s){throw i.value=s.message||"æ‹’ç»å¥½å‹è¯·æ±‚å¤±è´¥",s}finally{r.value=!1}},removeFriend:async l=>{r.value=!0,i.value=null;try{const s=await ce(l);if(s.code===200){const a=_.value.findIndex(o=>o.user_id===l);a!==-1&&_.value.splice(a,1)}else throw i.value=s.message,new Error(s.message)}catch(s){throw i.value=s.message||"åˆ é™¤å¥½å‹å¤±è´¥",s}finally{r.value=!1}},clearSearchResults:()=>{u.value=[]},clearFriendData:()=>{_.value=[],d.value=[],u.value=[],y.value=[],i.value=null}}}),re={class:"skeleton"},de={key:0,class:"skeleton-card"},ue={key:1,class:"skeleton-list"},ve={key:2,class:"skeleton-user"},he=V({__name:"Skeleton",props:{type:{},count:{},width:{},height:{}},setup(_){return(d,u)=>(n(),c("div",re,[_.type==="card"?(n(),c("div",de,[...u[0]||(u[0]=[L('<div class="skeleton-image" data-v-06814528></div><div class="skeleton-content" data-v-06814528><div class="skeleton-title" data-v-06814528></div><div class="skeleton-text" data-v-06814528></div><div class="skeleton-text short" data-v-06814528></div></div>',2)])])):_.type==="list"?(n(),c("div",ue,[(n(!0),c(F,null,$(_.count,y=>(n(),c("div",{key:y,class:"skeleton-list-item"},[...u[1]||(u[1]=[t("div",{class:"skeleton-avatar"},null,-1),t("div",{class:"skeleton-list-content"},[t("div",{class:"skeleton-title"}),t("div",{class:"skeleton-text"})],-1)])]))),128))])):_.type==="user"?(n(),c("div",ve,[...u[2]||(u[2]=[L('<div class="skeleton-avatar large" data-v-06814528></div><div class="skeleton-user-info" data-v-06814528><div class="skeleton-title" data-v-06814528></div><div class="skeleton-text" data-v-06814528></div><div class="skeleton-text short" data-v-06814528></div></div>',2)])])):(n(),c("div",{key:3,class:"skeleton-block",style:G({width:_.width,height:_.height})},null,4))]))}}),_e=K(he,[["__scopeId","data-v-06814528"]]),me={class:"add-friend"},ge={class:"search-section"},fe={class:"search-box"},ke=["disabled"],ye={key:0},pe={key:1},be={key:1,class:"section"},we={class:"user-list"},Re=["src","alt"],Fe={class:"user-info"},$e={class:"nickname"},xe={key:0,class:"bio"},Se={class:"meta"},Ce={key:0,class:"gender"},qe=["onClick","disabled"],Ue={key:0},Te={key:1},je={key:2,class:"section"},De={class:"section-title"},Me=["disabled"],Pe={class:"user-list"},Ee=["src","alt"],ze={class:"user-info"},Ae={class:"nickname"},Be={key:0,class:"bio"},Le={key:1,class:"tags"},Ne={class:"meta"},Ve={key:0,class:"mutual"},Ke=["onClick","disabled"],Ge={key:0},Ie={key:1},Oe={key:3,class:"section"},Qe={class:"section-title"},Xe={class:"request-list"},He=["src","alt"],Je={class:"request-info"},We={class:"nickname"},Ye={key:0,class:"message"},Ze={class:"meta"},es={class:"time"},ss={class:"request-actions"},ts=["onClick","disabled"],as=["onClick","disabled"],ns={key:4,class:"section"},ls={class:"section-title"},cs={class:"friend-grid"},is=["src","alt"],os={class:"nickname"},rs=V({__name:"AddFriend",setup(_){const d=oe(),{friends:u,friendCount:y,pendingRequests:r,searchResults:i,recommendedUsers:x,loading:w}=W(d),p=k(""),f=k(null),b=k(null);I(async()=>{const a=N.get("cached_friends");a&&(u.value=a),await Promise.all([d.fetchFriends(),d.fetchPendingRequests(),S()]),N.set("cached_friends",u.value,5*60*1e3)});const T=ie(async a=>{a.trim()&&await d.searchUsers(a.trim())},300),j=()=>{T(p.value)},q=async()=>{p.value.trim()&&await d.searchUsers(p.value.trim())},S=async()=>{await d.fetchRecommendedUsers(10)},U=async a=>{try{f.value=a,await d.sendFriendRequest(a),R.success("å¥½å‹è¯·æ±‚å·²å‘é€"),d.clearSearchResults(),await S()}catch(o){R.error(o.message||"å‘é€å¤±è´¥")}finally{f.value=null}},D=async a=>{try{b.value=a,await d.acceptFriendRequest(a),R.success("å·²æŽ¥å—å¥½å‹è¯·æ±‚")}catch(o){R.error(o.message||"æŽ¥å—å¤±è´¥")}finally{b.value=null}},M=async a=>{try{b.value=a,await d.rejectFriendRequest(a),R.info("å·²æ‹’ç»å¥½å‹è¯·æ±‚")}catch(o){R.error(o.message||"æ‹’ç»å¤±è´¥")}finally{b.value=null}},P=a=>{const o=new Date(a),g=new Date().getTime()-o.getTime(),E=Math.floor(g/6e4),z=Math.floor(g/36e5),A=Math.floor(g/864e5);return E<60?`${E}åˆ†é’Ÿå‰`:z<24?`${z}å°æ—¶å‰`:A<7?`${A}å¤©å‰`:o.toLocaleDateString("zh-CN")},l=a=>({beginner:"å…¥é—¨",intermediate:"è¿›é˜¶",advanced:"é«˜çº§",expert:"ä¸“å®¶"})[a||"beginner"]||"å…¥é—¨",s=a=>({male:"ç”·",female:"å¥³",other:"å…¶ä»–"})[a||""]||"";return(a,o)=>(n(),c("div",me,[t("div",ge,[t("div",fe,[Q(t("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>p.value=e),type:"text",placeholder:"æœç´¢ç”¨æˆ·æ˜µç§°æˆ–é‚®ç®±",class:"search-input",onInput:j,onKeyup:H(q,["enter"])},null,544),[[X,p.value]]),t("button",{class:"search-btn",onClick:q,disabled:h(w)},[h(w)?(n(),c("span",ye,"æœç´¢ä¸­...")):(n(),c("span",pe,"ðŸ” æœç´¢"))],8,ke)])]),h(w)&&!h(i).length&&!h(x).length?(n(),O(_e,{key:0,type:"list",count:5})):m("",!0),h(i).length>0?(n(),c("div",be,[o[1]||(o[1]=t("h3",{class:"section-title"},"æœç´¢ç»“æžœ",-1)),t("div",we,[(n(!0),c(F,null,$(h(i),e=>(n(),c("div",{key:e.user_id,class:"user-card"},[t("img",{src:e.avatar_url||"/default-avatar.png",alt:e.nickname,class:"avatar"},null,8,Re),t("div",Fe,[t("h4",$e,v(e.nickname),1),e.bio?(n(),c("p",xe,v(e.bio),1)):m("",!0),t("div",Se,[t("span",{class:C(["level",`level-${e.hiking_level}`])},v(l(e.hiking_level)),3),e.gender?(n(),c("span",Ce,v(s(e.gender)),1)):m("",!0)])]),t("button",{class:"btn-add",onClick:g=>U(e.user_id),disabled:f.value===e.user_id},[f.value===e.user_id?(n(),c("span",Ue,"å‘é€ä¸­...")):(n(),c("span",Te,"+ æ·»åŠ "))],8,qe)]))),128))])])):m("",!0),h(x).length>0?(n(),c("div",je,[t("h3",De,[o[2]||(o[2]=t("span",null,"å¯èƒ½è®¤è¯†çš„äºº",-1)),t("button",{class:"refresh-btn",onClick:S,disabled:h(w)}," ðŸ”„ åˆ·æ–° ",8,Me)]),t("div",Pe,[(n(!0),c(F,null,$(h(x),e=>(n(),c("div",{key:e.user_id,class:"user-card"},[t("img",{src:e.avatar_url||"/default-avatar.png",alt:e.nickname,class:"avatar"},null,8,Ee),t("div",ze,[t("h4",Ae,v(e.nickname),1),e.bio?(n(),c("p",Be,v(e.bio),1)):m("",!0),e.common_preferences&&e.common_preferences.length>0?(n(),c("div",Le,[(n(!0),c(F,null,$(e.common_preferences.slice(0,3),g=>(n(),c("span",{key:g,class:"tag"},v(g),1))),128))])):m("",!0),t("div",Ne,[t("span",{class:C(["level",`level-${e.hiking_level}`])},v(l(e.hiking_level)),3),e.mutual_friends_count?(n(),c("span",Ve,v(e.mutual_friends_count)+"ä¸ªå…±åŒå¥½å‹ ",1)):m("",!0)])]),t("button",{class:"btn-add",onClick:g=>U(e.user_id),disabled:f.value===e.user_id},[f.value===e.user_id?(n(),c("span",Ge,"å‘é€ä¸­...")):(n(),c("span",Ie,"+ æ·»åŠ "))],8,Ke)]))),128))])])):m("",!0),h(r).length>0?(n(),c("div",Oe,[t("h3",Qe,"å¥½å‹è¯·æ±‚ ("+v(h(r).length)+")",1),t("div",Xe,[(n(!0),c(F,null,$(h(r),e=>(n(),c("div",{key:e.friendship_id,class:"request-card"},[t("img",{src:e.avatar_url||"/default-avatar.png",alt:e.nickname,class:"avatar"},null,8,He),t("div",Je,[t("h4",We,v(e.nickname),1),e.message?(n(),c("p",Ye,v(e.message),1)):m("",!0),t("div",Ze,[t("span",{class:C(["level",`level-${e.hiking_level}`])},v(l(e.hiking_level)),3),t("span",es,v(P(e.created_at)),1)])]),t("div",ss,[t("button",{class:"btn btn-accept",onClick:g=>D(e.user_id),disabled:b.value===e.user_id}," âœ“ æŽ¥å— ",8,ts),t("button",{class:"btn btn-reject",onClick:g=>M(e.user_id),disabled:b.value===e.user_id}," âœ— æ‹’ç» ",8,as)])]))),128))])])):m("",!0),h(u).length>0?(n(),c("div",ns,[t("h3",ls,"æˆ‘çš„å¥½å‹ ("+v(h(y))+")",1),t("div",cs,[(n(!0),c(F,null,$(h(u),e=>(n(),c("div",{key:e.id,class:"friend-card"},[t("img",{src:e.avatar_url||"/default-avatar.png",alt:e.nickname,class:"avatar"},null,8,is),t("h4",os,v(e.nickname),1),t("span",{class:C(["level",`level-${e.hiking_level}`])},v(l(e.hiking_level)),3)]))),128))])])):m("",!0)]))}}),_s=K(rs,[["__scopeId","data-v-7c4889e1"]]);export{_s as default};
