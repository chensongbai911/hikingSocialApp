import{k as j,J as F,d as I,r as v,l as N,v as a,q as c,z as t,G as R,O as d,P as _,U as C,L as h,M as w,A as p,x as U,y as G}from"./vue-B6Xl8iL6.js";import{u as O,t as l,_ as q}from"./index-C2PV4XN9.js";import{D as J,c as K}from"./constants-C6AqRN9u.js";import"./state-BRWMog1q.js";import"./upload-XmIN79Aa.js";const B=[{province:"北京市",cities:["东城区","西城区","朝阳区","丰台区","石景山区","海淀区","门头沟区","房山区","通州区","顺义区","昌平区","大兴区","怀柔区","平谷区","密云区","延庆区"]},{province:"上海市",cities:["黄浦区","徐汇区","长宁区","静安区","普陀区","虹口区","杨浦区","闵行区","宝山区","嘉定区","浦东新区","金山区","松江区","青浦区","奉贤区","崇明区"]},{province:"天津市",cities:["和平区","河东区","河西区","南开区","河北区","红桥区","东丽区","西青区","津南区","北辰区","武清区","宝坻区","滨海新区","宁河区","静海区","蓟州区"]},{province:"重庆市",cities:["万州区","涪陵区","渝中区","大渡口区","江北区","沙坪坝区","九龙坡区","南岸区","北碚区","綦江区","大足区","渝北区","巴南区","黔江区","长寿区","江津区","合川区","永川区","南川区","璧山区","铜梁区","潼南区","荣昌区","开州区","梁平区","武隆区"]},{province:"河北省",cities:["石家庄市","唐山市","秦皇岛市","邯郸市","邢台市","保定市","张家口市","承德市","沧州市","廊坊市","衡水市"]},{province:"山西省",cities:["太原市","大同市","阳泉市","长治市","晋城市","朔州市","晋中市","运城市","忻州市","临汾市","吕梁市"]},{province:"内蒙古自治区",cities:["呼和浩特市","包头市","乌海市","赤峰市","通辽市","鄂尔多斯市","呼伦贝尔市","巴彦淖尔市","乌兰察布市","兴安盟","锡林郭勒盟","阿拉善盟"]},{province:"辽宁省",cities:["沈阳市","大连市","鞍山市","抚顺市","本溪市","丹东市","锦州市","营口市","阜新市","辽阳市","盘锦市","铁岭市","朝阳市","葫芦岛市"]},{province:"吉林省",cities:["长春市","吉林市","四平市","辽源市","通化市","白山市","松原市","白城市","延边朝鲜族自治州"]},{province:"黑龙江省",cities:["哈尔滨市","齐齐哈尔市","鸡西市","鹤岗市","双鸭山市","大庆市","伊春市","佳木斯市","七台河市","牡丹江市","黑河市","绥化市","大兴安岭地区"]},{province:"江苏省",cities:["南京市","无锡市","徐州市","常州市","苏州市","南通市","连云港市","淮安市","盐城市","扬州市","镇江市","泰州市","宿迁市"]},{province:"浙江省",cities:["杭州市","宁波市","温州市","嘉兴市","湖州市","绍兴市","金华市","衢州市","舟山市","台州市","丽水市"]},{province:"安徽省",cities:["合肥市","芜湖市","蚌埠市","淮南市","马鞍山市","淮北市","铜陵市","安庆市","黄山市","滁州市","阜阳市","宿州市","六安市","亳州市","池州市","宣城市"]},{province:"福建省",cities:["福州市","厦门市","莆田市","三明市","泉州市","漳州市","南平市","龙岩市","宁德市"]},{province:"江西省",cities:["南昌市","景德镇市","萍乡市","九江市","新余市","鹰潭市","赣州市","吉安市","宜春市","抚州市","上饶市"]},{province:"山东省",cities:["济南市","青岛市","淄博市","枣庄市","东营市","烟台市","潍坊市","济宁市","泰安市","威海市","日照市","临沂市","德州市","聊城市","滨州市","菏泽市"]},{province:"河南省",cities:["郑州市","开封市","洛阳市","平顶山市","安阳市","鹤壁市","新乡市","焦作市","濮阳市","许昌市","漯河市","三门峡市","南阳市","商丘市","信阳市","周口市","驻马店市"]},{province:"湖北省",cities:["武汉市","黄石市","十堰市","宜昌市","襄阳市","鄂州市","荆门市","孝感市","荆州市","黄冈市","咸宁市","随州市","恩施土家族苗族自治州"]},{province:"湖南省",cities:["长沙市","株洲市","湘潭市","衡阳市","邵阳市","岳阳市","常德市","张家界市","益阳市","郴州市","永州市","怀化市","娄底市","湘西土家族苗族自治州"]},{province:"广东省",cities:["广州市","韶关市","深圳市","珠海市","汕头市","佛山市","江门市","湛江市","茂名市","肇庆市","惠州市","梅州市","汕尾市","河源市","阳江市","清远市","东莞市","中山市","潮州市","揭阳市","云浮市"]},{province:"广西壮族自治区",cities:["南宁市","柳州市","桂林市","梧州市","北海市","防城港市","钦州市","贵港市","玉林市","百色市","贺州市","河池市","来宾市","崇左市"]},{province:"海南省",cities:["海口市","三亚市","三沙市","儋州市","五指山市","琼海市","文昌市","万宁市","东方市"]},{province:"四川省",cities:["成都市","自贡市","攀枝花市","泸州市","德阳市","绵阳市","广元市","遂宁市","内江市","乐山市","南充市","眉山市","宜宾市","广安市","达州市","雅安市","巴中市","资阳市","阿坝藏族羌族自治州","甘孜藏族自治州","凉山彝族自治州"]},{province:"贵州省",cities:["贵阳市","六盘水市","遵义市","安顺市","毕节市","铜仁市","黔西南布依族苗族自治州","黔东南苗族侗族自治州","黔南布依族苗族自治州"]},{province:"云南省",cities:["昆明市","曲靖市","玉溪市","保山市","昭通市","丽江市","普洱市","临沧市","楚雄彝族自治州","红河哈尼族彝族自治州","文山壮族苗族自治州","西双版纳傣族自治州","大理白族自治州","德宏傣族景颇族自治州","怒江傈僳族自治州","迪庆藏族自治州"]},{province:"西藏自治区",cities:["拉萨市","日喀则市","昌都市","林芝市","山南市","那曲市","阿里地区"]},{province:"陕西省",cities:["西安市","铜川市","宝鸡市","咸阳市","渭南市","延安市","汉中市","榆林市","安康市","商洛市"]},{province:"甘肃省",cities:["兰州市","嘉峪关市","金昌市","白银市","天水市","武威市","张掖市","平凉市","酒泉市","庆阳市","定西市","陇南市","临夏回族自治州","甘南藏族自治州"]},{province:"青海省",cities:["西宁市","海东市","海北藏族自治州","黄南藏族自治州","海南藏族自治州","果洛藏族自治州","玉树藏族自治州","海西蒙古族藏族自治州"]},{province:"宁夏回族自治区",cities:["银川市","石嘴山市","吴忠市","固原市","中卫市"]},{province:"新疆维吾尔自治区",cities:["乌鲁木齐市","克拉玛依市","吐鲁番市","哈密市","昌吉回族自治州","博尔塔拉蒙古自治州","巴音郭楞蒙古自治州","阿克苏地区","克孜勒苏柯尔克孜自治州","喀什地区","和田地区","伊犁哈萨克自治州","塔城地区","阿勒泰地区"]},{province:"香港特别行政区",cities:["香港"]},{province:"澳门特别行政区",cities:["澳门"]},{province:"台湾省",cities:["台北市","新北市","桃园市","台中市","台南市","高雄市"]}],A=m=>{const g=B.find(u=>u.province===m);return g?g.cities:[]},Q=()=>B.map(m=>m.province),W={class:"edit-profile-page h-screen flex flex-col overflow-hidden"},X={class:"flex-1 overflow-y-auto px-4 py-6 pb-20"},Y={class:"flex flex-col items-center mb-6"},Z={class:"relative mb-2"},ee=["src"],te={class:"bg-white rounded-2xl shadow-sm p-5 mb-4"},oe={class:"grid grid-cols-2 gap-4 mb-4"},re={class:"bg-white rounded-2xl shadow-sm p-5"},se={class:"bg-white rounded-2xl shadow-sm p-5"},le={class:"bg-white rounded-2xl shadow-sm p-5 mb-4"},ie={class:"grid grid-cols-2 gap-3"},ne=["value"],ae=["disabled"],ce=["value"],ue={class:"bg-white rounded-2xl shadow-sm p-5 mb-4"},ve={class:"flex items-center justify-between mb-3"},de={class:"text-sm text-gray-400"},pe={class:"bg-white rounded-2xl shadow-sm p-5 mb-4"},ge={key:0,class:"flex flex-wrap gap-2 mb-4"},fe=["onClick"],me={key:1,class:"mt-4 pt-4 border-t border-gray-100"},be={class:"flex flex-wrap gap-2"},xe=["onClick","disabled"],ye=["disabled"],he=j({__name:"EditProfile",setup(m){const g=F(),u=O(),V=J.AVATAR,i=I(()=>u.currentUser),o=v({nickname:"",gender:"other",age:void 0,bio:"",avatar_url:"",province:"",city:"",region:"",preferences:[]}),P=s=>{const e=s.target;e&&(e.src=V)},k=v(!1),M=v(Q()),b=v([]),S=()=>{const s=o.value.province;s?(b.value=A(s),o.value.city=""):(b.value=[],o.value.city="")},E=v(["高难度爬升","重装露营","单身交友","风景摄影","周末出发","休闲徒步","宠物友好","5-10km","10-20km","20km+","爱看风景","挑战自我","团队协作","户外烹饪"]),T=()=>{g.back()},D=()=>{console.log("uploadAvatar 函数被调用");const s=document.createElement("input");s.type="file",s.accept="image/*",s.onchange=async e=>{var f;console.log("文件选择器触发");const n=(f=e.target.files)==null?void 0:f[0];if(n){console.log("选择的文件:",n.name,n.size);try{if(n.size>5*1024*1024){l.error("图片大小不能超过5MB");return}l.info("正在上传头像...");const y=await K(n,400,400,.8);console.log("图片压缩完成，大小:",y.length),o.value.avatar_url=y,l.success("头像上传成功，请点击保存")}catch(y){console.error("上传头像失败:",y),l.error("上传失败，请重试")}}else console.log("没有选择文件")},console.log("触发文件选择器"),s.click()},H=s=>{o.value.preferences.includes(s)||o.value.preferences.push(s)},L=s=>{o.value.preferences.splice(s,1)},x=v(!1),z=async()=>{var s;if(!((s=o.value.nickname)!=null&&s.trim())){l.warning("昵称不能为空");return}if(o.value.nickname.trim().length<2){l.warning("昵称至少2个字符");return}if(o.value.nickname.trim().length>20){l.warning("昵称最多20个字符");return}if(!o.value.province){l.warning("请选择所在地区");return}if(o.value.age&&(o.value.age<18||o.value.age>100)){l.warning("年龄应在18-100之间");return}try{x.value=!0;let e="";o.value.province&&o.value.city?e=`${o.value.province} ${o.value.city}`:o.value.province&&(e=o.value.province);const r={nickname:o.value.nickname.trim(),gender:o.value.gender,age:o.value.age,bio:o.value.bio,avatar_url:o.value.avatar_url,province:o.value.province,city:o.value.city,region:e};if(await u.updateProfile(r)){if(o.value.preferences.length>0&&!await u.updatePreferences(o.value.preferences)){l.error("偏好保存失败，请重试");return}l.success("资料保存成功"),console.log("保存资料成功"),setTimeout(()=>{g.back()},500)}else l.error(u.error||"保存失败"),console.error("保存资料失败:",u.error)}catch(e){l.error("保存失败，请重试"),console.error("保存资料失败:",e)}finally{x.value=!1}},$=async()=>{try{i.value||await u.fetchCurrentUser(!1,!1,!0),i.value&&(o.value={nickname:i.value.nickname,gender:i.value.gender,age:i.value.age,bio:i.value.bio||"",avatar_url:i.value.avatar_url||"",province:i.value.province||"",city:i.value.city||"",region:i.value.region||"",preferences:Array.isArray(i.value.preferences)?i.value.preferences.map(s=>typeof s=="string"?s:s.preference_value).filter(Boolean):[]},o.value.province&&(b.value=A(o.value.province))),console.log("用户资料加载成功")}catch(s){console.error("加载用户资料失败:",s)}};return N(()=>{$()}),(s,e)=>(c(),a("div",W,[t("div",{class:"sticky top-0 z-10 bg-white border-b border-gray-200 flex-shrink-0"},[t("div",{class:"flex items-center justify-between px-4 py-4"},[t("button",{onClick:T,class:"p-2"},[...e[7]||(e[7]=[t("svg",{class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24"},[t("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})],-1)])]),e[8]||(e[8]=t("h1",{class:"text-xl font-bold text-gray-800"},"编辑资料",-1)),t("button",{onClick:z,class:"text-teal-500 font-semibold"}," 保存 ")])]),t("div",X,[t("div",Y,[t("div",Z,[t("img",{src:o.value.avatar_url||R(V),alt:"avatar",class:"w-28 h-28 rounded-full object-cover border-4 border-white shadow-lg",onError:P},null,40,ee),t("button",{onClick:D,class:"absolute bottom-0 right-0 w-10 h-10 bg-teal-500 rounded-full flex items-center justify-center border-4 border-white hover:bg-teal-600 transition-colors"},[...e[9]||(e[9]=[t("svg",{class:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[t("path",{d:"M3 4V1h2v3h3v2H5v3H3V6H0V4h3zm3 6V7h3V4h7l1.83 2H21c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V10h3zm7 9c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-3.2-5c0 1.77 1.43 3.2 3.2 3.2s3.2-1.43 3.2-3.2-1.43-3.2-3.2-3.2-3.2 1.43-3.2 3.2z"})],-1)])])]),e[10]||(e[10]=t("p",{class:"text-sm text-gray-500"},"点击修改头像",-1))]),t("div",te,[e[11]||(e[11]=t("label",{class:"block text-sm font-semibold text-gray-500 mb-3"},"昵称",-1)),d(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.value.nickname=r),type:"text",placeholder:"请输入昵称",class:"w-full px-4 py-3 bg-gray-50 rounded-xl border-0 focus:ring-2 focus:ring-teal-500 outline-none text-gray-800"},null,512),[[_,o.value.nickname]])]),t("div",oe,[t("div",re,[e[13]||(e[13]=t("label",{class:"block text-sm font-semibold text-gray-500 mb-3"},"性别",-1)),d(t("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.value.gender=r),class:"w-full px-4 py-3 bg-gray-50 rounded-xl border-0 focus:ring-2 focus:ring-teal-500 outline-none text-gray-800"},[...e[12]||(e[12]=[t("option",{value:"male"},"男",-1),t("option",{value:"female"},"女",-1),t("option",{value:"other"},"其他",-1)])],512),[[C,o.value.gender]])]),t("div",se,[e[14]||(e[14]=t("label",{class:"block text-sm font-semibold text-gray-500 mb-3"},"年龄",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.value.age=r),type:"number",placeholder:"请输入年龄",class:"w-full px-4 py-3 bg-gray-50 rounded-xl border-0 focus:ring-2 focus:ring-teal-500 outline-none text-gray-800"},null,512),[[_,o.value.age,void 0,{number:!0}]])])]),t("div",le,[e[17]||(e[17]=t("label",{class:"block text-sm font-semibold text-gray-500 mb-3"},"所在地区",-1)),t("div",ie,[d(t("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.value.province=r),onChange:S,class:"px-4 py-3 bg-gray-50 rounded-xl border-0 focus:ring-2 focus:ring-teal-500 outline-none text-gray-800"},[e[15]||(e[15]=t("option",{value:""},"请选择省份",-1)),(c(!0),a(h,null,w(M.value,r=>(c(),a("option",{key:r,value:r},p(r),9,ne))),128))],544),[[C,o.value.province]]),d(t("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.value.city=r),disabled:!o.value.province,class:"px-4 py-3 bg-gray-50 rounded-xl border-0 focus:ring-2 focus:ring-teal-500 outline-none text-gray-800 disabled:opacity-50 disabled:cursor-not-allowed"},[e[16]||(e[16]=t("option",{value:""},"请选择城市",-1)),(c(!0),a(h,null,w(b.value,r=>(c(),a("option",{key:r,value:r},p(r),9,ce))),128))],8,ae),[[C,o.value.city]])])]),t("div",ue,[t("div",ve,[e[18]||(e[18]=t("label",{class:"text-sm font-semibold text-gray-500"},"关于我",-1)),t("span",de,p((o.value.bio||"").length)+"/100",1)]),d(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.value.bio=r),placeholder:"介绍一下自己吧...",maxlength:"100",rows:"4",class:"w-full px-4 py-3 bg-gray-50 rounded-xl border-0 focus:ring-2 focus:ring-teal-500 outline-none text-gray-800 resize-none"},null,512),[[_,o.value.bio]])]),t("div",pe,[e[22]||(e[22]=t("label",{class:"block text-sm font-semibold text-gray-500 mb-3"},"徒步偏好",-1)),o.value.preferences.length>0?(c(),a("div",ge,[(c(!0),a(h,null,w(o.value.preferences,(r,n)=>(c(),a("div",{key:n,class:"flex items-center gap-2 px-4 py-2 bg-teal-50 text-teal-600 rounded-full text-sm font-medium"},[t("span",null,p(r),1),t("button",{onClick:f=>L(n),class:"hover:text-teal-800"},[...e[19]||(e[19]=[t("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[t("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])],8,fe)]))),128))])):U("",!0),t("button",{onClick:e[6]||(e[6]=r=>k.value=!k.value),class:"flex items-center gap-2 px-4 py-2 border-2 border-dashed border-teal-300 text-teal-500 rounded-full text-sm font-medium hover:bg-teal-50 transition-colors"},[...e[20]||(e[20]=[t("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[t("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1),t("span",null,"添加偏好",-1)])]),k.value?(c(),a("div",me,[e[21]||(e[21]=t("p",{class:"text-sm text-gray-500 mb-3"},"推荐标签",-1)),t("div",be,[(c(!0),a(h,null,w(E.value,(r,n)=>(c(),a("button",{key:n,onClick:f=>H(r),disabled:o.value.preferences.includes(r),class:G(["px-4 py-2 rounded-full text-sm font-medium transition-colors",o.value.preferences.includes(r)?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-100 text-gray-600 hover:bg-teal-50 hover:text-teal-600"])},p(r),11,xe))),128))])])):U("",!0)]),t("button",{onClick:z,disabled:x.value,class:"w-full py-4 bg-teal-500 text-white rounded-2xl font-semibold text-lg hover:bg-teal-600 transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed"},p(x.value?"保存中...":"保存修改"),9,ye)])]))}}),ze=q(he,[["__scopeId","data-v-ea62a235"]]);export{ze as default};
