import{k as G,J,E as X,r as a,l as Q,W as Y,n as Z,v as o,q as l,z as t,x,G as ee,A as h,O as B,P as $,y as u,K as y,L as te,M as se,X as ne,S as oe}from"./vue-Eb8ZdQV1.js";const le={class:"fixed inset-0 bg-white flex flex-col z-40"},ae={class:"bg-white border-b border-gray-100 p-4 flex items-center space-x-3 flex-shrink-0"},ie=["src","alt"],re={class:"flex-1"},ue={class:"font-medium text-gray-800"},de={class:"text-xs text-gray-500"},ce=["src","alt"],ve={class:"break-words"},pe={key:1,class:"rounded-2xl overflow-hidden"},fe=["src","onClick"],he=["onClick"],me={class:"text-sm"},ge={class:"bg-white border-t border-gray-100 p-4 flex-shrink-0"},we={key:0,class:"mb-3 p-3 bg-gray-50 rounded-2xl grid grid-cols-8 gap-2 max-h-48 overflow-y-auto"},xe=["onClick"],ye={class:"flex items-end space-x-1.5"},ke={class:"flex-1 bg-gray-50 rounded-2xl flex items-center min-w-0"},be=["disabled"],Ce={key:1,class:"mt-3 text-center"},Me={class:"inline-flex items-center space-x-2 bg-red-50 text-red-600 px-4 py-2 rounded-full"},De={class:"text-sm font-medium"},_e=["src"],Te=G({__name:"ChatWindow",setup(Oe){const L=J(),M=X(),d=a(""),k=a(),D=a(),c=a(),i=a(!1),p=a(!1),v=a(0),m=a(null);let r=null,_=0;const f=a({id:M.params.id,name:"æŽåŽ (å¾’æ­¥è¾¾äºº)",avatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop",isOnline:!0}),V=()=>{const n=M.params.id,e={1:{id:"1",name:"æŽåŽ (å¾’æ­¥è¾¾äºº)",avatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop",isOnline:!0},2:{id:"2",name:"å°ç¾Ž",avatar:"https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop",isOnline:!1},3:{id:"3",name:"å¼ ä¸‰-é¢†é˜Ÿ",avatar:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop",isOnline:!1},4:{id:"4",name:"çŽ‹äº”",avatar:"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=100&h=100&fit=crop",isOnline:!1}};f.value=e[n]||e[1]},g=a([{id:"1",type:"text",content:"ä½ å¥½ï¼å‘¨å…­çš„é¦™å±±å¾’æ­¥æ´»åŠ¨ç¡®å®šäº†å—ï¼Ÿ",isOwn:!1,timestamp:new Date(Date.now()-36e5)},{id:"2",type:"text",content:"ç¡®å®šäº†ï¼æˆ‘ä»¬æ—©ä¸Š8ç‚¹åœ¨å—é—¨é›†åˆ",isOwn:!0,timestamp:new Date(Date.now()-3e6)},{id:"3",type:"image",content:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=300&fit=crop",isOwn:!1,timestamp:new Date(Date.now()-18e5)},{id:"4",type:"text",content:"çœ‹è¿™é‡Œçš„é£Žæ™¯å¤šç¾Žï¼ðŸ˜Š",isOwn:!1,timestamp:new Date(Date.now()-18e5)}]),R=["ðŸ˜Š","ðŸ˜‚","â¤ï¸","ðŸ‘","ðŸ™","ðŸ˜","ðŸ˜­","ðŸ¤”","ðŸ‘","ðŸŽ‰","ðŸ”¥","ðŸ’ª","ðŸŒŸ","âœ¨","ðŸŒˆ","ðŸŒ¸","ðŸŒº","ðŸŒ»","ðŸŒž","ðŸŒ™","â­","ðŸ’«","âœ…","âŒ"];Q(()=>{V(),w(),document.addEventListener("click",O)}),Y(()=>{r&&clearInterval(r),document.removeEventListener("click",O)});const O=()=>{i.value&&(i.value=!1)},w=()=>{Z(()=>{k.value&&(k.value.scrollTop=k.value.scrollHeight)})},E=n=>{const s=new Date().getTime()-n.getTime();return s<6e4?"åˆšåˆš":s<36e5?`${Math.floor(s/6e4)}åˆ†é’Ÿå‰`:s<864e5?n.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):n.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},U=()=>{if(c.value){c.value.style.height="auto";const n=Math.min(c.value.scrollHeight,128);c.value.style.height=`${n}px`}},I=()=>{if(!d.value.trim())return;const n={id:Date.now().toString(),type:"text",content:d.value.trim(),isOwn:!0,timestamp:new Date};g.value.push(n),d.value="",i.value=!1,c.value&&(c.value.style.height="auto"),w(),setTimeout(()=>{const e={id:(Date.now()+1).toString(),type:"text",content:"æ”¶åˆ°ï¼ðŸ‘",isOwn:!1,timestamp:new Date};g.value.push(e),w()},1e3)},H=n=>{n.stopPropagation(),i.value=!i.value},N=n=>{var e;d.value+=n,(e=c.value)==null||e.focus()},P=()=>{var n;i.value=!1,(n=D.value)==null||n.click()},A=n=>{const e=n.target,s=e.files;s&&s.length>0&&(Array.from(s).forEach(b=>{const z=new FileReader;z.onload=W=>{var S;const q={id:Date.now().toString()+Math.random(),type:"image",content:(S=W.target)==null?void 0:S.result,isOwn:!0,timestamp:new Date};g.value.push(q),w()},z.readAsDataURL(b)}),e.value="")},T=()=>{p.value||(p.value=!0,v.value=0,_=Date.now(),r=window.setInterval(()=>{v.value=Math.floor((Date.now()-_)/1e3),v.value>=60&&C()},100))},C=()=>{if(p.value){if(r&&(clearInterval(r),r=null),v.value>=1){const n={id:Date.now().toString(),type:"voice",content:"voice_message",isOwn:!0,timestamp:new Date,duration:v.value};g.value.push(n),w()}p.value=!1,v.value=0}},j=()=>{r&&(clearInterval(r),r=null),p.value=!1,v.value=0},F=n=>{console.log("æ’­æ”¾è¯­éŸ³æ¶ˆæ¯:",n.id,"æ—¶é•¿:",n.duration)},K=n=>{m.value=n};return(n,e)=>(l(),o("div",le,[t("div",ae,[t("button",{onClick:e[0]||(e[0]=s=>ee(L).back()),class:"p-2 -ml-2"},[...e[7]||(e[7]=[t("svg",{class:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),t("img",{src:f.value.avatar,alt:f.value.name,class:"w-10 h-10 rounded-full object-cover"},null,8,ie),t("div",re,[t("h2",ue,h(f.value.name),1),t("p",de,h(f.value.isOnline?"åœ¨çº¿":"ç¦»çº¿"),1)])]),t("div",{ref_key:"messagesContainer",ref:k,class:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50"},[(l(!0),o(B,null,$(g.value,s=>(l(),o("div",{key:s.id,class:u(["flex",s.isOwn?"justify-end":"justify-start"])},[t("div",{class:u(["flex",s.isOwn?"flex-row-reverse":"flex-row","items-end space-x-2"])},[s.isOwn?x("",!0):(l(),o("img",{key:0,src:f.value.avatar,alt:f.value.name,class:"w-8 h-8 rounded-full object-cover flex-shrink-0"},null,8,ce)),t("div",{class:u(["max-w-[70%]",s.isOwn?"mr-2":"ml-2"])},[s.type==="text"?(l(),o("div",{key:0,class:u(["px-4 py-2 rounded-2xl",s.isOwn?"bg-teal-500 text-white rounded-br-sm":"bg-white text-gray-800 rounded-bl-sm"])},[t("p",ve,h(s.content),1)],2)):s.type==="image"?(l(),o("div",pe,[t("img",{src:s.content,alt:"å›¾ç‰‡",class:"max-w-full h-auto cursor-pointer",onClick:b=>K(s.content)},null,8,fe)])):s.type==="voice"?(l(),o("div",{key:2,class:u(["px-4 py-3 rounded-2xl flex items-center space-x-3 cursor-pointer",s.isOwn?"bg-teal-500 text-white":"bg-white text-gray-800"]),onClick:b=>F(s)},[e[8]||(e[8]=oe('<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"></path><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"></path></svg><div class="flex-1"><div class="flex items-center space-x-1"><div class="w-1 h-3 bg-current rounded-full"></div><div class="w-1 h-4 bg-current rounded-full"></div><div class="w-1 h-2 bg-current rounded-full"></div><div class="w-1 h-5 bg-current rounded-full"></div><div class="w-1 h-3 bg-current rounded-full"></div></div></div>',2)),t("span",me,h(s.duration)+"''",1)],10,he)):x("",!0),t("p",{class:u(["text-xs mt-1",s.isOwn?"text-right text-gray-400":"text-left text-gray-400"])},h(E(s.timestamp)),3)],2)],2)],2))),128))],512),t("div",ge,[i.value?(l(),o("div",we,[(l(),o(B,null,$(R,s=>t("button",{key:s,onClick:b=>N(s),class:"text-2xl hover:scale-125 transition-transform"},h(s),9,xe)),64))])):x("",!0),t("div",ye,[t("button",{onMousedown:T,onMouseup:C,onMouseleave:j,onTouchstart:y(T,["prevent"]),onTouchend:y(C,["prevent"]),onTouchcancel:y(j,["prevent"]),class:u(["p-2.5 rounded-full transition-all duration-200 flex-shrink-0",p.value?"bg-red-500 text-white scale-110":"bg-gray-100 text-gray-600 hover:bg-gray-200"])},[...e[9]||(e[9]=[t("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[t("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),t("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})],-1)])],34),t("div",ke,[te(t("textarea",{ref_key:"textInput",ref:c,"onUpdate:modelValue":e[1]||(e[1]=s=>d.value=s),placeholder:"è¾“å…¥æ¶ˆæ¯...",rows:"1",class:"flex-1 bg-transparent px-3 py-2.5 focus:outline-none resize-none max-h-32 overflow-y-auto text-sm",onInput:U,onKeydown:e[2]||(e[2]=ne(y(s=>I(),["exact","prevent"]),["enter"])),onFocus:e[3]||(e[3]=s=>i.value=!1)},null,544),[[se,d.value]]),t("button",{onClick:y(H,["stop"]),class:u(["p-2 transition-colors flex-shrink-0",i.value?"text-teal-500":"text-gray-600"])},[...e[10]||(e[10]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],2),t("button",{onClick:P,class:"p-2 text-gray-600 hover:text-teal-500 transition-colors flex-shrink-0"},[...e[11]||(e[11]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])]),t("input",{ref_key:"imageInput",ref:D,type:"file",accept:"image/*",multiple:"",class:"hidden",onChange:A},null,544)]),t("button",{onClick:e[4]||(e[4]=s=>I()),disabled:!d.value.trim(),class:u(["p-2.5 rounded-full transition-all duration-200 flex-shrink-0",d.value.trim()?"bg-teal-500 text-white hover:bg-teal-600":"bg-gray-300 text-gray-500 cursor-not-allowed"])},[...e[12]||(e[12]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],10,be)]),p.value?(l(),o("div",Ce,[t("div",Me,[e[13]||(e[13]=t("div",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),t("span",De,"æ­£åœ¨å½•éŸ³ "+h(v.value)+'"',1)]),e[14]||(e[14]=t("p",{class:"text-xs text-gray-500 mt-2"},"æ¾å¼€å‘é€ï¼Œæ»‘å‡ºå–æ¶ˆ",-1))])):x("",!0)]),m.value?(l(),o("div",{key:0,onClick:e[6]||(e[6]=s=>m.value=null),class:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4"},[t("img",{src:m.value,alt:"é¢„è§ˆ",class:"max-w-full max-h-full object-contain"},null,8,_e),t("button",{onClick:e[5]||(e[5]=s=>m.value=null),class:"absolute top-4 right-4 p-2 bg-white/20 rounded-full text-white"},[...e[15]||(e[15]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):x("",!0)]))}});export{Te as default};
