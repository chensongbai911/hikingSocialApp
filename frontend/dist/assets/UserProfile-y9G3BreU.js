import{k as q,J as z,E as B,r as g,d as D,l as M,Y as E,v as o,q as i,z as e,x as b,A as n,y as T,L as j,M as C,G as J}from"./vue-B6Xl8iL6.js";import{t as d,b as y,m as V,_ as G}from"./index-CMoLHmYN.js";import{a as Y}from"./activity-C9CSdqxE.js";import{s as H}from"./friendApi-CEKrTBpM.js";import"./state-BRWMog1q.js";const K={class:"user-profile-page min-h-screen bg-white"},O={class:"relative h-64 overflow-hidden"},Q=["src"],W={key:1,class:"w-full h-full bg-gradient-to-br from-teal-400 to-blue-500"},X={class:"relative px-4 -mt-16"},Z={class:"bg-white rounded-3xl shadow-xl p-6"},ee={class:"flex flex-col sm:flex-row items-start sm:items-start justify-between gap-4 sm:gap-4 mb-4"},te={class:"flex items-start flex-1 min-w-0"},se=["src"],ae={class:"ml-4 flex-1 min-w-0"},le={class:"flex items-center gap-2 flex-wrap"},oe={class:"text-2xl font-bold text-gray-800 truncate"},ie={class:"px-3 py-1 bg-teal-500 text-white text-xs rounded-full font-semibold flex-shrink-0"},re={key:0,class:"text-gray-600 text-sm mt-1 truncate"},ne={class:"w-full sm:w-auto sm:flex-shrink-0 space-y-2"},de=["disabled"],ce={key:0},ue={key:1},ge={key:0,class:"w-full px-4 py-2 bg-gray-100 text-gray-600 rounded-xl font-medium text-sm",disabled:""},ve={key:1,class:"w-full px-4 py-2 bg-gray-100 text-gray-600 rounded-xl font-medium text-sm",disabled:""},me=["disabled"],xe={key:0},fe={key:1},pe=["disabled"],he={key:0},_e={key:1},be={class:"grid grid-cols-2 gap-4 py-4 border-t border-b border-gray-100"},ye={class:"text-center"},we={class:"text-2xl font-bold text-gray-800"},ke={class:"text-center"},je={class:"text-2xl font-bold text-gray-800"},Ce={class:"px-4 mt-6"},Ie={class:"bg-white rounded-2xl p-5 shadow-sm"},Ae={class:"text-gray-700 text-sm leading-relaxed"},Le={class:"px-4 mt-6"},De={class:"flex items-center justify-between mb-4"},Te={key:0,class:"text-teal-500 text-sm font-medium"},Ue={key:0,class:"bg-gray-50 rounded-2xl p-8 text-center"},Re={key:1,class:"grid grid-cols-3 gap-3"},$e=["src","alt"],Fe={class:"absolute bottom-0 left-0 right-0 p-3 text-white"},Ne={class:"font-bold text-sm mb-1"},Pe={class:"text-xs opacity-90"},Se={key:0,class:"px-4 mt-6"},qe={class:"flex items-center justify-between mb-4"},ze={class:"text-teal-500 text-sm font-medium"},Be={class:"space-y-3"},Me=["onClick"],Ee=["src","alt"],Je={class:"ml-3 flex-1 flex flex-col justify-center"},Ve={class:"font-bold text-gray-800 mb-1 line-clamp-1"},Ge={class:"flex items-center text-xs text-gray-500 mb-1"},Ye={class:"mr-2"},He={class:"flex items-center justify-between mt-1"},Ke={class:"px-4 mt-6 pb-32"},Oe={key:0,class:"bg-gray-50 rounded-2xl p-8 text-center"},Qe={key:1,class:"flex gap-3 flex-wrap"},We=q({__name:"UserProfile",setup(Xe){const v=z(),U=B(),s=g(null),I=g(!0),u=g(!1),x=g(!1),f=g(!1),p=g("none"),h=g(!1);let _=!1,w=null;const A=D(()=>{var a,t;return((t=(a=s.value)==null?void 0:a.hikingTrails)==null?void 0:t.slice(0,3))||[]}),L=D(()=>{var a,t;return((t=(a=s.value)==null?void 0:a.publishedActivities)==null?void 0:t.slice(0,3))||[]}),R=a=>({ç™»å±±:"â›°ï¸",æ‘„å½±:"ğŸ“·",éœ²è¥:"â›º",å¾’æ­¥:"ğŸ¥¾",è¶Šé‡:"ğŸƒ",å†’é™©:"ğŸ§—",äº¤å‹:"ğŸ‘¥",æˆ·å¤–:"ğŸŒ²",è·¯çº¿å¼€å‘:"ğŸ—ºï¸",è‡ªç„¶:"ğŸƒ",éª‘è¡Œ:"ğŸš´",è¿åŠ¨:"âš½",è¯—æ­Œ:"âœï¸",æ—…æ¸¸:"âœˆï¸",ç¾é£Ÿ:"ğŸœ",å® ç‰©:"ğŸ•",æ…¢ç”Ÿæ´»:"â˜•"})[a]||"ğŸ·ï¸",$=()=>{v.back()},F=async()=>{if(!(!s.value||f.value))try{f.value=!0;const a=s.value.id;try{const t=await V.createConversation(a),l=(t==null?void 0:t.id)||(t==null?void 0:t.conversationId)||(t==null?void 0:t.conversation_id);l?(await new Promise(m=>setTimeout(m,200)),d.success("æ­£åœ¨æ‰“å¼€ç§ä¿¡..."),await v.push({path:"/messages",query:{conversationId:l}})):(console.error("createConversation è¿”å›å¼‚å¸¸:",t),d.error("åˆ›å»ºå¯¹è¯å¤±è´¥"))}catch(t){throw console.error("API é”™è¯¯:",t),t}}catch(a){console.error("æ‰“å¼€èŠå¤©å¤±è´¥:",a),d.error(a.message||"æ‰“å¼€èŠå¤©å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{f.value=!1}},N=async()=>{if(!(!s.value||x.value))try{x.value=!0;const a=s.value.id;if(u.value){const t=await y.unfollowUser(a);t.code===200?(u.value=!1,s.value.stats.followers=Math.max(0,s.value.stats.followers-1),d.success("å·²å–æ¶ˆå…³æ³¨")):d.error(t.message||"å–æ¶ˆå…³æ³¨å¤±è´¥")}else{const t=await y.followUser(a);t.code===200?(u.value=!0,s.value.stats.followers+=1,d.success("å…³æ³¨æˆåŠŸï¼ç°åœ¨å¯ä»¥å‘é€ç§ä¿¡äº†")):d.error(t.message||"å…³æ³¨å¤±è´¥")}}catch(a){console.error("å…³æ³¨æ“ä½œå¤±è´¥:",a),d.error("æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{x.value=!1}},P=async()=>{if(!(!s.value||h.value))try{h.value=!0;const a=await H({friend_id:s.value.id});a.code===200?(p.value="pending",d.success("å¥½å‹è¯·æ±‚å·²å‘é€")):d.error(a.message||"å‘é€å¤±è´¥")}catch(a){d.error((a==null?void 0:a.message)||"å‘é€å¤±è´¥")}finally{h.value=!1}};return M(async()=>{var t;const a=U.params.id;if(!a||a==="NaN"){d.error("ç”¨æˆ·IDæ— æ•ˆ"),v.back();return}if(_||w===a){console.log("é˜²æ­¢é‡å¤åŠ è½½:",a);return}try{_=!0,w=a,I.value=!0;const[l,m,k]=await Promise.all([y.getUserDetail(a),Y.getUserJoinedActivities(a,{page_size:3}),y.getFollowStatus(a)]);if(l.code===200&&l.data){const r=l.data,S=((t=m.data)==null?void 0:t.items)||[];k.code===200&&k.data&&(u.value=k.data.is_following),p.value="none",s.value={id:r.id,nickname:r.nickname,gender:r.gender==="male"?"ç”·":r.gender==="female"?"å¥³":"å…¶ä»–",age:r.age||0,bio:r.bio||"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡å†™...",hikingLevel:r.hiking_level||"æ–°æ‰‹",province:r.province||"",city:r.city||"",region:r.region||"",tags:(r.preferences||[]).map(c=>c.preference_value),avatar:r.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=user${a}`,coverImage:r.photos&&r.photos[0]?r.photos[0].photo_url:"",stats:{activities:r.activities_count||0,followers:r.followers_count||0,following:0},hikingTrails:S.map(c=>({id:c.id,title:c.title,date:new Date(c.start_time).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit"}).replace(/\//g,"."),image:c.cover_image_url||"https://images.unsplash.com/photo-1551632811-561732d1e306?w=300&h=400&fit=crop"})),publishedActivities:r.photos?r.photos.slice(0,3).map(c=>({id:c.id,title:`ç…§ç‰‡ ${c.display_order}`,date:new Date(c.created_at).toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}),location:r.region||r.city||r.province||"åœ°ç‚¹æœªçŸ¥",image:c.photo_url,status:"completed"})):[]}}else d.error("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥"),v.back()}catch(l){console.error("åŠ è½½ç”¨æˆ·èµ„æ–™å¤±è´¥:",l),d.error("åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•"),v.back()}finally{I.value=!1,_=!1}}),E(()=>{w=null,_=!1}),(a,t)=>(i(),o("div",K,[e("div",O,[s.value&&s.value.coverImage?(i(),o("img",{key:0,src:s.value.coverImage,alt:"Cover",class:"w-full h-full object-cover"},null,8,Q)):(i(),o("div",W)),t[2]||(t[2]=e("div",{class:"absolute inset-0 bg-gradient-to-b from-black/30 to-transparent"},null,-1)),e("div",{class:"absolute top-0 left-0 right-0 flex items-center justify-between p-4"},[e("button",{onClick:$,class:"w-10 h-10 bg-white/90 backdrop-blur rounded-full flex items-center justify-center shadow-md"},[...t[0]||(t[0]=[e("span",{class:"text-xl"},"â†",-1)])]),t[1]||(t[1]=e("button",{class:"w-10 h-10 bg-white/90 backdrop-blur rounded-full flex items-center justify-center shadow-md"},[e("span",{class:"text-xl"},"â‹¯")],-1))])]),e("div",X,[e("div",Z,[e("div",ee,[e("div",te,[e("img",{src:s.value&&s.value.avatar||"https://api.dicebear.com/7.x/avataaars/svg?seed=default",alt:"Avatar",class:"w-16 h-16 rounded-full border-4 border-white shadow-md flex-shrink-0"},null,8,se),e("div",ae,[e("div",le,[e("h2",oe,n(s.value&&s.value.nickname||"åŠ è½½ä¸­..."),1),e("span",ie,n(s.value&&s.value.hikingLevel||"æ–°æ‰‹"),1)]),s.value&&(s.value.region||s.value.province||s.value.city)?(i(),o("p",re," ğŸ“ "+n(s.value.region||`${s.value.province||""} ${s.value.city||""}`.trim()),1)):b("",!0)])]),e("div",ne,[e("button",{onClick:N,disabled:x.value,class:T(["w-full px-4 py-2 rounded-xl font-medium text-sm transition active:scale-95 flex items-center justify-center gap-1",u.value?"bg-gray-100 text-gray-600 hover:bg-gray-200":"bg-teal-500 text-white hover:bg-teal-600"])},[x.value?(i(),o("span",ce,"â³")):(i(),o("span",ue,n(u.value?"å–æ¶ˆå…³æ³¨":"+ å…³æ³¨"),1))],10,de),p.value==="accepted"?(i(),o("button",ge," å·²å¥½å‹ ")):p.value==="pending"?(i(),o("button",ve," å¥½å‹è¯·æ±‚ä¸­ ")):(i(),o("button",{key:2,onClick:P,disabled:h.value,class:"w-full px-4 py-2 bg-teal-500 text-white rounded-xl font-medium text-sm hover:bg-teal-600 transition active:scale-95"},[h.value?(i(),o("span",xe,"å‘é€ä¸­...")):(i(),o("span",fe,"åŠ å¥½å‹"))],8,me)),u.value||p.value==="accepted"?(i(),o("button",{key:3,onClick:F,disabled:f.value,class:"w-full px-4 py-2 bg-teal-500 text-white rounded-xl font-medium text-sm hover:bg-teal-600 transition active:scale-95 flex items-center justify-center gap-1"},[f.value?(i(),o("span",he,"â³ åŠ è½½ä¸­")):(i(),o("span",_e,"ğŸ’¬ ç§ä¿¡"))],8,pe)):b("",!0)])]),e("div",be,[e("div",ye,[e("div",we,n(s.value&&s.value.stats&&s.value.stats.activities||0),1),t[3]||(t[3]=e("div",{class:"text-xs text-gray-500 mt-1"},"å¾’æ­¥æ¬¡æ•°",-1))]),e("div",ke,[e("div",je,n(s.value&&s.value.stats&&s.value.stats.followers||0),1),t[4]||(t[4]=e("div",{class:"text-xs text-gray-500 mt-1"},"å…³æ³¨è€…",-1))])])])]),e("div",Ce,[e("div",Ie,[t[5]||(t[5]=e("h3",{class:"text-lg font-bold text-gray-800 mb-3"},"ä¸ªäººç®€ä»‹",-1)),e("p",Ae,n(s.value&&s.value.bio||"çƒ­çˆ±å¤§è‡ªç„¶çš„å±±é‡æ‹¾è’è€…ã€‚å·²ç»åœ¨å‘¨æœ«å¾æœäº†è‹æµ™æ²ªå‘¨è¾¹å¤§éƒ¨åˆ†å±±å³°ï¼Œå¸Œæœ›èƒ½åœ¨è¿™é‡Œé‡åˆ°å¿—åŒé“åˆã€èŠ‚å¥ä¸€è‡´çš„å°ä¼™ä¼´ä¸€èµ·æ¢ç´¢æ›´è¿œçš„é«˜å±±ã€‚æ€§æ ¼å¼€æœ—ï¼Œå¯ä»¥å¸®å¿™æ‹ç…§å’Œè´Ÿé‡ã€‚"),1)])]),e("div",Le,[e("div",De,[t[6]||(t[6]=e("h3",{class:"text-lg font-bold text-gray-800"},"å¾’æ­¥è¶³è¿¹",-1)),s.value&&s.value.hikingTrails&&s.value.hikingTrails.length?(i(),o("button",Te," æŸ¥çœ‹å…¨éƒ¨ "+n(s.value.hikingTrails.length),1)):b("",!0)]),A.value.length?(i(),o("div",Re,[(i(!0),o(j,null,C(A.value,(l,m)=>(i(),o("div",{key:m,class:"relative rounded-2xl overflow-hidden shadow-md",style:{"aspect-ratio":"3/4"}},[e("img",{src:l.image,alt:l.title,class:"w-full h-full object-cover"},null,8,$e),t[8]||(t[8]=e("div",{class:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"},null,-1)),e("div",Fe,[e("h4",Ne,n(l.title),1),e("p",Pe,n(l.date),1)])]))),128))])):(i(),o("div",Ue,[...t[7]||(t[7]=[e("div",{class:"text-5xl mb-3"},"ğŸ¥¾",-1),e("p",{class:"text-gray-500 text-sm"},"è¿˜æ²¡æœ‰å¾’æ­¥è¶³è¿¹",-1),e("p",{class:"text-gray-400 text-xs mt-1"},"æœŸå¾…TAçš„ç²¾å½©æˆ·å¤–æ—…ç¨‹",-1)])]))]),L.value.length>0?(i(),o("div",Se,[e("div",qe,[t[9]||(t[9]=e("h3",{class:"text-lg font-bold text-gray-800"},"å‘å¸ƒçš„æ´»åŠ¨",-1)),e("button",ze," æŸ¥çœ‹å…¨éƒ¨ "+n(s.value&&s.value.stats&&s.value.stats.activities),1)]),e("div",Be,[(i(!0),o(j,null,C(L.value,l=>(i(),o("div",{key:l.id,class:"flex bg-white rounded-2xl p-3 shadow-md active:scale-95 transition-transform cursor-pointer",onClick:m=>J(v).push(`/activity/${l.id}`)},[e("img",{src:l.image,alt:l.title,class:"w-20 h-20 rounded-xl object-cover"},null,8,Ee),e("div",Je,[e("h4",Ve,n(l.title),1),e("div",Ge,[e("span",Ye,"ğŸ“… "+n(l.date),1),e("span",null,"ğŸ“ "+n(l.location),1)]),e("div",He,[e("span",{class:T(["text-xs px-2 py-0.5 rounded-full",{"bg-green-100 text-green-600":l.status==="ongoing","bg-blue-100 text-blue-600":l.status==="pending"||l.status==="approved","bg-gray-100 text-gray-600":l.status==="completed"||l.status==="cancelled"}])},n(l.status==="ongoing"?"è¿›è¡Œä¸­":l.status==="completed"?"å·²ç»“æŸ":"æ‹›å‹Ÿä¸­"),3),t[10]||(t[10]=e("span",{class:"text-teal-500 text-xs font-bold"},"ç‚¹å‡»åŠ å…¥ >",-1))])])],8,Me))),128))])])):b("",!0),e("div",Ke,[t[12]||(t[12]=e("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"å…´è¶£çˆ±å¥½",-1)),s.value&&s.value.tags&&s.value.tags.length?(i(),o("div",Qe,[(i(!0),o(j,null,C(s.value.tags,l=>(i(),o("span",{key:l,class:"px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium"},n(R(l))+" "+n(l),1))),128))])):(i(),o("div",Oe,[...t[11]||(t[11]=[e("div",{class:"text-5xl mb-3"},"ğŸ·ï¸",-1),e("p",{class:"text-gray-500 text-sm"},"è¿˜æ²¡æœ‰è®¾ç½®å…´è¶£çˆ±å¥½",-1),e("p",{class:"text-gray-400 text-xs mt-1"},"æ›´å¤šäº†è§£ä»è®¾ç½®å…´è¶£å¼€å§‹",-1)])]))]),t[13]||(t[13]=e("div",{class:"h-8"},null,-1))]))}}),lt=G(We,[["__scopeId","data-v-f06c1e60"]]);export{lt as default};
