import{r as u,k as Y,J as Z,d as V,l as I,v as f,q as p,z as t,x as D,L as C,M as F,O as L,P as A,A as g,Q as O,y as S}from"./vue-Eb8ZdQV1.js";import{d as T}from"./state-WzMdx_T8.js";import{a as R,b as P,t as k,_ as ee}from"./index-BAE1sWos.js";const j={async getRecommendedActivities(m){return R.get("/discovery/activities",{params:m})},async getRecommendedUsers(m){return R.get("/discovery/users",{params:m})},async searchActivities(m){return R.get("/discovery/search/activities",{params:m})},async searchUsers(m){return R.get("/discovery/search/users",{params:m})}},te=T("discovery",()=>{const m=u([]),w=u([]),y=u([]),o=u(!1),d=u(null),b=u({page:1,page_size:10,total:0,total_pages:0}),h=u({keyword:"",difficulty:void 0,location:void 0,gender:void 0,hiking_level:void 0}),$=async i=>{o.value=!0,d.value=null;try{const a=await j.getRecommendedActivities(i);if(a.code===200&&a.data){const c=a.data;m.value=c.items,b.value=c.pagination}}catch(a){d.value=a.message||"è·å–æ¨èæ´»åŠ¨å¤±è´¥",console.error("Fetch recommended activities error:",a)}finally{o.value=!1}},n=async i=>{o.value=!0,d.value=null;try{const a=await j.getRecommendedUsers(i);if(a.code===200&&a.data){const c=a.data;w.value=c.items,b.value=c.pagination}}catch(a){d.value=a.message||"è·å–æ¨èç”¨æˆ·å¤±è´¥",console.error("Fetch recommended users error:",a)}finally{o.value=!1}},v=async i=>{o.value=!0,d.value=null;try{const a=await j.searchActivities(i);if(a.code===200&&a.data){const c=a.data;y.value=c.items,b.value=c.pagination}}catch(a){d.value=a.message||"æœç´¢æ´»åŠ¨å¤±è´¥",console.error("Search activities error:",a)}finally{o.value=!1}},x=async i=>{o.value=!0,d.value=null;try{const a=await j.searchUsers(i);if(a.code===200&&a.data){const c=a.data;y.value=c.items,b.value=c.pagination}}catch(a){d.value=a.message||"æœç´¢ç”¨æˆ·å¤±è´¥",console.error("Search users error:",a)}finally{o.value=!1}},U=i=>{h.value={...h.value,...i}},_=()=>{h.value={keyword:"",difficulty:void 0,location:void 0,gender:void 0,hiking_level:void 0}};return{recommendedActivities:m,recommendedUsers:w,searchResults:y,loading:o,error:d,pagination:b,filters:h,fetchRecommendedActivities:$,fetchRecommendedUsers:n,searchActivities:v,searchUsers:x,updateFilters:U,clearFilters:_,reset:()=>{m.value=[],w.value=[],y.value=[],o.value=!1,d.value=null,b.value={page:1,page_size:10,total:0,total_pages:0},_()}}}),se={class:"discover-page min-h-screen bg-white pb-24"},ae={class:"bg-white pt-6 pb-4 px-4 border-b border-gray-100"},le={class:"container mx-auto"},oe={class:"relative"},ne={key:0,class:"fixed inset-0 bg-white z-50 overflow-y-auto",style:{"padding-top":"env(safe-area-inset-top)"}},ie={class:"min-h-screen"},re={class:"flex items-center justify-between px-4 py-4 border-b border-gray-100"},de={class:"px-4 py-6 space-y-8"},ce={class:"flex gap-3"},ue=["onClick"],ve={class:"px-2"},ge={class:"flex justify-between mb-3"},me={class:"text-2xl font-bold text-gray-800"},fe={class:"text-2xl font-bold text-gray-800"},pe={class:"relative"},ye={class:"h-2 bg-gray-200 rounded-full relative"},be={class:"flex gap-3"},xe=["onClick"],he={class:"flex gap-3 flex-wrap"},we=["onClick"],_e={class:"flex items-center justify-between mb-4"},ke={class:"text-teal-500 text-base font-semibold"},Ue={class:"px-2"},Ce={class:"h-2 bg-gray-200 rounded-full relative overflow-hidden"},Fe={class:"container mx-auto px-3 py-6"},Le={key:0,class:"flex justify-center py-12"},Ae={key:1,class:"grid grid-cols-2 gap-3"},Se=["onClick"],Re=["src","alt"],je={key:1,class:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"},$e={class:"absolute inset-0 flex flex-col justify-between p-4"},ze={class:"flex justify-between items-start"},Me={class:"px-3 py-1 bg-white/90 backdrop-blur text-xs font-semibold text-gray-700 rounded-full"},Ve=["onClick","disabled"],De={class:"space-y-1"},Oe={class:"font-bold text-white text-base"},Pe={class:"text-xs text-white/90"},Be={class:"text-xs text-white/80"},Ne={key:2,class:"text-center py-12"},Qe=Y({__name:"Discover",setup(m){const w=Z(),y=te(),o=u(""),d=u(!1),b=["ç”·","å¥³"],h=["æ–°æ‰‹","ä¸­çº§","é«˜æ‰‹"],$=["æ‘„å½±","éœ²è¥","ç¾é£Ÿ","å® ç‰©"],n=u({gender:[],level:[],interests:[]}),v=u([18,50]),x=u(50),U=["linear-gradient(135deg, #ffb6c1 0%, #ffd700 100%)","linear-gradient(135deg, #4db8a8 0%, #d4e157 100%)","linear-gradient(135deg, #d4a574 0%, #f4a460 100%)","linear-gradient(135deg, #8b7355 0%, #f4e4c1 100%)","linear-gradient(135deg, #c9b998 0%, #6b5b4a 100%)","linear-gradient(135deg, #5f9ea0 0%, #e0f7fa 100%)"],_=V(()=>y.recommendedUsers),B=V(()=>y.loading),i=u(new Map),a=u(new Map),c=l=>l?{beginner:"æ–°æ‰‹",intermediate:"ä¸­çº§",advanced:"é«˜æ‰‹",expert:"ä¸“å®¶"}[l]||l:"æ–°æ‰‹",N=V(()=>_.value.map((e,s)=>({id:e.id,nickname:e.nickname,gender:e.gender==="male"?"ç”·":e.gender==="female"?"å¥³":"å…¶ä»–",age:e.age||0,bio:e.bio||"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡å†™...",hikingLevel:c(e.hiking_level),level:c(e.hiking_level),tags:e.preferences?e.preferences.map(r=>r.preference_value):[],recentActivity:"æœ€è¿‘æ´»è·ƒ",avatar:e.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=user${e.id}`,coverImage:e.avatar_url||"",gradient:U[s%U.length],commonPreferences:e.common_preferences||0,isFollowing:i.value.get(e.id)??!1,followingLoading:a.value.get(e.id)??!1})).filter(e=>{const s=o.value.toLowerCase(),r=!o.value||e.nickname.toLowerCase().includes(s)||e.bio.toLowerCase().includes(s)||e.tags.length>0&&e.tags.some(M=>M.toLowerCase().includes(s)),J=n.value.gender.length===0||n.value.gender.includes(e.gender),K=e.age===0||e.age>=v.value[0]&&e.age<=v.value[1],W=n.value.level.length===0||n.value.level.includes(e.hikingLevel),X=n.value.interests.length===0||e.tags.length>0&&n.value.interests.some(M=>e.tags.includes(M));return r&&J&&K&&W&&X})),z=(l,e)=>{const s=n.value[l].indexOf(e);s>-1?n.value[l].splice(s,1):n.value[l].push(e)},Q=()=>{n.value={gender:[],level:[],interests:[]},v.value=[18,50],x.value=50,o.value=""},q=l=>{w.push({name:"user-profile",params:{id:l}})},E=async()=>{try{await y.fetchRecommendedUsers({page:1,page_size:20})}catch(l){console.error("åŠ è½½æ¨èç”¨æˆ·å¤±è´¥:",l)}},G=async(l,e)=>{e.stopPropagation();try{if(a.value.set(l,!0),i.value.get(l)??!1){const r=await P.unfollowUser(String(l));r.code===200?(i.value.set(l,!1),k.success("å·²å–æ¶ˆå…³æ³¨")):k.error(r.message||"å–æ¶ˆå…³æ³¨å¤±è´¥")}else{const r=await P.followUser(String(l));r.code===200?(i.value.set(l,!0),k.success("å…³æ³¨æˆåŠŸ")):k.error(r.message||"å…³æ³¨å¤±è´¥")}}catch(s){console.error("å…³æ³¨æ“ä½œå¤±è´¥:",s),k.error("æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{a.value.set(l,!1)}},H=async l=>{try{const e=await P.getFollowStatus(String(l));e.code===200&&e.data&&i.value.set(l,e.data.is_following)}catch(e){console.error(`åŠ è½½å…³æ³¨çŠ¶æ€å¤±è´¥ (${l}):`,e)}};return I(async()=>{await E();for(const l of _.value)await H(l.id)}),(l,e)=>(p(),f("div",se,[t("div",ae,[t("div",le,[e[8]||(e[8]=t("div",{class:"flex items-center justify-center mb-4"},[t("h1",{class:"text-2xl font-bold text-gray-800"},"å‘ç°å¾’æ­¥ä¼´ä¾£")],-1)),t("div",oe,[e[7]||(e[7]=t("span",{class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"},"ğŸ”",-1)),C(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.value=s),type:"text",placeholder:"æœç´¢æ˜µç§°æˆ–å…±åŒä¹‰è¶£",class:"w-full pl-12 pr-14 py-3 bg-gray-100 rounded-full border-0 focus:outline-none focus:ring-2 focus:ring-green-500 transition"},null,512),[[F,o.value]]),t("button",{onClick:e[1]||(e[1]=s=>d.value=!0),class:"absolute right-2 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-white rounded-full flex items-center justify-center hover:bg-gray-50 transition shadow-sm",title:"ç­›é€‰"},[...e[6]||(e[6]=[t("span",{class:"text-lg"},"âš™ï¸",-1)])])])])]),d.value?(p(),f("div",ne,[t("div",ie,[t("div",re,[t("button",{onClick:Q,class:"text-gray-600 text-base font-medium"}," é‡ç½® "),e[9]||(e[9]=t("h2",{class:"text-lg font-bold text-gray-800"},"ç­›é€‰",-1)),t("button",{onClick:e[2]||(e[2]=s=>d.value=!1),class:"px-6 py-2 bg-teal-500 text-white rounded-full text-sm font-medium hover:bg-teal-600 transition"}," å®Œæˆ ")]),t("div",de,[t("div",null,[e[10]||(e[10]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"æ€§åˆ«",-1)),t("div",ce,[(p(),f(L,null,A(b,s=>t("button",{key:s,onClick:r=>z("gender",s),class:S(["flex-1 py-3 rounded-full font-medium text-base transition",n.value.gender.includes(s)?"bg-teal-500 text-white":"bg-gray-100 text-gray-700"])},g(s),11,ue)),64))])]),t("div",null,[e[11]||(e[11]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"å¹´é¾„èŒƒå›´",-1)),t("div",ve,[t("div",ge,[t("span",me,g(v.value[0]),1),t("span",fe,g(v.value[1]),1)]),t("div",pe,[C(t("input",{type:"range","onUpdate:modelValue":e[3]||(e[3]=s=>v.value[0]=s),min:"18",max:"50",class:"range-slider",style:{position:"absolute",width:"100%","pointer-events":"auto"}},null,512),[[F,v.value[0],void 0,{number:!0}]]),C(t("input",{type:"range","onUpdate:modelValue":e[4]||(e[4]=s=>v.value[1]=s),min:"18",max:"50",class:"range-slider",style:{position:"absolute",width:"100%","pointer-events":"auto"}},null,512),[[F,v.value[1],void 0,{number:!0}]]),t("div",ye,[t("div",{class:"absolute h-2 bg-teal-500 rounded-full",style:O({left:(v.value[0]-18)/32*100+"%",right:100-(v.value[1]-18)/32*100+"%"})},null,4)])])])]),t("div",null,[e[12]||(e[12]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"å¾’æ­¥ç»éªŒ",-1)),t("div",be,[(p(),f(L,null,A(h,s=>t("button",{key:s,onClick:r=>z("level",s),class:S(["flex-1 py-3 rounded-full font-medium text-base transition",n.value.level.includes(s)?"bg-teal-500 text-white":"bg-gray-100 text-gray-700"])},g(s),11,xe)),64))])]),t("div",null,[e[13]||(e[13]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"å…±åŒå…´è¶£",-1)),t("div",he,[(p(),f(L,null,A($,s=>t("button",{key:s,onClick:r=>z("interests",s),class:S(["px-6 py-3 rounded-full font-medium text-base transition",n.value.interests.includes(s)?"bg-teal-500 text-white":"bg-gray-100 text-gray-700"])},g(s),11,we)),64))])]),t("div",null,[t("div",_e,[e[14]||(e[14]=t("h3",{class:"text-lg font-bold text-gray-800"},"è·ç¦»èŒƒå›´",-1)),t("span",ke,g(x.value)+"kmå†…",1)]),t("div",Ue,[C(t("input",{type:"range","onUpdate:modelValue":e[5]||(e[5]=s=>x.value=s),min:"1",max:"100",class:"range-slider w-full"},null,512),[[F,x.value,void 0,{number:!0}]]),t("div",Ce,[t("div",{class:"absolute h-2 bg-teal-500 rounded-full left-0",style:O({width:x.value+"%"})},null,4)])])])])])])):D("",!0),t("div",Fe,[B.value?(p(),f("div",Le,[...e[15]||(e[15]=[t("div",{class:"text-center"},[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-500 mx-auto mb-4"}),t("p",{class:"text-gray-600"},"åŠ è½½ä¸­...")],-1)])])):N.value.length>0?(p(),f("div",Ae,[(p(!0),f(L,null,A(N.value,s=>(p(),f("div",{key:s.id,class:"user-card group cursor-pointer",onClick:r=>q(s.id)},[t("div",{class:"relative rounded-3xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300",style:O([{"aspect-ratio":"3/4"},{background:s.coverImage?"transparent":s.gradient}])},[s.coverImage?(p(),f("img",{key:0,src:s.coverImage,alt:s.nickname,class:"absolute inset-0 w-full h-full object-cover"},null,8,Re)):D("",!0),s.coverImage?(p(),f("div",je)):D("",!0),t("div",$e,[t("div",ze,[t("span",Me,g(s.hikingLevel),1),t("button",{onClick:r=>G(s.id,r),disabled:s.followingLoading,class:S([["px-3 py-1 rounded-full text-xs font-semibold transition-all",s.isFollowing?"bg-white/90 text-gray-700":"bg-teal-500 text-white","disabled:opacity-50 disabled:cursor-not-allowed"],"backdrop-blur"])},g(s.followingLoading?"...":s.isFollowing?"å·²å…³æ³¨":"å…³æ³¨"),11,Ve)]),t("div",De,[t("h3",Oe,g(s.nickname),1),t("p",Pe,g(s.gender)+", "+g(s.age)+"å², "+g(s.hikingLevel),1),t("p",Be,"æœ€è¿‘æ´»åŠ¨: "+g(s.recentActivity),1)])])],4)],8,Se))),128))])):(p(),f("div",Ne,[...e[16]||(e[16]=[t("div",{class:"text-6xl mb-4"},"ğŸ”",-1),t("p",{class:"text-gray-600 text-lg"},"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å¾’æ­¥ä¼™ä¼´",-1),t("p",{class:"text-gray-500 text-sm mt-2"},"è¯•è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰æ¡ä»¶",-1)])]))])]))}}),He=ee(Qe,[["__scopeId","data-v-b1c182b8"]]);export{He as default};
