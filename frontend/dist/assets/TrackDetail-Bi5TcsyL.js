import{k as U,E as j,J as M,r as k,l as N,v as l,q as i,z as t,x as c,A as n,L as b,M as g,O,P as z,y as B}from"./vue-B6Xl8iL6.js";import{t as p}from"./track-D4rPx4TD.js";import{_ as P}from"./index-DSiq_KRh.js";import"./apiService--okSZ2Y3.js";import"./state-BRWMog1q.js";const E={class:"track-detail"},I={key:0,class:"track-header"},V={class:"track-meta"},A={key:1,class:"loading"},J={key:2,class:"error"},q={key:3,class:"track-stats"},G={class:"stat-card"},H={class:"stat-content"},K={class:"stat-value"},Q={class:"stat-card"},W={class:"stat-content"},X={class:"stat-value"},Y={class:"stat-card"},Z={class:"stat-content"},tt={class:"stat-value"},at={class:"stat-card"},st={class:"stat-content"},et={class:"stat-value"},ot={key:4,class:"track-points"},nt={class:"points-list"},lt={class:"point-number"},it={class:"point-coord"},rt={class:"point-time"},ct={key:0,class:"point-altitude"},dt={key:0,class:"points-more"},ut={key:5,class:"track-feedback"},vt={class:"feedback-card"},mt={class:"rating"},kt=["onClick"],_t={key:6,class:"track-actions"},pt=U({__name:"TrackDetail",setup(ht){const f=j(),y=M(),v=f.params.id,o=k(null),u=k([]),m=k(!0),_=k(""),d=k({rating:0,comment:""}),w=s=>s?new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"-",D=s=>new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),T=s=>s?(s/1e3).toFixed(2):"0",x=s=>{if(!s)return"-";const a=Math.floor(s/3600),e=Math.floor(s%3600/60),r=s%60;return a>0?`${a}h ${e}m ${r}s`:e>0?`${e}m ${r}s`:`${r}s`},C=(s,a)=>{if(!s||!a)return"-";const e=s/1e3;return(a/60/e).toFixed(1)},$=async()=>{try{m.value=!0,_.value="";const s=await p.getTrackDetail(v);o.value=s;const a=await p.getTrackPoints(v);u.value=a.points||[]}catch(s){_.value="æ— æ³•åŠ è½½è½¨è¿¹æ•°æ®ï¼Œè¯·ç¨åé‡è¯•",console.error("Failed to load track:",s)}finally{m.value=!1}},F=async()=>{if(d.value.rating===0){alert("è¯·é€‰æ‹©è¯„åˆ†");return}try{await p.addTrackFeedback(v,{rating:d.value.rating,comment:d.value.comment}),alert("è¯„ä»·æäº¤æˆåŠŸï¼"),d.value={rating:0,comment:""}}catch{alert("æäº¤è¯„ä»·å¤±è´¥ï¼Œè¯·é‡è¯•")}},L=()=>{const s=`${window.location.origin}/track/${v}`;navigator.clipboard.writeText(s),alert("åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")},R=()=>{const s={track:o.value,points:u.value,exportTime:new Date().toISOString()},a=JSON.stringify(s,null,2),e=new Blob([a],{type:"application/json"}),r=URL.createObjectURL(e),h=document.createElement("a");h.href=r,h.download=`track-${v}.json`,h.click(),URL.revokeObjectURL(r)},S=async()=>{if(confirm("ç¡®è®¤åˆ é™¤æ­¤å¾’æ­¥è®°å½•ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚"))try{await p.deleteTrack(v),alert("åˆ é™¤æˆåŠŸ"),y.push("/my-hiking")}catch{alert("åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•")}};return N(()=>{$()}),(s,a)=>(i(),l("div",E,[t("button",{class:"btn-back",onClick:a[0]||(a[0]=e=>s.$router.back())},"â† è¿”å›"),o.value?(i(),l("div",I,[t("h1",null,n(o.value.route_name||"å¾’æ­¥è®°å½•"),1),t("div",V,[t("span",null,"ğŸ“… "+n(w(o.value.created_at)),1),t("span",null,"â± "+n(x(o.value.duration)),1)])])):c("",!0),m.value?(i(),l("div",A,"åŠ è½½ä¸­...")):c("",!0),_.value?(i(),l("div",J,n(_.value),1)):c("",!0),o.value&&!m.value?(i(),l("div",q,[t("div",G,[a[3]||(a[3]=t("div",{class:"stat-icon"},"ğŸ“",-1)),t("div",H,[a[2]||(a[2]=t("div",{class:"stat-label"},"æ€»è·ç¦»",-1)),t("div",K,n(T(o.value.distance))+" km",1)])]),t("div",Q,[a[5]||(a[5]=t("div",{class:"stat-icon"},"â¬†ï¸",-1)),t("div",W,[a[4]||(a[4]=t("div",{class:"stat-label"},"çˆ¬å‡",-1)),t("div",X,n(o.value.elevation_gain||0)+" m",1)])]),t("div",Y,[a[7]||(a[7]=t("div",{class:"stat-icon"},"ğŸ”¥",-1)),t("div",Z,[a[6]||(a[6]=t("div",{class:"stat-label"},"æ¶ˆè€—å¡è·¯é‡Œ",-1)),t("div",tt,n(o.value.calories||0)+" kcal",1)])]),t("div",at,[a[9]||(a[9]=t("div",{class:"stat-icon"},"ğŸ’§",-1)),t("div",st,[a[8]||(a[8]=t("div",{class:"stat-label"},"å¹³å‡é…é€Ÿ",-1)),t("div",et,n(C(o.value.distance,o.value.duration))+" min/km",1)])])])):c("",!0),o.value&&u.value.length>0?(i(),l("div",ot,[t("h2",null,"è½¨è¿¹ç‚¹ ("+n(u.value.length)+")",1),t("div",nt,[(i(!0),l(b,null,g(u.value.slice(0,10),(e,r)=>(i(),l("div",{class:"point-item",key:e.id},[t("span",lt,"#"+n(r+1),1),t("span",it,n(e.latitude.toFixed(4))+", "+n(e.longitude.toFixed(4)),1),t("span",rt,n(D(e.recorded_at)),1),e.altitude?(i(),l("span",ct,n(e.altitude)+"m",1)):c("",!0)]))),128)),u.value.length>10?(i(),l("div",dt," ... è¿˜æœ‰ "+n(u.value.length-10)+" ä¸ªè½¨è¿¹ç‚¹ ",1)):c("",!0)])])):c("",!0),o.value&&!m.value?(i(),l("div",ut,[t("div",vt,[a[10]||(a[10]=t("h3",null,"ğŸ‘¤ è¯„ä»·æ­¤å¾’æ­¥",-1)),t("div",mt,[(i(),l(b,null,g(5,e=>t("span",{key:e,class:B(["star",{active:e<=(d.value.rating||0)}]),onClick:r=>d.value.rating=e},"â˜…",10,kt)),64))]),O(t("textarea",{"onUpdate:modelValue":a[1]||(a[1]=e=>d.value.comment=e),placeholder:"åˆ†äº«ä½ çš„å¾’æ­¥ä½“éªŒ...",class:"feedback-textarea"},null,512),[[z,d.value.comment]]),t("button",{class:"btn btn-primary",onClick:F},"æäº¤è¯„ä»·")])])):c("",!0),o.value&&!m.value?(i(),l("div",_t,[t("button",{class:"btn btn-secondary",onClick:L},"ğŸ“¤ åˆ†äº«"),t("button",{class:"btn btn-secondary",onClick:R},"â¬‡ï¸ ä¸‹è½½æ•°æ®"),t("button",{class:"btn btn-danger",onClick:S},"ğŸ—‘ï¸ åˆ é™¤")])):c("",!0)]))}}),Dt=P(pt,[["__scopeId","data-v-c109f522"]]);export{Dt as default};
