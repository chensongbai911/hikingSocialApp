import{k as q,J as A,r as w,d as y,l as E,v as a,q as i,z as e,x as h,S as C,A as u,O as k,P as _,K as b}from"./vue-Eb8ZdQV1.js";import{u as N,t as v,_ as I}from"./index-BAE1sWos.js";import{u as T}from"./imageUpload-Dtu64uJJ.js";import"./state-WzMdx_T8.js";const D={class:"profile-page"},F={class:"px-4 py-6 pb-20"},J={class:"flex flex-col items-center mb-6"},K={class:"relative mb-4"},O=["src","alt"],R={class:"flex items-center gap-2 mb-1"},G={class:"text-2xl font-bold text-gray-800"},Q={key:0,class:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 24 24"},W={class:"px-3 py-1 bg-blue-50 text-blue-600 text-sm font-semibold rounded-full"},X={class:"bg-white rounded-2xl shadow-sm p-5 mb-4"},Y={class:"text-gray-700 leading-relaxed"},Z={key:0,class:"bg-white rounded-2xl shadow-sm p-5 mb-4"},ee={class:"flex items-center gap-2 text-gray-700"},te={class:"bg-white rounded-2xl shadow-sm p-5 mb-4"},se={class:"flex flex-wrap gap-2"},oe={class:"bg-white rounded-2xl shadow-sm p-5 mb-4"},le={class:"flex items-center justify-between mb-3"},re={class:"text-xs text-gray-400"},ae={class:"grid grid-cols-3 gap-3"},ie=["src","alt","onClick"],ne=["onClick"],ce={class:"relative w-full h-full flex items-center justify-center p-4"},de=["src","alt"],ue={class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 px-4 py-2 bg-white bg-opacity-20 rounded-full text-white text-sm"},ve=q({__name:"Profile",setup(he){const f=A(),p=N(),g=w(!1),n=w(0),l=y(()=>p.currentUser),s=y(()=>{if(!l.value)return{avatar:"https://via.placeholder.com/112",nickname:"加载中...",gender:"other",age:0,bio:"",preferences:[],photos:[]};const o=(l.value.preferences||[]).map(d=>d.preference_value),t=(l.value.photos||[]).map(d=>({id:d.id,photo_url:d.photo_url}));return{avatar:l.value.avatar_url||"https://via.placeholder.com/112",nickname:l.value.nickname,gender:l.value.gender,age:l.value.age||0,bio:l.value.bio||"这个人很懒，什么都没写...",province:l.value.province||"",city:l.value.city||"",region:l.value.region||"",preferences:o,photos:t}}),z=()=>{f.back()},P=()=>{console.log("前往设置页面")},M=()=>{f.push("/edit-profile")},L=()=>{const o=document.createElement("input");o.type="file",o.accept="image/*",o.multiple=!0,o.onchange=async t=>{const r=t.target.files;if(r&&r.length>0)try{const c=s.value.photos.length;if(c+r.length>9){v.warning(`最多只能上传9张照片，当前已有${c}张`);return}v.info(`正在上传${r.length}张照片...`);const m=Array.from(r);(await T(m)).forEach(U=>{p.addLocalPhoto(U)}),v.success("照片上传成功")}catch(c){console.error("上传照片失败:",c),v.error("上传失败，请重试")}},o.click()},B=async o=>{try{if(!confirm("确定要删除这张照片吗？"))return;v.info("正在删除照片..."),await p.deletePhoto(o)&&v.success("照片已删除")}catch(t){console.error("删除照片失败:",t),v.error("删除失败，请重试")}},j=o=>{n.value=o,g.value=!0},x=()=>{g.value=!1},V=()=>{n.value>0&&n.value--},S=()=>{n.value<s.value.photos.length-1&&n.value++},H=()=>{f.push("/privacy-settings")},$=async()=>{try{l.value||await p.fetchCurrentUser(),console.log("用户资料加载成功")}catch(o){console.error("加载用户资料失败:",o)}};return E(()=>{$()}),(o,t)=>{var d;return i(),a("div",D,[e("div",{class:"sticky top-0 z-10 bg-white border-b border-gray-200"},[e("div",{class:"flex items-center justify-between px-4 py-4"},[e("button",{onClick:z,class:"p-2"},[...t[1]||(t[1]=[e("svg",{class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})],-1)])]),t[3]||(t[3]=e("h1",{class:"text-xl font-bold text-gray-800"},"个人资料",-1)),e("button",{onClick:P,class:"p-2"},[...t[2]||(t[2]=[e("svg",{class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"})],-1)])])])]),e("div",F,[e("div",J,[e("div",K,[e("img",{src:s.value.avatar,alt:s.value.nickname,class:"w-28 h-28 rounded-full object-cover border-4 border-white shadow-lg"},null,8,O),t[4]||(t[4]=C('<div class="absolute bottom-0 right-0 w-10 h-10 bg-teal-500 rounded-full flex items-center justify-center border-4 border-white" data-v-435bb847><svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24" data-v-435bb847><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" data-v-435bb847></path><path d="M0 0h24v24H0z" fill="none" data-v-435bb847></path><circle cx="12" cy="8" r="1.5" data-v-435bb847></circle><path d="M12 15c-1.5 0-2.7.4-3.6.9l-.9.6c-.3.2-.5.6-.5 1v.5h10v-.5c0-.4-.2-.8-.5-1l-.9-.6c-.9-.5-2.1-.9-3.6-.9z" data-v-435bb847></path></svg></div>',1))]),e("div",R,[e("h2",G,u(s.value.nickname),1),s.value.gender==="male"?(i(),a("svg",Q,[...t[5]||(t[5]=[e("path",{d:"M9 9c0-1.65 1.35-3 3-3s3 1.35 3 3-1.35 3-3 3-3-1.35-3-3zm0 8c0 1.93 2.69 3 6 3s6-1.07 6-3v-1H9v1z"},null,-1),e("path",{d:"M17.5 3h-3v1.5H16v1.59c-.74-.27-1.54-.43-2.38-.43C10.07 5.66 7 8.73 7 12.5S10.07 19.34 13.62 19.34c2.14 0 4.04-1.04 5.22-2.63l1.42 1.42 1.06-1.06-1.42-1.42C20.7 14.48 21 13.46 21 12.5c0-2.36-1.23-4.43-3.09-5.61V5.5h1.5V4h-1.91V3zm-3.88 14.84c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"},null,-1)])])):h("",!0),e("span",W,u(s.value.age),1)])]),e("div",X,[t[6]||(t[6]=e("h3",{class:"text-sm font-semibold text-gray-500 mb-3"},"关于我",-1)),e("p",Y,u(s.value.bio),1)]),s.value.region||s.value.city||s.value.province?(i(),a("div",Z,[t[8]||(t[8]=e("h3",{class:"text-sm font-semibold text-gray-500 mb-3"},"所在地",-1)),e("div",ee,[t[7]||(t[7]=e("svg",{class:"w-5 h-5 text-teal-500",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})],-1)),e("span",null,u(s.value.region||`${s.value.province||""} ${s.value.city||""}`.trim()||"未设置"),1)])])):h("",!0),e("div",te,[t[9]||(t[9]=e("h3",{class:"text-sm font-semibold text-gray-500 mb-3"},"我的徒步偏好",-1)),e("div",se,[(i(!0),a(k,null,_(s.value.preferences,(r,c)=>(i(),a("span",{key:c,class:"px-4 py-2 bg-teal-50 text-teal-600 rounded-full text-sm font-medium"},u(r),1))),128))])]),e("div",oe,[e("div",le,[t[10]||(t[10]=e("h3",{class:"text-sm font-semibold text-gray-500"},"生活相册",-1)),e("span",re,u(s.value.photos.length)+"/9",1)]),e("div",ae,[(i(!0),a(k,null,_(s.value.photos,(r,c)=>(i(),a("div",{key:r.id,class:"relative aspect-square rounded-2xl overflow-hidden bg-gray-100 group"},[e("img",{src:r.photo_url,alt:"photo-"+c,class:"w-full h-full object-cover hover:scale-105 transition-transform duration-300",onClick:m=>j(c)},null,8,ie),e("button",{onClick:b(m=>B(r.id),["stop"]),class:"absolute top-2 right-2 w-8 h-8 bg-red-500 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shadow-lg hover:bg-red-600"},[...t[11]||(t[11]=[e("svg",{class:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])],8,ne)]))),128)),s.value.photos.length<9?(i(),a("div",{key:0,class:"aspect-square rounded-2xl overflow-hidden bg-gray-50 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-100 hover:border-teal-400 transition-all",onClick:L},[...t[12]||(t[12]=[e("svg",{class:"w-8 h-8 text-teal-400 mb-1",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M19 7v2.99s-1.99.01-2 0V7h-3s.01-1.99 0-2h3V2h2v3h3v2h-3zm-3 4V8h-3V5H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8h-3zM5 19l3-4 2 3 3-4 4 5H5z"})],-1),e("span",{class:"text-xs text-teal-500 font-medium"},"添加照片",-1)])])):h("",!0)])]),e("button",{onClick:M,class:"w-full py-4 bg-teal-500 text-white rounded-2xl font-semibold text-lg hover:bg-teal-600 transition-colors mb-4 shadow-sm"}," 编辑资料 "),e("button",{onClick:H,class:"w-full flex items-center justify-between bg-white rounded-2xl p-5 shadow-sm hover:shadow-md transition-shadow"},[...t[13]||(t[13]=[C('<div class="flex items-center gap-3" data-v-435bb847><div class="w-10 h-10 bg-teal-50 rounded-full flex items-center justify-center" data-v-435bb847><svg class="w-5 h-5 text-teal-600" fill="currentColor" viewBox="0 0 24 24" data-v-435bb847><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" data-v-435bb847></path></svg></div><span class="text-gray-800 font-medium" data-v-435bb847>隐私设置</span></div><svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24" data-v-435bb847><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" data-v-435bb847></path></svg>',2)])])]),g.value?(i(),a("div",{key:0,class:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center",onClick:x},[e("div",ce,[e("button",{onClick:x,class:"absolute top-4 right-4 w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all z-10"},[...t[14]||(t[14]=[e("svg",{class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])]),n.value>0?(i(),a("button",{key:0,onClick:b(V,["stop"]),class:"absolute left-4 w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all z-10"},[...t[15]||(t[15]=[e("svg",{class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})],-1)])])):h("",!0),e("img",{src:(d=s.value.photos[n.value])==null?void 0:d.photo_url,alt:"preview-"+n.value,class:"max-w-full max-h-full object-contain",onClick:t[0]||(t[0]=b(()=>{},["stop"]))},null,8,de),n.value<s.value.photos.length-1?(i(),a("button",{key:1,onClick:b(S,["stop"]),class:"absolute right-4 w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all z-10"},[...t[16]||(t[16]=[e("svg",{class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"})],-1)])])):h("",!0),e("div",ue,u(n.value+1)+" / "+u(s.value.photos.length),1)])])):h("",!0)])}}}),xe=I(ve,[["__scopeId","data-v-435bb847"]]);export{xe as default};
