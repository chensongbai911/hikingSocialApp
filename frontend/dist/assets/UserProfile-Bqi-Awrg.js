import{k as $,J as z,E as B,r as p,d as D,l as R,Y as S,v as o,q as i,z as t,x,A as n,O as w,P as k,G as F,y as M}from"./vue-Dq4PaVdn.js";import{t as c,b as _,m as E,_ as q}from"./index-CqUsN5uU.js";import{a as J}from"./activity-D3HqnBg2.js";import"./state-COm4LJOs.js";const V={class:"user-profile-page min-h-screen bg-white"},G={class:"relative h-64 overflow-hidden"},O=["src"],Y={key:1,class:"w-full h-full bg-gradient-to-br from-teal-400 to-blue-500"},H={class:"relative px-4 -mt-16"},K={class:"bg-white rounded-3xl shadow-xl p-6"},Q={class:"flex flex-col sm:flex-row items-start sm:items-start justify-between gap-4 sm:gap-4 mb-4"},W={class:"flex items-start flex-1 min-w-0"},X=["src"],Z={class:"ml-4 flex-1 min-w-0"},ee={class:"flex items-center gap-2 flex-wrap"},te={class:"text-2xl font-bold text-gray-800 truncate"},se={class:"px-3 py-1 bg-teal-500 text-white text-xs rounded-full font-semibold flex-shrink-0"},le={key:0,class:"text-gray-600 text-sm mt-1 truncate"},ae={class:"w-full sm:w-auto sm:flex-shrink-0 space-y-2"},oe=["disabled"],ie={key:0},re={key:1},ne=["disabled"],de={key:0},ce={key:1},ue=["disabled"],ve={key:0},ge={key:1},me={class:"grid grid-cols-2 gap-4 py-4 border-t border-b border-gray-100"},xe={class:"text-center"},fe={class:"text-2xl font-bold text-gray-800"},pe={class:"text-center"},he={class:"text-2xl font-bold text-gray-800"},_e={class:"px-4 mt-6"},be={class:"bg-white rounded-2xl p-5 shadow-sm"},ye={class:"text-gray-700 text-sm leading-relaxed"},we={class:"px-4 mt-6"},ke={class:"flex items-center justify-between mb-4"},je={key:0,class:"text-teal-500 text-sm font-medium"},Ce={key:0,class:"bg-gray-50 rounded-2xl p-8 text-center"},Ie={key:1,class:"grid grid-cols-3 gap-3"},Ae=["src","alt"],De={class:"absolute bottom-0 left-0 right-0 p-3 text-white"},Te={class:"font-bold text-sm mb-1"},Ue={class:"text-xs opacity-90"},Le={key:0,class:"px-4 mt-6"},Pe={class:"flex items-center justify-between mb-4"},Ne={class:"text-teal-500 text-sm font-medium"},$e={class:"space-y-3"},ze=["onClick"],Be=["src","alt"],Re={class:"ml-3 flex-1 flex flex-col justify-center"},Se={class:"font-bold text-gray-800 mb-1 line-clamp-1"},Fe={class:"flex items-center text-xs text-gray-500 mb-1"},Me={class:"mr-2"},Ee={class:"flex items-center justify-between mt-1"},qe={class:"px-4 mt-6 pb-32"},Je={key:0,class:"bg-gray-50 rounded-2xl p-8 text-center"},Ve={key:1,class:"flex gap-3 flex-wrap"},Ge=$({__name:"UserProfile",setup(Oe){const g=z(),T=B(),s=p(null),j=p(!0),u=p(!1),v=p(!1),f=p(!1);let h=!1,b=null;const C=D(()=>{var a,e;return((e=(a=s.value)==null?void 0:a.hikingTrails)==null?void 0:e.slice(0,3))||[]}),I=D(()=>{var a,e;return((e=(a=s.value)==null?void 0:a.publishedActivities)==null?void 0:e.slice(0,3))||[]}),U=a=>({ç™»å±±:"â›°ï¸",æ‘„å½±:"ğŸ“·",éœ²è¥:"â›º",å¾’æ­¥:"ğŸ¥¾",è¶Šé‡:"ğŸƒ",å†’é™©:"ğŸ§—",äº¤å‹:"ğŸ‘¥",æˆ·å¤–:"ğŸŒ²",è·¯çº¿å¼€å‘:"ğŸ—ºï¸",è‡ªç„¶:"ğŸƒ",éª‘è¡Œ:"ğŸš´",è¿åŠ¨:"âš½",è¯—æ­Œ:"âœï¸",æ—…æ¸¸:"âœˆï¸",ç¾é£Ÿ:"ğŸœ",å® ç‰©:"ğŸ•",æ…¢ç”Ÿæ´»:"â˜•"})[a]||"ğŸ·ï¸",L=()=>{g.back()},P=async()=>{if(!(!s.value||f.value))try{f.value=!0;const a=s.value.id;try{const e=await E.createConversation(a),l=(e==null?void 0:e.id)||(e==null?void 0:e.conversationId)||(e==null?void 0:e.conversation_id);l?(await new Promise(m=>setTimeout(m,200)),c.success("æ­£åœ¨æ‰“å¼€ç§ä¿¡..."),await g.push({path:"/messages",query:{conversationId:l}})):(console.error("createConversation è¿”å›å¼‚å¸¸:",e),c.error("åˆ›å»ºå¯¹è¯å¤±è´¥"))}catch(e){throw console.error("API é”™è¯¯:",e),e}}catch(a){console.error("æ‰“å¼€èŠå¤©å¤±è´¥:",a),c.error(a.message||"æ‰“å¼€èŠå¤©å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{f.value=!1}},A=async()=>{if(!(!s.value||v.value))try{v.value=!0;const a=s.value.id;if(u.value){const e=await _.unfollowUser(a);e.code===200?(u.value=!1,s.value.stats.followers=Math.max(0,s.value.stats.followers-1),c.success("å·²å–æ¶ˆå…³æ³¨")):c.error(e.message||"å–æ¶ˆå…³æ³¨å¤±è´¥")}else{const e=await _.followUser(a);e.code===200?(u.value=!0,s.value.stats.followers+=1,c.success("å…³æ³¨æˆåŠŸï¼ç°åœ¨å¯ä»¥å‘é€ç§ä¿¡äº†")):c.error(e.message||"å…³æ³¨å¤±è´¥")}}catch(a){console.error("å…³æ³¨æ“ä½œå¤±è´¥:",a),c.error("æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•")}finally{v.value=!1}};return R(async()=>{var e;const a=T.params.id;if(!a||a==="NaN"){c.error("ç”¨æˆ·IDæ— æ•ˆ"),g.back();return}if(h||b===a){console.log("é˜²æ­¢é‡å¤åŠ è½½:",a);return}try{h=!0,b=a,j.value=!0;const[l,m,y]=await Promise.all([_.getUserDetail(a),J.getUserJoinedActivities(a,{page_size:3}),_.getFollowStatus(a)]);if(l.code===200&&l.data){const r=l.data,N=((e=m.data)==null?void 0:e.items)||[];y.code===200&&y.data&&(u.value=y.data.is_following),s.value={id:r.id,nickname:r.nickname,gender:r.gender==="male"?"ç”·":r.gender==="female"?"å¥³":"å…¶ä»–",age:r.age||0,bio:r.bio||"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡å†™...",hikingLevel:r.hiking_level||"æ–°æ‰‹",province:r.province||"",city:r.city||"",region:r.region||"",tags:(r.preferences||[]).map(d=>d.preference_value),avatar:r.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=user${a}`,coverImage:r.photos&&r.photos[0]?r.photos[0].photo_url:"",stats:{activities:r.activities_count||0,followers:r.followers_count||0,following:0},hikingTrails:N.map(d=>({id:d.id,title:d.title,date:new Date(d.start_time).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit"}).replace(/\//g,"."),image:d.cover_image_url||"https://images.unsplash.com/photo-1551632811-561732d1e306?w=300&h=400&fit=crop"})),publishedActivities:r.photos?r.photos.slice(0,3).map(d=>({id:d.id,title:`ç…§ç‰‡ ${d.display_order}`,date:new Date(d.created_at).toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}),location:r.region||r.city||r.province||"åœ°ç‚¹æœªçŸ¥",image:d.photo_url,status:"completed"})):[]}}else c.error("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥"),g.back()}catch(l){console.error("åŠ è½½ç”¨æˆ·èµ„æ–™å¤±è´¥:",l),c.error("åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•"),g.back()}finally{j.value=!1,h=!1}}),S(()=>{b=null,h=!1}),(a,e)=>(i(),o("div",V,[t("div",G,[s.value&&s.value.coverImage?(i(),o("img",{key:0,src:s.value.coverImage,alt:"Cover",class:"w-full h-full object-cover"},null,8,O)):(i(),o("div",Y)),e[2]||(e[2]=t("div",{class:"absolute inset-0 bg-gradient-to-b from-black/30 to-transparent"},null,-1)),t("div",{class:"absolute top-0 left-0 right-0 flex items-center justify-between p-4"},[t("button",{onClick:L,class:"w-10 h-10 bg-white/90 backdrop-blur rounded-full flex items-center justify-center shadow-md"},[...e[0]||(e[0]=[t("span",{class:"text-xl"},"â†",-1)])]),e[1]||(e[1]=t("button",{class:"w-10 h-10 bg-white/90 backdrop-blur rounded-full flex items-center justify-center shadow-md"},[t("span",{class:"text-xl"},"â‹¯")],-1))])]),t("div",H,[t("div",K,[t("div",Q,[t("div",W,[t("img",{src:s.value&&s.value.avatar||"https://api.dicebear.com/7.x/avataaars/svg?seed=default",alt:"Avatar",class:"w-16 h-16 rounded-full border-4 border-white shadow-md flex-shrink-0"},null,8,X),t("div",Z,[t("div",ee,[t("h2",te,n(s.value&&s.value.nickname||"åŠ è½½ä¸­..."),1),t("span",se,n(s.value&&s.value.hikingLevel||"æ–°æ‰‹"),1)]),s.value&&(s.value.region||s.value.province||s.value.city)?(i(),o("p",le," ğŸ“ "+n(s.value.region||`${s.value.province||""} ${s.value.city||""}`.trim()),1)):x("",!0)])]),t("div",ae,[u.value?x("",!0):(i(),o("button",{key:0,onClick:A,disabled:v.value,class:"w-full px-4 py-2 bg-teal-500 text-white rounded-xl font-medium text-sm hover:bg-teal-600 transition active:scale-95 flex items-center justify-center gap-1"},[v.value?(i(),o("span",ie,"â³")):(i(),o("span",re,"+ å…³æ³¨"))],8,oe)),u.value?(i(),o("button",{key:1,onClick:P,disabled:f.value,class:"w-full px-4 py-2 bg-teal-500 text-white rounded-xl font-medium text-sm hover:bg-teal-600 transition active:scale-95 flex items-center justify-center gap-1"},[f.value?(i(),o("span",de,"â³ åŠ è½½ä¸­")):(i(),o("span",ce,"ğŸ’¬ ç§ä¿¡"))],8,ne)):x("",!0),u.value?(i(),o("button",{key:2,onClick:A,disabled:v.value,class:"w-full px-4 py-2 bg-gray-100 text-gray-600 rounded-xl font-medium text-sm hover:bg-gray-200 transition active:scale-95",title:"å–æ¶ˆå…³æ³¨"},[v.value?(i(),o("span",ve,"â³")):(i(),o("span",ge,"å–æ¶ˆå…³æ³¨"))],8,ue)):x("",!0)])]),t("div",me,[t("div",xe,[t("div",fe,n(s.value&&s.value.stats&&s.value.stats.activities||0),1),e[3]||(e[3]=t("div",{class:"text-xs text-gray-500 mt-1"},"å¾’æ­¥æ¬¡æ•°",-1))]),t("div",pe,[t("div",he,n(s.value&&s.value.stats&&s.value.stats.followers||0),1),e[4]||(e[4]=t("div",{class:"text-xs text-gray-500 mt-1"},"å…³æ³¨è€…",-1))])])])]),t("div",_e,[t("div",be,[e[5]||(e[5]=t("h3",{class:"text-lg font-bold text-gray-800 mb-3"},"ä¸ªäººç®€ä»‹",-1)),t("p",ye,n(s.value&&s.value.bio||"çƒ­çˆ±å¤§è‡ªç„¶çš„å±±é‡æ‹¾è’è€…ã€‚å·²ç»åœ¨å‘¨æœ«å¾æœäº†è‹æµ™æ²ªå‘¨è¾¹å¤§éƒ¨åˆ†å±±å³°ï¼Œå¸Œæœ›èƒ½åœ¨è¿™é‡Œé‡åˆ°å¿—åŒé“åˆã€èŠ‚å¥ä¸€è‡´çš„å°ä¼™ä¼´ä¸€èµ·æ¢ç´¢æ›´è¿œçš„é«˜å±±ã€‚æ€§æ ¼å¼€æœ—ï¼Œå¯ä»¥å¸®å¿™æ‹ç…§å’Œè´Ÿé‡ã€‚"),1)])]),t("div",we,[t("div",ke,[e[6]||(e[6]=t("h3",{class:"text-lg font-bold text-gray-800"},"å¾’æ­¥è¶³è¿¹",-1)),s.value&&s.value.hikingTrails&&s.value.hikingTrails.length?(i(),o("button",je," æŸ¥çœ‹å…¨éƒ¨ "+n(s.value.hikingTrails.length),1)):x("",!0)]),C.value.length?(i(),o("div",Ie,[(i(!0),o(w,null,k(C.value,(l,m)=>(i(),o("div",{key:m,class:"relative rounded-2xl overflow-hidden shadow-md",style:{"aspect-ratio":"3/4"}},[t("img",{src:l.image,alt:l.title,class:"w-full h-full object-cover"},null,8,Ae),e[8]||(e[8]=t("div",{class:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"},null,-1)),t("div",De,[t("h4",Te,n(l.title),1),t("p",Ue,n(l.date),1)])]))),128))])):(i(),o("div",Ce,[...e[7]||(e[7]=[t("div",{class:"text-5xl mb-3"},"ğŸ¥¾",-1),t("p",{class:"text-gray-500 text-sm"},"è¿˜æ²¡æœ‰å¾’æ­¥è¶³è¿¹",-1),t("p",{class:"text-gray-400 text-xs mt-1"},"æœŸå¾…TAçš„ç²¾å½©æˆ·å¤–æ—…ç¨‹",-1)])]))]),I.value.length>0?(i(),o("div",Le,[t("div",Pe,[e[9]||(e[9]=t("h3",{class:"text-lg font-bold text-gray-800"},"å‘å¸ƒçš„æ´»åŠ¨",-1)),t("button",Ne," æŸ¥çœ‹å…¨éƒ¨ "+n(s.value&&s.value.stats&&s.value.stats.activities),1)]),t("div",$e,[(i(!0),o(w,null,k(I.value,l=>(i(),o("div",{key:l.id,class:"flex bg-white rounded-2xl p-3 shadow-md active:scale-95 transition-transform cursor-pointer",onClick:m=>F(g).push(`/activity/${l.id}`)},[t("img",{src:l.image,alt:l.title,class:"w-20 h-20 rounded-xl object-cover"},null,8,Be),t("div",Re,[t("h4",Se,n(l.title),1),t("div",Fe,[t("span",Me,"ğŸ“… "+n(l.date),1),t("span",null,"ğŸ“ "+n(l.location),1)]),t("div",Ee,[t("span",{class:M(["text-xs px-2 py-0.5 rounded-full",{"bg-green-100 text-green-600":l.status==="ongoing","bg-blue-100 text-blue-600":l.status==="pending"||l.status==="approved","bg-gray-100 text-gray-600":l.status==="completed"||l.status==="cancelled"}])},n(l.status==="ongoing"?"è¿›è¡Œä¸­":l.status==="completed"?"å·²ç»“æŸ":"æ‹›å‹Ÿä¸­"),3),e[10]||(e[10]=t("span",{class:"text-teal-500 text-xs font-bold"},"ç‚¹å‡»åŠ å…¥ >",-1))])])],8,ze))),128))])])):x("",!0),t("div",qe,[e[12]||(e[12]=t("h3",{class:"text-lg font-bold text-gray-800 mb-4"},"å…´è¶£çˆ±å¥½",-1)),s.value&&s.value.tags&&s.value.tags.length?(i(),o("div",Ve,[(i(!0),o(w,null,k(s.value.tags,l=>(i(),o("span",{key:l,class:"px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium"},n(U(l))+" "+n(l),1))),128))])):(i(),o("div",Je,[...e[11]||(e[11]=[t("div",{class:"text-5xl mb-3"},"ğŸ·ï¸",-1),t("p",{class:"text-gray-500 text-sm"},"è¿˜æ²¡æœ‰è®¾ç½®å…´è¶£çˆ±å¥½",-1),t("p",{class:"text-gray-400 text-xs mt-1"},"æ›´å¤šäº†è§£ä»è®¾ç½®å…´è¶£å¼€å§‹",-1)])]))]),e[13]||(e[13]=t("div",{class:"h-8"},null,-1))]))}}),We=q(Ge,[["__scopeId","data-v-17362c38"]]);export{We as default};
