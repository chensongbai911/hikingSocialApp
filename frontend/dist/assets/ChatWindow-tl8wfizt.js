import{k as $e,J as je,E as Be,r as v,d as De,l as Ae,w as ze,W as Le,v as c,q as d,z as n,x as _,y as b,A as I,O as ve,P as ge,K as $,L as Ee,M as Pe,X as Oe,n as fe,G as j}from"./vue-Dq4PaVdn.js";import{u as He,s as F,c as he,t as x,d as Ve,b as Ne,e as pe,f as Fe,h as Ke,r as qe,j as Ge}from"./index-CYYPpPl2.js";import{u as Je}from"./upload-Z3mpmEZT.js";import"./state-COm4LJOs.js";const Xe={class:"fixed inset-0 bg-white flex flex-col z-50",style:{"max-height":"100dvh"}},Ye={class:"bg-white border-b border-gray-100 p-4 flex items-center space-x-3 flex-shrink-0"},Qe={class:"relative flex-shrink-0"},Ze=["src","alt"],et={class:"flex-1 min-w-0"},tt={class:"font-semibold text-gray-900 truncate text-base"},st={class:"text-xs truncate flex items-center space-x-1"},nt={key:0,class:"text-red-500"},at={key:0,class:"flex items-center space-x-2"},lt={class:"text-xs text-amber-700 bg-amber-100 px-2 py-1 rounded-full"},rt={key:0,class:"bg-red-50 text-red-600 text-sm px-4 py-2"},ot={key:1,class:"bg-red-50 text-red-600 text-sm px-4 py-2"},it={key:2,class:"bg-amber-50 text-amber-700 text-sm px-4 py-2"},ct={key:0,class:"text-center text-gray-400 py-8"},dt={key:1,class:"flex flex-col items-center justify-center py-16"},ut=["src","alt"],vt={class:"break-words"},gt={key:1,class:"rounded-2xl overflow-hidden"},ft=["src","onClick"],ht={key:2,class:"text-xs text-gray-400 px-3 py-2"},pt={class:"mt-1 text-xs text-gray-400"},xt={class:"whitespace-nowrap"},wt=["onClick"],mt=["onClick"],yt={key:2,class:"text-xs text-gray-500 mt-2"},kt={class:"bg-white border-t border-gray-100 p-4 flex-shrink-0 pb-6"},_t=["onClick"],bt={class:"flex items-end space-x-1.5"},Ct={class:"flex-1 bg-gray-50 rounded-2xl flex items-center min-w-0"},It=["disabled"],Ut={key:1,class:"mt-3 text-center"},Mt={class:"inline-flex items-center space-x-2 bg-red-50 text-red-600 px-4 py-2 rounded-full"},St={class:"text-sm font-medium"},Tt=["src"],Dt=$e({__name:"ChatWindow",setup(Wt){const Y=je(),B=Be(),Q=B==null?void 0:B.state,f=He(),y=v(B.params.id),D=v(""),K=v(),te=v(),L=v(),S=v(!1),U=v(!1),A=v(0),E=v(null),T=v(!1),k=v(void 0),M=v(!1),q=v(new Set);let z=null,W=null,se=0;const h=v([]),P=v(1),O=v(1),G=v(!1),J=v(!0),H=v(""),ne=e=>h.value.some(t=>t.id===e),g=v({id:"",name:"å¯¹æ–¹",avatar:"",isOnline:!0}),xe=["ğŸ˜Š","ğŸ˜‚","â¤ï¸","ğŸ‘","ğŸ™","ğŸ˜","ğŸ˜­","ğŸ¤”","ğŸ‘","ğŸ‰","ğŸ”¥","ğŸ’ª","ğŸŒŸ","âœ¨","ğŸŒˆ","ğŸŒ¸","ğŸŒº","ğŸŒ»","ğŸŒ","ğŸŒ™","â­","ğŸ’«","âœ…","âŒ"],ae=async()=>{var t;const e=B.params.id;if(y.value=e,!y.value){x.error("æ— æ•ˆçš„å¯¹è¯"),Y.push({name:"Messages"});return}try{J.value=!0,H.value="",console.log("[ChatWindow] å¼€å§‹åŠ è½½å¯¹è¯ï¼ŒID:",e);let s={};try{s=await Ve(e),console.log("[ChatWindow] è·å–å¯¹è¯ä¿¡æ¯æˆåŠŸ:",s)}catch(a){console.error("[ChatWindow] è·å–å¯¹è¯ä¿¡æ¯å¤±è´¥ï¼Œç»§ç»­åŠ è½½æ¶ˆæ¯:",a)}const{otherUserId:i,isLimited:l,remainingMessages:w,isBlacklisted:R}=s||{},m=i||e;g.value.id=m;try{console.log("[ChatWindow] è·å–ç”¨æˆ·èµ„æ–™:",m);const a=await Ne.getUserProfile(m);console.log("[ChatWindow] ç”¨æˆ·èµ„æ–™å“åº”:",a);const p=((t=a==null?void 0:a.data)==null?void 0:t.data)||(a==null?void 0:a.data)||a;p?(g.value.name=p.nickname||p.name||p.email||`ç”¨æˆ·${m.slice(-4)}`,g.value.avatar=p.avatar_url||p.avatar||g.value.avatar,g.value.isOnline=p.is_online??p.isOnline??!1,console.log("[ChatWindow] ç”¨æˆ·ä¿¡æ¯å·²è®¾ç½®:",g.value)):(console.warn("[ChatWindow] ç”¨æˆ·æ•°æ®ä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤å€¼"),g.value.name=`ç”¨æˆ·${m.slice(-4)}`)}catch(a){console.error("[ChatWindow] è·å–å¯¹æ–¹èµ„æ–™å¤±è´¥:",a),g.value.name=`ç”¨æˆ·${m.slice(-4)}`,(a==null?void 0:a.code)!==4001&&(a==null?void 0:a.code)!==404&&console.warn("[ChatWindow] å¿½ç•¥ç”¨æˆ·èµ„æ–™è·å–é”™è¯¯ï¼Œç»§ç»­åŠ è½½æ¶ˆæ¯")}T.value=!!l,k.value=w,M.value=!!R,console.log("[ChatWindow] å¯¹è¯é™åˆ¶ä¿¡æ¯:",{isLimited:T.value,remainingMessages:k.value,isBlacklisted:M.value}),console.log("[ChatWindow] å¼€å§‹åŠ è½½æ¶ˆæ¯åˆ—è¡¨ï¼ŒconversationId:",e);const u=await pe(e);console.log("[ChatWindow] getMessages è¿”å›å€¼:",u);const C=(u==null?void 0:u.messages)||u||[];console.log("[ChatWindow] è·å–æ¶ˆæ¯åˆ—è¡¨:",{total:u==null?void 0:u.total,count:C.length,rawMessages:C}),u!=null&&u.pagination?O.value=u.pagination.totalPages||1:u!=null&&u.totalPages&&(O.value=u.totalPages),P.value=1,h.value=C.map(a=>({id:String(a.id),content:a.content||a.imageUrl||a.image_url||a.fileUrl||a.file_url||"",contentType:a.contentType||a.content_type||"text",senderId:String(a.senderId||a.sender_id),createdAt:a.createdAt||a.created_at,isRecalled:a.isRecalled||a.is_recalled,imageUrl:a.imageUrl||a.image_url,fileUrl:a.fileUrl||a.file_url,sender:a.sender?{id:String(a.sender.id),nickname:a.sender.nickname||a.sender.name||"ç”¨æˆ·",avatarUrl:a.sender.avatarUrl||a.sender.avatar_url}:void 0})),console.log("[ChatWindow] è½¬æ¢åçš„æ¶ˆæ¯æ•°ç»„ï¼Œé•¿åº¦:",h.value.length,"å†…å®¹:",h.value),await he(y.value),X()}catch(s){console.error("[ChatWindow] åŠ è½½å¯¹è¯å¼‚å¸¸:",s),H.value=(s==null?void 0:s.message)||"åŠ è½½å¤±è´¥",x.error(H.value)}finally{J.value=!1,console.log("[ChatWindow] åŠ è½½å®Œæˆï¼Œmessages.length:",h.value.length,"loading:",J.value)}},we=()=>{(Q==null?void 0:Q.from)==="messages"?Y.push({name:"Messages"}):Y.back()},Z=async(e="text",t)=>{var i,l,w,R,m,u,C,a,p;if(M.value){x.warning("ä½ å·²è¢«å¯¹æ–¹æ‹‰é»‘ï¼Œæ— æ³•å‘é€");return}if(T.value&&k.value!==void 0&&k.value<=0){x.warning("æœªäº’å…³ä»…å¯å‘é€3æ¡æ¶ˆæ¯ï¼Œå·²è¾¾ä¸Šé™");return}const s=D.value.trim();if(!(e==="text"&&!s))try{const o=await Fe(y.value,e==="text"?s:"",e,t==null?void 0:t.imageUrl,void 0);console.log("[ChatWindow] å‘é€æ¶ˆæ¯å“åº”:",o);const r=(o==null?void 0:o.message)||((i=o==null?void 0:o.data)==null?void 0:i.message)||o;if(console.log("[ChatWindow] æå–çš„æ¶ˆæ¯å¯¹è±¡:",r),r&&!ne(String(r.id))){const N={id:String(r.id),content:r.content||r.imageUrl||r.image_url||r.fileUrl||r.file_url||"",contentType:r.contentType||r.content_type||e,senderId:String(r.senderId||r.sender_id||f.userId),createdAt:r.createdAt||r.created_at||new Date().toISOString(),isRecalled:r.isRecalled||r.is_recalled||!1,imageUrl:r.imageUrl||r.image_url,fileUrl:r.fileUrl||r.file_url,sender:r.sender?{id:String(r.sender.id),nickname:r.sender.nickname||((l=f.currentUser)==null?void 0:l.nickname)||"æˆ‘",avatarUrl:r.sender.avatarUrl||r.sender.avatar_url||((w=f.currentUser)==null?void 0:w.avatarUrl)}:{id:String(f.userId),nickname:((R=f.currentUser)==null?void 0:R.nickname)||"æˆ‘",avatarUrl:(m=f.currentUser)==null?void 0:m.avatarUrl}};console.log("[ChatWindow] æ·»åŠ æ–°æ¶ˆæ¯åˆ°åˆ—è¡¨:",N),h.value.push(N)}(o==null?void 0:o.remainingMessages)!==void 0&&(k.value=o.remainingMessages,console.log("[ChatWindow] æ›´æ–°å‰©ä½™æ¶ˆæ¯æ•°:",k.value)),e==="text"&&(D.value=""),re(),await fe(),X()}catch(o){console.error("[ChatWindow] å‘é€æ¶ˆæ¯å¤±è´¥:",o);const r=(o==null?void 0:o.code)||((C=(u=o==null?void 0:o.response)==null?void 0:u.data)==null?void 0:C.code),N=(o==null?void 0:o.message)||((p=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:p.message);if(r===3013||N==="message_limit_exceeded"){T.value=!0,k.value=0,x.warning("æœªäº’å…³ä»…å¯å‘é€3æ¡æ¶ˆæ¯ï¼Œè¯·äº’ç›¸å…³æ³¨åç»§ç»­èŠå¤©");return}x.error(N||"å‘é€å¤±è´¥")}},le=De(()=>{const e=T.value&&k.value!==void 0&&k.value<=0,t=!D.value.trim();return M.value||e||t}),me=async e=>{var i;const t=e.target.files;if(!t||!t.length)return;const s=t[0];if(s.size>10*1024*1024){x.warning("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡10MB"),e.target.value="";return}try{const l=await Je.uploadImage(s),w=((i=l==null?void 0:l.data)==null?void 0:i.url)||(l==null?void 0:l.url);if(!w)throw new Error("ä¸Šä¼ å¤±è´¥");await Z("image",{imageUrl:w})}catch(l){x.error((l==null?void 0:l.message)||"ä¸Šä¼ å¤±è´¥")}finally{e.target.value=""}},ye=async e=>{try{await qe(e),h.value=h.value.map(t=>t.id===e?{...t,isRecalled:!0}:t),x.success("å·²æ’¤å›")}catch(t){x.error((t==null?void 0:t.message)||"æ’¤å›å¤±è´¥")}},ke=async e=>{try{await Ge(e,"inappropriate"),x.success("å·²ä¸¾æŠ¥")}catch(t){x.error((t==null?void 0:t.message)||"ä¸¾æŠ¥å¤±è´¥")}},_e=async()=>{try{await Ke(y.value),h.value=[],x.success("å·²æ¸…ç©ºå¹¶å½’æ¡£")}catch(e){x.error((e==null?void 0:e.message)||"æ¸…ç©ºå¤±è´¥")}},X=()=>{fe(()=>{K.value&&(K.value.scrollTop=K.value.scrollHeight)})},be=async()=>{if(!(G.value||P.value>=O.value))try{G.value=!0;const e=P.value+1,t=await pe(y.value,e);t!=null&&t.pagination&&(O.value=t.pagination.totalPages||1);const i=((t==null?void 0:t.messages)||(t==null?void 0:t.items)||[]).map(l=>({id:String(l.id),content:l.content||l.imageUrl||l.image_url||l.fileUrl||l.file_url||"",contentType:l.contentType||l.content_type||"text",senderId:String(l.senderId||l.sender_id),createdAt:l.createdAt||l.created_at,isRecalled:l.isRecalled||l.is_recalled,imageUrl:l.imageUrl||l.image_url,fileUrl:l.fileUrl||l.file_url,sender:l.sender?{id:String(l.sender.id),nickname:l.sender.nickname||l.sender.name||"ç”¨æˆ·",avatarUrl:l.sender.avatarUrl||l.sender.avatar_url}:void 0}));h.value.unshift(...i),P.value=e}catch(e){console.error("[ChatWindow] åŠ è½½æ›´å¤šæ¶ˆæ¯å¤±è´¥:",e)}finally{G.value=!1}},Ce=e=>{const t=e.target;t&&t.scrollTop<100&&!G.value&&P.value<O.value&&be()},Ie=e=>{if(!(e instanceof Date)||isNaN(e.getTime()))return"";const s=new Date().getTime()-e.getTime();if(s<6e4)return"åˆšåˆš";if(s<36e5)return`${Math.floor(s/6e4)}åˆ†é’Ÿå‰`;if(s<864e5)return`${Math.floor(s/36e5)}å°æ—¶å‰`;const i=l=>l.toString().padStart(2,"0");return`${e.getFullYear()}-${i(e.getMonth()+1)}-${i(e.getDate())} ${i(e.getHours())}:${i(e.getMinutes())}:${i(e.getSeconds())}`},re=()=>{if(L.value){L.value.style.height="auto";const e=Math.min(L.value.scrollHeight,128);L.value.style.height=`${e}px`}},Ue=e=>{const t=new Date(e).getTime();return Date.now()-t<12e4},oe=e=>{F.sendTyping(y.value,e)},Me=()=>{oe(!0),z&&window.clearTimeout(z),z=window.setTimeout(()=>oe(!1),1500)},ie=()=>{re(),Me()},ce=()=>{S.value&&(S.value=!1)},Se=()=>{var e;return(e=te.value)==null?void 0:e.click()},Te=e=>{D.value+=e,ie()},We=()=>{S.value=!S.value},de=()=>{U.value||(U.value=!0,se=Date.now(),A.value=0,W=window.setInterval(()=>{A.value=Math.floor((Date.now()-se)/1e3),A.value>=60&&ee()},200))},ee=()=>{U.value&&(U.value=!1,W&&(clearInterval(W),W=null),A.value=0)},ue=()=>{U.value&&(U.value=!1,W&&(clearInterval(W),W=null),A.value=0)},Re=e=>{E.value=e},V=[];return Ae(async()=>{await ae(),X(),document.addEventListener("click",ce),V.push(F.onMessageReceived(e=>{var s,i,l,w,R,m,u,C,a,p;if(String(e.conversationId||e.conversation_id)!==y.value)return;const t=String(e.id||((s=e.message)==null?void 0:s.id)||Date.now());ne(t)||(h.value.push({id:t,content:((i=e.message)==null?void 0:i.content)||e.content||((l=e.message)==null?void 0:l.image_url)||e.imageUrl||"",contentType:((w=e.message)==null?void 0:w.content_type)||e.contentType||"text",senderId:String(((R=e.message)==null?void 0:R.sender_id)||e.senderId||e.sender_id),createdAt:((m=e.message)==null?void 0:m.created_at)||e.createdAt||new Date().toISOString(),isRecalled:(u=e.message)==null?void 0:u.is_recalled,imageUrl:((C=e.message)==null?void 0:C.image_url)||e.imageUrl,fileUrl:((a=e.message)==null?void 0:a.file_url)||e.fileUrl}),String(((p=e.message)==null?void 0:p.sender_id)||e.senderId||e.sender_id)!==String(f.userId)&&he(y.value).catch(()=>{}),X())})),V.push(F.onRecall(e=>{String(e.conversationId)===y.value&&(h.value=h.value.map(t=>t.id===String(e.messageId)?{...t,isRecalled:!0}:t))})),V.push(F.onBlacklist(e=>{(String(e.targetUserId)===f.userId||String(e.userId)===g.value.id)&&(M.value=e.action==="added")})),V.push(F.onUserTyping(e=>{if(String(e.conversationId)!==y.value)return;const t=new Set(q.value);e.isTyping&&e.fromUserId!==f.userId?t.add(String(e.fromUserId)):t.delete(String(e.fromUserId)),q.value=t,z&&window.clearTimeout(z),z=window.setTimeout(()=>{q.value=new Set},3e3)}))}),ze(()=>B.params.id,async(e,t)=>{e&&e!==t&&await ae()}),Le(()=>{document.removeEventListener("click",ce),V.forEach(e=>e())}),(e,t)=>(d(),c("div",Xe,[n("div",Ye,[n("button",{onClick:we,class:"p-2 -ml-2"},[...t[7]||(t[7]=[n("svg",{class:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),n("div",Qe,[n("img",{src:g.value.avatar||"https://placehold.co/48x48",alt:g.value.name,class:"w-10 h-10 rounded-full object-cover"},null,8,Ze),M.value?_("",!0):(d(),c("div",{key:0,class:b(["absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white",g.value.isOnline?"bg-green-500":"bg-gray-400"])},null,2))]),n("div",et,[n("h2",tt,I(g.value.name||"å¯¹æ–¹"),1),n("p",st,[M.value?(d(),c("span",nt,"å·²è¢«å¯¹æ–¹æ‹‰é»‘")):(d(),c("span",{key:1,class:b(g.value.isOnline?"text-green-600":"text-gray-500")},I(g.value.isOnline?"åœ¨çº¿":"ç¦»çº¿"),3))])]),T.value?(d(),c("div",at,[n("span",lt,"å‰©ä½™ "+I(k.value??0)+" / 3",1)])):_("",!0),n("button",{onClick:_e,class:"p-2 text-gray-500 hover:text-red-500",title:"æ¸…ç©ºå¯¹è¯"},[...t[8]||(t[8]=[n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),H.value?(d(),c("div",rt,I(H.value),1)):M.value?(d(),c("div",ot," å¯¹æ–¹å·²å°†ä½ æ‹‰é»‘ï¼Œæ— æ³•å‘é€æ¶ˆæ¯ ")):T.value?(d(),c("div",it," æœªäº’å…³ï¼Œä»…å¯å†å‘é€ "+I(k.value??0)+" æ¡æ¶ˆæ¯ ",1)):_("",!0),n("div",{ref_key:"messagesContainer",ref:K,class:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",onScroll:Ce},[J.value?(d(),c("div",ct,"åŠ è½½ä¸­...")):h.value.length?_("",!0):(d(),c("div",dt,[...t[9]||(t[9]=[n("svg",{class:"w-20 h-20 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),n("p",{class:"text-gray-400 text-center mb-2"},"æš‚æ—¶æ²¡æœ‰æ¶ˆæ¯",-1),n("p",{class:"text-gray-400 text-sm text-center"},"å¼€å§‹ä½ ä»¬çš„ç¬¬ä¸€æ¬¡å¯¹è¯å§ï½",-1)])])),(d(!0),c(ve,null,ge(h.value,s=>{var i,l;return d(),c("div",{key:s.id,class:b(["flex",s.senderId===j(f).userId?"justify-end":"justify-start"])},[n("div",{class:b(["flex",s.senderId===j(f).userId?"flex-row-reverse":"flex-row","items-end space-x-2 w-[100%]"])},[s.senderId!==j(f).userId?(d(),c("img",{key:0,src:((i=s.sender)==null?void 0:i.avatarUrl)||g.value.avatar||"https://placehold.co/48x48",alt:((l=s.sender)==null?void 0:l.nickname)||g.value.name,class:"w-8 h-8 rounded-full object-cover flex-shrink-0"},null,8,ut)):_("",!0),n("div",{class:b(["max-w-[70%]",s.senderId===j(f).userId?"mr-2":"ml-2"])},[s.contentType==="text"&&!s.isRecalled?(d(),c("div",{key:0,class:b(["px-4 py-2 rounded-2xl",s.senderId===j(f).userId?"bg-teal-500 text-white rounded-br-sm":"bg-white text-gray-800 rounded-bl-sm"])},[n("p",vt,I(s.content),1)],2)):s.contentType==="image"&&!s.isRecalled?(d(),c("div",gt,[n("img",{src:s.imageUrl||s.content,alt:"å›¾ç‰‡",class:"max-w-full h-auto cursor-pointer",onClick:w=>Re(s.imageUrl||s.content)},null,8,ft)])):(d(),c("div",ht,"æ¶ˆæ¯å·²æ’¤å›")),n("div",pt,[n("div",{class:b(["flex items-center gap-3 whitespace-nowrap",s.senderId===j(f).userId?"justify-end":"justify-start"])},[n("span",xt,I(Ie(new Date(s.createdAt))),1),s.senderId===j(f).userId&&!s.isRecalled&&Ue(s.createdAt)?(d(),c("button",{key:0,class:"hover:text-red-500",onClick:w=>ye(s.id)},"æ’¤å›",8,wt)):s.isRecalled?_("",!0):(d(),c("button",{key:1,class:"hover:text-amber-600",onClick:w=>ke(s.id)},"ä¸¾æŠ¥",8,mt))],2)])],2)],2)],2)}),128)),q.value.size>0?(d(),c("div",yt,"å¯¹æ–¹æ­£åœ¨è¾“å…¥...")):_("",!0)],544),n("div",kt,[S.value?(d(),c("div",{key:0,class:"mb-3 p-3 bg-gray-50 rounded-2xl grid grid-cols-8 gap-2 max-h-48 overflow-y-auto",onClick:t[0]||(t[0]=$(()=>{},["stop"]))},[(d(),c(ve,null,ge(xe,s=>n("button",{key:s,onClick:i=>Te(s),class:"text-2xl hover:scale-125 transition-transform"},I(s),9,_t)),64))])):_("",!0),n("div",bt,[n("button",{onMousedown:de,onMouseup:ee,onMouseleave:ue,onTouchstart:$(de,["prevent"]),onTouchend:$(ee,["prevent"]),onTouchcancel:$(ue,["prevent"]),class:b(["p-2.5 rounded-full transition-all duration-200 flex-shrink-0",U.value?"bg-red-500 text-white scale-110":"bg-gray-100 text-gray-600 hover:bg-gray-200"])},[...t[10]||(t[10]=[n("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[n("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),n("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})],-1)])],34),n("div",Ct,[Ee(n("textarea",{ref_key:"textInput",ref:L,"onUpdate:modelValue":t[1]||(t[1]=s=>D.value=s),placeholder:"è¾“å…¥æ¶ˆæ¯...",rows:"1",class:"flex-1 bg-transparent px-3 py-2.5 focus:outline-none resize-none max-h-32 overflow-y-auto text-sm",onInput:ie,onKeydown:t[2]||(t[2]=Oe($(s=>Z(),["exact","prevent"]),["enter"])),onFocus:t[3]||(t[3]=s=>S.value=!1)},null,544),[[Pe,D.value]]),n("button",{onClick:$(We,["stop"]),class:b(["p-2 transition-colors flex-shrink-0",S.value?"text-teal-500":"text-gray-600"])},[...t[11]||(t[11]=[n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],2),n("button",{onClick:Se,class:"p-2 text-gray-600 hover:text-teal-500 transition-colors flex-shrink-0"},[...t[12]||(t[12]=[n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])]),n("input",{ref_key:"imageInput",ref:te,type:"file",accept:"image/*",class:"hidden",onChange:me},null,544)]),n("button",{onClick:t[4]||(t[4]=s=>Z()),disabled:le.value,class:b(["p-2.5 rounded-full transition-all duration-200 flex-shrink-0",le.value?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-teal-500 text-white hover:bg-teal-600"])},[...t[13]||(t[13]=[n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],10,It)]),U.value?(d(),c("div",Ut,[n("div",Mt,[t[14]||(t[14]=n("div",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),n("span",St,"æ­£åœ¨å½•éŸ³ "+I(A.value)+'"',1)]),t[15]||(t[15]=n("p",{class:"text-xs text-gray-500 mt-2"},"æ¾å¼€å‘é€ï¼Œæ»‘å‡ºå–æ¶ˆ",-1))])):_("",!0)]),E.value?(d(),c("div",{key:3,onClick:t[6]||(t[6]=s=>E.value=null),class:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4"},[n("img",{src:E.value,alt:"é¢„è§ˆ",class:"max-w-full max-h-full object-contain"},null,8,Tt),n("button",{onClick:t[5]||(t[5]=$(s=>E.value=null,["stop"])),class:"absolute top-4 right-4 p-2 bg-white/20 rounded-full text-white"},[...t[16]||(t[16]=[n("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):_("",!0)]))}});export{Dt as default};
