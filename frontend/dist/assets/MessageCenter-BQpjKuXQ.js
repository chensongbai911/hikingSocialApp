import{k as P,J as G,r as d,d as $,l as H,v as n,q as i,z as s,x as r,y as _,A as o,L as D,M as S,N as K}from"./vue-B6Xl8iL6.js";import{m as O,t as m,_ as Q}from"./index-C2PV4XN9.js";import"./state-BRWMog1q.js";const U={class:"message-center"},W={class:"tabs"},X={key:0,class:"badge"},Y={key:0,class:"badge"},Z={key:0,class:"badge"},tt={key:0,class:"tab-content"},et={key:0,class:"loading-container"},st={key:1,class:"empty"},at={key:2,class:"conversation-list"},nt=["onClick"],it=["src","alt"],ot={class:"conversation-info"},lt={class:"header"},rt={class:"name"},ct={class:"time"},dt={class:"preview"},ut={class:"message"},vt={key:0,class:"unread-badge"},_t=["onClick"],yt={key:1,class:"tab-content"},pt={key:0,class:"loading-container"},mt={key:1,class:"empty"},ft={key:2,class:"notification-list"},ht={class:"notification-content"},gt={class:"text"},kt={class:"time"},Ct=["onClick"],wt={key:2,class:"tab-content"},bt={key:0,class:"loading-container"},$t={key:1,class:"empty"},Dt={key:2,class:"activity-message-list"},St=["onClick"],At={class:"message-content"},It={class:"title"},Mt={class:"text"},Nt={class:"footer"},xt={class:"activity-name"},Tt={class:"time"},Ot={key:3,class:"error-banner"},Et=P({__name:"MessageCenter",setup(zt){const A=G(),c=d("conversations"),f=d(!1),h=d(!1),g=d(!1),l=d(null),u=d([]),y=d([]),p=d([]),k=e=>{c.value=e,window.scrollTo({top:0,behavior:"smooth"}),e==="conversations"&&u.value.length===0?C():e==="notifications"&&y.value.length===0?E():e==="activity"&&p.value.length===0&&z()},C=async()=>{try{f.value=!0,l.value=null;const e=await O.getConversations();console.log("Conversations API response:",e),e&&Array.isArray(e.data)&&(u.value=e.data.map(t=>({id:t.id,name:t.other_user_name||"æœªçŸ¥ç”¨æˆ·",avatar_url:t.other_user_avatar||"",last_message:t.last_message||"",last_message_time:t.last_message_time||new Date().toISOString(),unread_count:t.unread_count||0})))}catch(e){console.error("åŠ è½½å¯¹è¯å¤±è´¥:",e),l.value="åŠ è½½å¯¹è¯å¤±è´¥ï¼Œè¯·é‡è¯•",m.error("åŠ è½½å¯¹è¯å¤±è´¥")}finally{f.value=!1}},E=async()=>{try{h.value=!0,l.value=null,y.value=[{id:"1",type:"friend",content:"çŽ‹äº” æŽ¥å—äº†ä½ çš„å¥½å‹è¯·æ±‚",created_at:new Date(Date.now()-18e5).toISOString(),is_read:!1},{id:"2",type:"system",content:"æ‚¨çš„è´¦å·å®‰å…¨ç­‰çº§å·²æå‡",created_at:new Date(Date.now()-864e5).toISOString(),is_read:!0}]}catch(e){console.error("åŠ è½½é€šçŸ¥å¤±è´¥:",e),l.value="åŠ è½½é€šçŸ¥å¤±è´¥ï¼Œè¯·é‡è¯•",m.error("åŠ è½½é€šçŸ¥å¤±è´¥")}finally{h.value=!1}},z=async()=>{try{g.value=!0,l.value=null,p.value=[{id:"1",type:"application_approved",title:"æŠ¥åé€šè¿‡",content:"æ‚¨çš„æ´»åŠ¨æŠ¥åç”³è¯·å·²é€šè¿‡",activity_name:"å‘¨æœ«é¦™å±±å¾’æ­¥",activity_id:"1",created_at:new Date(Date.now()-36e5).toISOString(),is_read:!1},{id:"2",type:"activity_reminder",title:"æ´»åŠ¨æé†’",content:"æ´»åŠ¨å°†åœ¨1å°æ—¶åŽå¼€å§‹,è¯·åšå¥½å‡†å¤‡",activity_name:"æ¤ç‰©å›­å¾’æ­¥",activity_id:"2",created_at:new Date(Date.now()-72e5).toISOString(),is_read:!1}]}catch(e){console.error("åŠ è½½æ´»åŠ¨æ¶ˆæ¯å¤±è´¥:",e),l.value="åŠ è½½æ´»åŠ¨æ¶ˆæ¯å¤±è´¥ï¼Œè¯·é‡è¯•",m.error("åŠ è½½æ´»åŠ¨æ¶ˆæ¯å¤±è´¥")}finally{g.value=!1}},I=$(()=>u.value.reduce((e,t)=>e+(t.unread_count||0),0)),M=$(()=>y.value.filter(e=>!e.is_read).length),N=$(()=>p.value.filter(e=>!e.is_read).length),B=e=>{A.push(`/chat/${e}`)},L=async e=>{try{await O.clearConversation(String(e)),u.value=u.value.filter(t=>t.id!==e),m.success("å¯¹è¯å·²åˆ é™¤")}catch(t){console.error("åˆ é™¤å¯¹è¯å¤±è´¥:",t),m.error("åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•")}},R=e=>{const t=y.value.find(a=>a.id===e);t&&(t.is_read=!0)},V=e=>{e.is_read=!0,A.push(`/activity/${e.activity_id}`)},w=e=>{try{const t=new Date(e),v=new Date().getTime()-t.getTime(),b=Math.floor(v/6e4),x=Math.floor(v/36e5),T=Math.floor(v/864e5);return b<1?"åˆšåˆš":b<60?`${b}åˆ†é’Ÿå‰`:x<24?`${x}å°æ—¶å‰`:T<7?`${T}å¤©å‰`:t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})}catch{return"æœªçŸ¥æ—¶é—´"}},j=e=>({friend:"ðŸ‘¥",system:"âš™ï¸",activity:"ðŸŽ¯",comment:"ðŸ’¬",like:"â¤ï¸"})[e]||"ðŸ“¢",q=e=>({application_approved:"âœ…",application_rejected:"âŒ",activity_reminder:"â°",activity_cancelled:"ðŸš«",activity_updated:"ðŸ“",new_participant:"ðŸ‘‹"})[e]||"ðŸŽ¯",F=e=>{const t=e.target;t.src="/default-avatar.png"},J=()=>{l.value=null};return H(()=>{C();const e=setInterval(()=>{c.value==="conversations"&&C()},3e4);return()=>clearInterval(e)}),(e,t)=>(i(),n("div",U,[s("div",W,[s("div",{class:_(["tab",{active:c.value==="conversations"}]),onClick:t[0]||(t[0]=a=>k("conversations"))},[t[3]||(t[3]=s("span",null,"ç§ä¿¡",-1)),I.value>0?(i(),n("span",X,o(I.value),1)):r("",!0)],2),s("div",{class:_(["tab",{active:c.value==="notifications"}]),onClick:t[1]||(t[1]=a=>k("notifications"))},[t[4]||(t[4]=s("span",null,"é€šçŸ¥",-1)),M.value>0?(i(),n("span",Y,o(M.value),1)):r("",!0)],2),s("div",{class:_(["tab",{active:c.value==="activity"}]),onClick:t[2]||(t[2]=a=>k("activity"))},[t[5]||(t[5]=s("span",null,"æ´»åŠ¨æ¶ˆæ¯",-1)),N.value>0?(i(),n("span",Z,o(N.value),1)):r("",!0)],2)]),c.value==="conversations"?(i(),n("div",tt,[f.value?(i(),n("div",et,[...t[6]||(t[6]=[s("div",{class:"spinner"},null,-1),s("p",null,"åŠ è½½å¯¹è¯ä¸­...",-1)])])):u.value.length===0?(i(),n("div",st,[...t[7]||(t[7]=[s("div",{class:"empty-icon"},"ðŸ’¬",-1),s("p",null,"æš‚æ— ç§ä¿¡",-1)])])):(i(),n("div",at,[(i(!0),n(D,null,S(u.value,a=>(i(),n("div",{key:a.id,class:"conversation-item",onClick:v=>B(a.id)},[s("img",{src:a.avatar_url||"/default-avatar.png",alt:a.name,class:"avatar",onError:F},null,40,it),s("div",ot,[s("div",lt,[s("h4",rt,o(a.name),1),s("span",ct,o(w(a.last_message_time)),1)]),s("div",dt,[s("p",ut,o(a.last_message||"æš‚æ— æ¶ˆæ¯"),1),a.unread_count&&a.unread_count>0?(i(),n("span",vt,o(a.unread_count),1)):r("",!0)])]),s("button",{class:"delete-btn",onClick:K(v=>L(a.id),["stop"]),title:"åˆ é™¤å¯¹è¯"}," âœ• ",8,_t)],8,nt))),128))]))])):r("",!0),c.value==="notifications"?(i(),n("div",yt,[h.value?(i(),n("div",pt,[...t[8]||(t[8]=[s("div",{class:"spinner"},null,-1),s("p",null,"åŠ è½½é€šçŸ¥ä¸­...",-1)])])):y.value.length===0?(i(),n("div",mt,[...t[9]||(t[9]=[s("div",{class:"empty-icon"},"ðŸ””",-1),s("p",null,"æš‚æ— é€šçŸ¥",-1)])])):(i(),n("div",ft,[(i(!0),n(D,null,S(y.value,a=>(i(),n("div",{key:a.id,class:_(["notification-item",{unread:!a.is_read}])},[s("div",{class:_(["icon",`icon-${a.type}`])},o(j(a.type)),3),s("div",ht,[s("p",gt,o(a.content),1),s("span",kt,o(w(a.created_at)),1)]),a.is_read?r("",!0):(i(),n("button",{key:0,class:"mark-read",onClick:v=>R(a.id),title:"æ ‡è®°ä¸ºå·²è¯»"}," âœ“ ",8,Ct))],2))),128))]))])):r("",!0),c.value==="activity"?(i(),n("div",wt,[g.value?(i(),n("div",bt,[...t[10]||(t[10]=[s("div",{class:"spinner"},null,-1),s("p",null,"åŠ è½½æ´»åŠ¨æ¶ˆæ¯ä¸­...",-1)])])):p.value.length===0?(i(),n("div",$t,[...t[11]||(t[11]=[s("div",{class:"empty-icon"},"ðŸŽ¯",-1),s("p",null,"æš‚æ— æ´»åŠ¨æ¶ˆæ¯",-1)])])):(i(),n("div",Dt,[(i(!0),n(D,null,S(p.value,a=>(i(),n("div",{key:a.id,class:_(["activity-message-item",{unread:!a.is_read}]),onClick:v=>V(a)},[s("div",{class:_(["icon",`icon-${a.type}`])},o(q(a.type)),3),s("div",At,[s("h4",It,o(a.title),1),s("p",Mt,o(a.content),1),s("div",Nt,[s("span",xt,o(a.activity_name),1),s("span",Tt,o(w(a.created_at)),1)])])],10,St))),128))]))])):r("",!0),l.value?(i(),n("div",Ot,[s("p",null,o(l.value),1),s("button",{onClick:J,class:"close-btn"},"âœ•")])):r("",!0)]))}}),Vt=Q(Et,[["__scopeId","data-v-3e4e3aa1"]]);export{Vt as default};
