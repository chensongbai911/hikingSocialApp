import{k as Me,r as v,l as Se,W as Le,v as n,q as l,z as e,x as m,L as R,M as ee,O as L,P as j,A as u,d as le,w as Te,S as Pe,X as Ie,N as Fe,K as ve,y as ne,J as Be,E as Ue,p as Ae,U as ze}from"./vue-Dq4PaVdn.js";import{u as He}from"./activity-BGUY0WSj.js";import{t as b,_ as De,a as K}from"./index-Bhs_HTB-.js";import"./state-COm4LJOs.js";import"./activity-B4jLDCAZ.js";const Ne={class:"fixed inset-0 bg-white z-50 flex flex-col"},Re={class:"border-b border-gray-100"},qe={class:"flex items-center justify-between p-4"},Ve={class:"px-4 pb-4"},Ge={class:"relative"},Ee={key:0,class:"mt-2 bg-white rounded-2xl shadow-lg max-h-60 overflow-y-auto"},Oe=["onClick"],Ke={class:"font-medium text-gray-800"},Je={class:"text-sm text-gray-500 mt-1"},Ye={class:"flex-1 relative"},We={class:"bg-white border-t border-gray-100 p-4"},Ze={key:0,class:"bg-gray-50 rounded-2xl p-4 mb-4"},Qe={class:"flex items-start"},Xe={class:"ml-3 flex-1"},et={class:"font-medium text-gray-800"},tt={class:"text-sm text-gray-500 mt-1"},st=["disabled"],ot=Me({__name:"MapPicker",emits:["close","confirm"],setup(P,{emit:T}){const q=T,M=v(null),$=v(""),C=v([]),w=v({name:"",address:"",lat:0,lng:0});let r=null,F=null,z=null,f=null;Se(()=>{N()}),Le(()=>{r&&r.destroy(),f&&clearTimeout(f)});const N=()=>{if(!window.AMap){b.error("åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–APIå¯†é’¥é…ç½®");return}r=new window.AMap.Map(M.value,{zoom:14,center:[116.397428,39.90923],viewMode:"2D",pitch:0,mapStyle:"amap://styles/normal",zooms:[3,18]}),r.on("complete",()=>{setTimeout(()=>{const p=document.querySelector(".amap-logo"),d=document.querySelector(".amap-copyright");p&&(p.style.display="none"),d&&(d.style.display="none")},100)}),F=new window.AMap.Geocoder({city:"åŒ—äº¬"}),z=new window.AMap.PlaceSearch({city:"åŒ—äº¬",pageSize:10,pageIndex:1}),r.on("moveend",()=>{const p=r.getCenter();B(p.lng,p.lat)}),V()},V=()=>{if(!window.AMap)return;new window.AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4}).getCurrentPosition((d,y)=>{if(d==="complete"){const{lng:D,lat:x}=y.position;r.setCenter([D,x]),B(D,x)}else console.log("å®šä½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤ä½ç½®")})},B=(p,d)=>{F&&F.getAddress([p,d],(y,D)=>{if(y==="complete"&&D.info==="OK"){const x=D.regeocode.addressComponent,re=D.regeocode.formattedAddress,h=D.regeocode.pois[0];w.value={name:h?h.name:x.township||x.district,address:re,lat:d,lng:p}}})},J=()=>{f&&clearTimeout(f),f=window.setTimeout(()=>{if(!$.value.trim()||!z){C.value=[];return}z.search($.value,(p,d)=>{p==="complete"&&d.poiList&&d.poiList.pois?C.value=d.poiList.pois.map(y=>({name:y.name,address:y.address||y.pname+y.cityname+y.adname,location:y.location})):C.value=[]})},300)},S=p=>{const{lng:d,lat:y}=p.location;r.setCenter([d,y]),C.value=[],$.value="",B(d,y)},k=()=>{w.value.name&&q("confirm",w.value)};return(p,d)=>(l(),n("div",Ne,[e("div",Re,[e("div",qe,[e("button",{onClick:d[0]||(d[0]=y=>p.$emit("close")),class:"p-2 -ml-2"},[...d[2]||(d[2]=[e("svg",{class:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),d[3]||(d[3]=e("h3",{class:"text-lg font-bold text-gray-800"},"é€‰æ‹©é›†åˆåœ°ç‚¹",-1)),d[4]||(d[4]=e("div",{class:"w-6"},null,-1))]),e("div",Ve,[e("div",Ge,[R(e("input",{"onUpdate:modelValue":d[1]||(d[1]=y=>$.value=y),onInput:J,type:"text",placeholder:"æœç´¢åœ°ç‚¹",class:"w-full pl-10 pr-4 py-3 bg-gray-50 rounded-2xl focus:outline-none focus:ring-2 focus:ring-teal-500"},null,544),[[ee,$.value]]),d[5]||(d[5]=e("svg",{class:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),C.value.length>0?(l(),n("div",Ee,[(l(!0),n(L,null,j(C.value,(y,D)=>(l(),n("div",{key:D,onClick:x=>S(y),class:"p-3 border-b border-gray-100 last:border-b-0 hover:bg-gray-50 cursor-pointer"},[e("div",Ke,u(y.name),1),e("div",Je,u(y.address),1)],8,Oe))),128))])):m("",!0)])]),e("div",Ye,[e("div",{ref_key:"mapContainer",ref:M,class:"w-full h-full"},null,512),d[7]||(d[7]=e("div",{class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none"},[e("svg",{class:"w-12 h-12 text-teal-500 drop-shadow-lg",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})])],-1)),e("button",{onClick:V,class:"absolute bottom-24 right-4 w-12 h-12 bg-white rounded-full shadow-lg flex items-center justify-center"},[...d[6]||(d[6]=[e("svg",{class:"w-6 h-6 text-teal-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])])]),e("div",We,[w.value.name?(l(),n("div",Ze,[e("div",Qe,[d[8]||(d[8]=e("svg",{class:"w-5 h-5 text-teal-500 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})],-1)),e("div",Xe,[e("div",et,u(w.value.name),1),e("div",tt,u(w.value.address),1)])])])):m("",!0),e("button",{onClick:k,disabled:!w.value.name,class:"w-full py-4 bg-teal-500 text-white font-medium rounded-2xl disabled:bg-gray-300 disabled:cursor-not-allowed"}," ç¡®è®¤ä½ç½® ",8,st)])]))}}),at=De(ot,[["__scopeId","data-v-127d30b8"]]),X={getDestinations:P=>K.get("/destinations",{params:P}),getDestinationById:P=>K.get(`/destinations/${P}`),getPopularDestinations:P=>K.get("/destinations/popular",{params:{limit:P}}),getNearbyDestinations:(P,T,q,M)=>K.get("/destinations/nearby",{params:{latitude:P,longitude:T,radius:q,limit:M}}),recordSearch:(P,T)=>K.post("/destinations/search/record",{keyword:P,destinationId:T}),getSearchHistory:P=>K.get("/destinations/search/history",{params:{limit:P}}),toggleFavorite:P=>K.post(`/destinations/${P}/favorite`),getFavorites:()=>K.get("/destinations/favorites/list")},lt={class:"fixed inset-0 bg-white z-50 flex flex-col"},nt={class:"bg-white border-b border-gray-100"},rt={class:"flex items-center justify-center relative px-4 py-4"},it={key:0,class:"px-4 pb-4"},dt={class:"relative"},ut={key:1,class:"absolute top-full left-4 right-4 mt-2 bg-white border border-gray-200 rounded-2xl shadow-lg max-h-64 overflow-y-auto z-50"},ct=["onClick"],vt=["src","alt"],pt={class:"flex-1 min-w-0"},ft={class:"font-medium text-gray-800 text-sm truncate"},gt={class:"text-xs text-gray-500 mt-0.5 truncate"},xt={key:0,class:"flex-1 overflow-y-auto"},mt={class:"px-4 py-4 space-y-6"},bt={key:0},yt={class:"flex gap-2 flex-wrap"},ht=["onClick"],wt={class:"space-y-3"},kt=["onClick"],_t=["src","alt"],$t={class:"flex-1"},Ct={class:"flex items-center gap-2 mb-1"},Mt={class:"font-bold text-gray-800"},St={key:0,class:"px-2 py-0.5 bg-teal-50 text-teal-500 text-xs rounded-full font-medium"},Dt={class:"flex items-center gap-2 text-xs text-gray-500"},Pt={key:1,class:"flex-1 relative"},At={key:0,class:"absolute top-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-b border-gray-200 p-4 z-30"},zt={class:"flex gap-2"},Lt={class:"flex-1 relative"},jt={key:0,class:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-2xl shadow-lg max-h-60 overflow-y-auto z-40"},Tt=["onClick"],It={class:"font-medium text-gray-800 text-sm"},Ft={class:"text-xs text-gray-500 mt-1"},Bt={key:2,class:"absolute bottom-0 left-0 right-0 bg-gradient-to-b from-transparent via-white/90 to-white backdrop-blur-sm border-t border-teal-200 z-20",style:{"padding-bottom":"max(16px, env(safe-area-inset-bottom))"}},Ut={class:"px-4 pt-4 pb-4"},Ht={class:"bg-gradient-to-br from-teal-50 to-emerald-50 rounded-2xl p-4 mb-4 border border-teal-100"},Nt={class:"flex gap-3"},Rt={class:"flex-1 min-w-0"},qt={class:"font-bold text-gray-900 text-base truncate"},Vt={class:"text-sm text-gray-600 mt-1 line-clamp-2"},Gt={key:3,class:"absolute bottom-4 right-4 bg-white/95 backdrop-blur-sm rounded-2xl shadow-lg p-3 z-20"},Et={class:"bg-white rounded-t-3xl shadow-2xl max-h-[70vh] overflow-y-auto"},Ot={class:"relative"},Kt={class:"relative h-48 overflow-hidden rounded-t-3xl"},Jt=["src","alt"],Yt={class:"absolute bottom-4 left-4 right-4"},Wt={class:"text-2xl font-bold text-white mb-1"},Zt={class:"flex items-center gap-2 text-white/90 text-sm"},Qt={class:"p-4 space-y-4"},Xt={class:"flex gap-2 flex-wrap"},es={class:"px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-xs font-medium"},ts={key:0,class:"px-3 py-1 bg-teal-50 text-teal-600 rounded-full text-xs font-medium"},ss={key:0,class:"space-y-2"},os={class:"flex gap-2 overflow-x-auto pb-2"},as=["src"],ls=Me({__name:"DestinationPicker",emits:["close","select"],setup(P,{emit:T}){const q=T,M=v(!1),$=v(""),C=v(!1),w=v(""),r=v(!1),F=v(!1),z=v([]);let f=null,N=null,V=null,B=null;const J=[];let S=null;const k=v(null),p=v(null),d=v([]),y=v([]),D=v([]),x=v([]),re=v("popularity"),h=v(null),be={easy:"å…¥é—¨",moderate:"ä¸­ç­‰",hard:"å›°éš¾"},ie=le(()=>{if(!$.value)return d.value;const t=$.value.toLowerCase();return D.value.filter(s=>{var a;return s.name.toLowerCase().includes(t)||s.area.toLowerCase().includes(t)||((a=s.tags)==null?void 0:a.toLowerCase().includes(t))})}),te=t=>t?t<1?`${(t*1e3).toFixed(0)}m`:`${t.toFixed(1)}km`:"";Se(async()=>{try{G(),se(),await Y(),await E()}catch(t){console.error("åˆå§‹åŒ–å¤±è´¥:",t)}});const G=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(async t=>{p.value={latitude:t.coords.latitude,longitude:t.coords.longitude},await pe()},t=>{console.error("è·å–ä½ç½®å¤±è´¥:",t),p.value={latitude:39.9042,longitude:116.4074}}):p.value={latitude:39.9042,longitude:116.4074}},Y=async()=>{try{r.value=!0;const t=await X.getPopularDestinations(10);if(t.code===200){const s=Array.from(new Map(t.data.map(a=>[a.id,a])).values());d.value=s.map(W)}}catch(t){console.error("åŠ è½½çƒ­é—¨ç›®çš„åœ°å¤±è´¥:",t)}finally{r.value=!1}},pe=async()=>{if(p.value)try{const t=await X.getNearbyDestinations(p.value.latitude,p.value.longitude,50,10);t.code===200&&(y.value=t.data.map(W))}catch(t){console.error("åŠ è½½é™„è¿‘ç›®çš„åœ°å¤±è´¥:",t)}},E=async()=>{var t,s;try{const a=await X.getDestinations({pageSize:100,sortBy:re.value,latitude:(t=p.value)==null?void 0:t.latitude,longitude:(s=p.value)==null?void 0:s.longitude});a.code===200&&(D.value=a.data.destinations.map(W))}catch(a){console.error("åŠ è½½ç›®çš„åœ°åˆ—è¡¨å¤±è´¥:",a)}},W=t=>({...t,image:t.cover_image||"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400",badge:t.popularity_score>1e3?"äººæ°”æ¦œ Top":"",distance:t.user_distance?te(t.user_distance):`${t.distance||0}km`,visitors:`${(t.visit_count/1e3).toFixed(1)}k+`,difficulty:be[t.difficulty]||t.difficulty}),se=async()=>{try{const t=await X.getSearchHistory(10);t.code===200&&(x.value=t.data)}catch{const s=localStorage.getItem("destination_search_history");s&&(x.value=JSON.parse(s))}};Te($,async t=>{t&&setTimeout(async()=>{$.value===t&&await E()},300)});const de=()=>{M.value=!0,setTimeout(()=>{ue()},100)},ue=()=>{if(!window.AMap){b.error("åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•");return}f=new window.AMap.Map("amap-container",{zoom:12,center:p.value?[p.value.longitude,p.value.latitude]:[116.4074,39.9042],mapStyle:"amap://styles/normal",features:["bg","road","building","point"],viewMode:"2D",showLabel:!0,labelzIndex:130,zoomEnable:!0,dragEnable:!0,doubleClickZoom:!0,scrollWheel:!0,touchZoom:!0,zooms:[3,18],pitch:0,rotation:0}),f.on("complete",()=>{console.log("åœ°å›¾åŠ è½½å®Œæˆ"),setTimeout(()=>{const t=document.querySelector(".amap-logo"),s=document.querySelector(".amap-copyright");t&&(t.style.display="none"),s&&(s.style.display="none")},100)}),window.AMap.plugin(["AMap.PlaceSearch","AMap.Geolocation","AMap.Geocoder"],()=>{N=new window.AMap.PlaceSearch({map:f,pageSize:10,pageIndex:1,city:"åŒ—äº¬",citylimit:!1}),V=new window.AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,zoomToAccuracy:!0,buttonPosition:"RB"}),B=new window.AMap.Geocoder({city:"å…¨å›½"})}),Z(),f.on("click",t=>{const{lng:s,lat:a}=t.lnglat;oe(s,a)})},Z=()=>{J.forEach(s=>s.setMap(null)),J.length=0,(D.value.length>0?D.value:d.value).forEach(s=>{if(!s.latitude||!s.longitude)return;let a="#10b981";s.difficulty==="ä¸­ç­‰"||s.difficulty==="moderate"?a="#f59e0b":(s.difficulty==="å›°éš¾"||s.difficulty==="hard")&&(a="#ef4444");const c=`
      <div style="
        background: ${a};
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        cursor: pointer;
        border: 3px solid white;
      ">
        ğŸ”ï¸
      </div>
      <div style="
        position: absolute;
        top: 45px;
        left: 50%;
        transform: translateX(-50%);
        background: white;
        padding: 4px 8px;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        white-space: nowrap;
        font-size: 12px;
        font-weight: 600;
        color: #1f2937;
      ">
        ${s.name}
      </div>
    `,g=new window.AMap.Marker({position:[s.longitude,s.latitude],content:c,offset:new window.AMap.Pixel(-20,-20),extData:s});g.on("click",()=>{ke(s),f.setCenter([s.longitude,s.latitude])}),g.setMap(f),J.push(g)})};let H=null;const ce=()=>{if(F.value=!0,!w.value||!N){z.value=[];return}clearTimeout(H),H=setTimeout(()=>{N.search(w.value,(t,s)=>{if(t==="complete"&&s.poiList){const a=s.poiList.pois;a&&a.length>0?z.value=a.slice(0,10).map(c=>({name:c.name,address:c.address||`${c.pname}${c.cityname}${c.adname}`,location:c.location})):z.value=[]}else z.value=[]})},300)},fe=t=>{t&&t.location&&(oe(t.location.lng,t.location.lat),F.value=!1,w.value="",z.value=[])},O=()=>{M.value=!1,k.value=null,f&&(f.destroy(),f=null),S&&(S.setMap(null),S=null)},oe=(t,s)=>{S&&S.setMap(null),S=new window.AMap.Marker({position:[t,s],content:`
      <div style="
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
        border-radius: 50% 50% 50% 0;
        transform: rotate(-45deg);
        border: 4px solid white;
        box-shadow: 0 4px 12px rgba(20, 184, 166, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
      ">
        <div style="
          transform: rotate(45deg);
          font-size: 24px;
        ">ğŸ“</div>
      </div>
    `,offset:new window.AMap.Pixel(-25,-50),zIndex:200}),S.setMap(f),f.setCenter([t,s]),B?B.getAddress([t,s],(a,c)=>{var g;if(a==="complete"&&c.info==="OK"){const _=c.regeocode.addressComponent,I=c.regeocode.formattedAddress,U=(g=c.regeocode.pois)==null?void 0:g[0];k.value={name:(U==null?void 0:U.name)||_.township||_.district||"é€‰ä¸­çš„ä½ç½®",address:I,lat:s,lng:t}}else k.value={name:"é€‰ä¸­çš„ä½ç½®",address:`${s.toFixed(6)}, ${t.toFixed(6)}`,lat:s,lng:t}}):k.value={name:"é€‰ä¸­çš„ä½ç½®",address:`${s.toFixed(6)}, ${t.toFixed(6)}`,lat:s,lng:t}},ye=()=>{k.value=null,S&&(S.setMap(null),S=null)},he=async()=>{if(!k.value)return;const t=k.value.name;try{await X.recordSearch(t)}catch{x.value.includes(t)||(x.value.unshift(t),x.value.length>10&&x.value.pop(),localStorage.setItem("destination_search_history",JSON.stringify(x.value)))}x.value.includes(t)||(x.value.unshift(t),x.value.length>10&&x.value.pop()),q("select",t),b.success(`å·²é€‰æ‹©: ${t}`)},we=()=>{!w.value||!N||N.search(w.value,(t,s)=>{if(t==="complete"&&s.poiList){const a=s.poiList.pois;if(a.length>0){const c=a[0],g=c.location.lng,_=c.location.lat;oe(g,_),f.setZoom(15),b.success(`æ‰¾åˆ° ${a.length} ä¸ªç»“æœ`)}else b.info("æœªæ‰¾åˆ°ç›¸å…³åœ°ç‚¹")}})},ke=async t=>{try{const s=await X.getDestinationById(t.id);s.code===200&&(h.value=W(s.data))}catch{h.value=W(t)}},ge=()=>{h.value=null},_e=t=>{ae(t),h.value=null},ae=async t=>{try{await X.recordSearch(t)}catch{x.value.includes(t)||(x.value.unshift(t),x.value.length>10&&x.value.pop(),localStorage.setItem("destination_search_history",JSON.stringify(x.value)))}x.value.includes(t)||(x.value.unshift(t),x.value.length>10&&x.value.pop()),q("select",t)},$e=()=>{x.value=[],localStorage.removeItem("destination_search_history"),b.success("å·²æ¸…é™¤æœç´¢è®°å½•")},i=()=>{if(!window.AMap){b.error("åœ°å›¾æœªåŠ è½½ï¼Œè¯·ç¨åé‡è¯•");return}const t=document.querySelector('[title="å®šä½åˆ°æˆ‘çš„ä½ç½®"]');if(t){t.disabled=!0;const s=t.innerHTML;t.innerHTML='<span class="animate-spin text-lg">â³</span>',setTimeout(()=>{t.disabled=!1,t.innerHTML=s},15e3)}M.value&&f&&V?V.getCurrentPosition((s,a)=>{const c=document.querySelector('[title="å®šä½åˆ°æˆ‘çš„ä½ç½®"]');if(c&&(c.disabled=!1,c.innerHTML='<span class="text-xl">ğŸ“</span>'),s==="complete"&&a.position){const{lng:g,lat:_}=a.position;f.setCenter([g,_]),f.setZoom(14),p.value={latitude:_,longitude:g},o(g,_),b.success("ğŸ“ å®šä½æˆåŠŸ"),pe()}else b.error("âŒ å®šä½å¤±è´¥: "+((a==null?void 0:a.message)||"æ— æ³•è·å–ä½ç½®ä¿¡æ¯")),console.error("Geolocation error:",s,a)},s=>{const a=document.querySelector('[title="å®šä½åˆ°æˆ‘çš„ä½ç½®"]');a&&(a.disabled=!1,a.innerHTML='<span class="text-xl">ğŸ“</span>'),b.error("âŒ å®šä½å‡ºé”™: "+(s==null?void 0:s.message)||"è¯·æ£€æŸ¥ä½ç½®æƒé™"),console.error("Geolocation error:",s)}):(G(),b.info("æ­£åœ¨å®šä½..."))},o=(t,s)=>{B&&B.getAddress([t,s],(a,c)=>{if(a==="complete"&&c.info==="OK")try{const g=c.regeocode.addressComponent||{},_=c.regeocode.formattedAddress||"ä½ç½®ä¿¡æ¯",I=c.regeocode.pois||[];let U="";I.length>0?U=I[0].name:U=g.township||g.district||g.city||"æœªçŸ¥åœ°ç‚¹",k.value={name:U||"é€‰ä¸­çš„ä½ç½®",address:_,lat:s,lng:t}}catch(g){console.error("Error updating location info:",g)}})};return Le(()=>{f&&(f.destroy(),f=null),H&&clearTimeout(H)}),(t,s)=>(l(),n("div",lt,[e("div",nt,[e("div",rt,[e("button",{onClick:s[0]||(s[0]=a=>t.$emit("close")),class:"absolute left-4 w-10 h-10 flex items-center justify-center"},[...s[8]||(s[8]=[e("span",{class:"text-2xl"},"â†",-1)])]),s[9]||(s[9]=e("h2",{class:"text-lg font-bold text-gray-800"},"é€‰æ‹©ç›®çš„åœ°",-1))]),M.value?m("",!0):(l(),n("div",it,[e("div",dt,[s[11]||(s[11]=e("span",{class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-teal-500 text-xl"},"ğŸ”",-1)),R(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>$.value=a),onFocus:s[2]||(s[2]=a=>C.value=!0),type:"text",placeholder:"æœç´¢å±±å³°ã€è·¯çº¿ã€æ™¯åŒº",class:"w-full pl-12 pr-10 py-3 bg-gray-100 rounded-full focus:outline-none focus:ring-2 focus:ring-teal-500"},null,544),[[ee,$.value]]),$.value?(l(),n("button",{key:0,onClick:s[3]||(s[3]=a=>{$.value="",C.value=!1}),class:"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"}," âœ• ")):m("",!0),C.value&&$.value&&ie.value.length>0?(l(),n("div",ut,[(l(!0),n(L,null,j(ie.value.slice(0,8),a=>(l(),n("div",{key:a.name,onClick:c=>ae(a.name),class:"px-4 py-3 border-b border-gray-100 last:border-b-0 hover:bg-teal-50 cursor-pointer transition flex items-center gap-3"},[e("img",{src:a.image,alt:a.name,class:"w-10 h-10 rounded-lg object-cover flex-shrink-0"},null,8,vt),e("div",pt,[e("div",ft,u(a.name),1),e("div",gt,"ğŸ“ "+u(a.area),1)]),s[10]||(s[10]=e("span",{class:"text-gray-400 text-xs flex-shrink-0"},"â†’",-1))],8,ct))),128))])):m("",!0)])]))]),M.value?(l(),n("div",Pt,[s[25]||(s[25]=e("div",{id:"amap-container",class:"absolute inset-0 bg-gray-100"},null,-1)),k.value?m("",!0):(l(),n("div",At,[e("div",zt,[e("button",{onClick:O,class:"w-12 h-12 bg-white border border-gray-200 rounded-full flex items-center justify-center hover:bg-gray-50 transition shadow-sm flex-shrink-0"},[...s[17]||(s[17]=[e("span",{class:"text-xl"},"â†",-1)])]),e("div",Lt,[s[18]||(s[18]=e("span",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-teal-500 text-lg"},"ğŸ”",-1)),R(e("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>w.value=a),onInput:ce,onKeyup:Ie(we,["enter"]),onFocus:s[5]||(s[5]=a=>F.value=!0),type:"text",placeholder:"æœç´¢åœ°ç‚¹æˆ–ç‚¹å‡»åœ°å›¾é€‰æ‹©ä½ç½®",class:"w-full pl-11 pr-4 py-3 bg-white border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 text-sm"},null,544),[[ee,w.value]]),F.value&&z.value.length>0?(l(),n("div",jt,[(l(!0),n(L,null,j(z.value,(a,c)=>(l(),n("div",{key:c,onClick:g=>fe(a),class:"px-4 py-3 border-b border-gray-100 last:border-b-0 hover:bg-teal-50 cursor-pointer transition"},[e("div",It,"ğŸ“ "+u(a.name),1),e("div",Ft,u(a.address),1)],8,Tt))),128))])):m("",!0),w.value?(l(),n("button",{key:1,onClick:s[6]||(s[6]=a=>{w.value="",F.value=!1,z.value=[]}),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"}," âœ• ")):m("",!0)]),e("button",{onClick:i,class:"w-12 h-12 bg-teal-500 text-white rounded-full flex items-center justify-center hover:bg-teal-600 transition shadow-lg flex-shrink-0",title:"å®šä½åˆ°æˆ‘çš„ä½ç½®"},[...s[19]||(s[19]=[e("span",{class:"text-xl"},"ğŸ“",-1)])])])])),k.value?(l(),n("button",{key:1,onClick:O,class:"absolute top-4 left-4 z-20 bg-white rounded-full px-4 py-3 shadow-lg flex items-center gap-2 hover:bg-gray-50 transition"},[...s[20]||(s[20]=[e("span",{class:"text-base"},"â†",-1),e("span",{class:"text-sm font-medium"},"åˆ—è¡¨",-1)])])):m("",!0),k.value?(l(),n("div",Bt,[e("div",Ut,[s[23]||(s[23]=e("div",{class:"flex items-center gap-2 mb-3 text-teal-600"},[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})]),e("span",{class:"text-xs font-semibold"},"å·²é€‰ä¸­ä½ç½®")],-1)),e("div",Ht,[e("div",Nt,[s[21]||(s[21]=e("div",{class:"w-12 h-12 bg-teal-500 rounded-full flex items-center justify-center text-white flex-shrink-0 text-xl"},"ğŸ“",-1)),e("div",Rt,[e("div",qt,u(k.value.name||"æœªå‘½ååœ°ç‚¹"),1),e("div",Vt,u(k.value.address||"ä½ç½®ä¿¡æ¯"),1)])])]),e("div",{class:"flex gap-3"},[e("button",{onClick:ye,class:"flex-1 py-3 bg-white text-teal-600 rounded-xl font-semibold hover:bg-gray-50 transition border border-gray-200 text-base"}," é‡æ–°é€‰æ‹© "),e("button",{onClick:he,class:"flex-1 py-3 bg-gradient-to-r from-teal-500 to-emerald-500 text-white rounded-xl font-bold hover:from-teal-600 hover:to-emerald-600 transition shadow-lg text-base flex items-center justify-center gap-2"},[...s[22]||(s[22]=[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1),Fe(" ç¡®è®¤æ­¤ä½ç½® ",-1)])])])])])):m("",!0),k.value?m("",!0):(l(),n("div",Gt,[...s[24]||(s[24]=[Pe('<div class="flex flex-col gap-2 text-xs" data-v-99febea8><div class="flex items-center gap-2" data-v-99febea8><div class="w-4 h-4 bg-green-500 rounded-full" data-v-99febea8></div><span class="text-gray-700 font-medium" data-v-99febea8>ç®€å•</span></div><div class="flex items-center gap-2" data-v-99febea8><div class="w-4 h-4 bg-yellow-500 rounded-full" data-v-99febea8></div><span class="text-gray-700 font-medium" data-v-99febea8>ä¸­ç­‰</span></div><div class="flex items-center gap-2" data-v-99febea8><div class="w-4 h-4 bg-red-500 rounded-full" data-v-99febea8></div><span class="text-gray-700 font-medium" data-v-99febea8>å›°éš¾</span></div></div>',1)])]))])):(l(),n("div",xt,[e("div",{class:"px-4 pt-4"},[e("div",{onClick:de,class:"bg-gradient-to-r from-teal-50 to-emerald-50 rounded-2xl p-4 flex items-center gap-4 cursor-pointer hover:shadow-md transition"},[...s[12]||(s[12]=[Pe('<div class="w-14 h-14 bg-teal-500 rounded-full flex items-center justify-center text-white text-2xl shadow-lg" data-v-99febea8> ğŸ—ºï¸ </div><div class="flex-1" data-v-99febea8><h3 class="text-base font-bold text-gray-800 mb-1" data-v-99febea8>åœ°å›¾æ‰¾å±±</h3><p class="text-sm text-gray-500" data-v-99febea8>åœ¨åœ°å›¾ä¸Šå‘ç°ä½ èº«è¾¹çš„å®è—å¾’æ­¥ç‚¹</p></div><span class="text-teal-500 text-2xl" data-v-99febea8>â†’</span>',3)])])]),e("div",mt,[x.value.length>0?(l(),n("div",bt,[e("div",{class:"flex items-center justify-between mb-3"},[s[13]||(s[13]=e("h3",{class:"text-base font-bold text-teal-600"},"æœ€è¿‘æœç´¢",-1)),e("button",{onClick:$e,class:"text-sm text-gray-500"},"æ¸…é™¤è®°å½•")]),e("div",yt,[(l(!0),n(L,null,j(x.value,a=>(l(),n("button",{key:a,onClick:c=>ae(a),class:"px-4 py-2 bg-white border border-gray-200 rounded-full text-sm text-gray-700 hover:border-teal-500 hover:bg-teal-50 hover:text-teal-600 transition flex items-center gap-2"},[s[14]||(s[14]=e("span",{class:"text-teal-500"},"ğŸ•",-1)),e("span",null,u(a),1)],8,ht))),128))])])):m("",!0),e("div",null,[s[16]||(s[16]=e("h3",{class:"text-base font-bold text-gray-800 mb-3"},"çƒ­é—¨æ¨è",-1)),e("div",wt,[(l(!0),n(L,null,j(ie.value,a=>(l(),n("div",{key:a.name,onClick:c=>ae(a.name),class:"bg-white border border-gray-200 rounded-2xl p-3 flex items-center gap-3 hover:border-teal-500 hover:shadow-md transition cursor-pointer"},[e("img",{src:a.image,alt:a.name,class:"w-16 h-16 rounded-xl object-cover"},null,8,_t),e("div",$t,[e("div",Ct,[e("h4",Mt,u(a.name),1),a.badge?(l(),n("span",St,u(a.badge),1)):m("",!0)]),e("div",Dt,[e("span",null,"ğŸ“ "+u(a.distance),1),s[15]||(s[15]=e("span",null,"â€¢",-1)),e("span",null,u(a.area),1)])])],8,kt))),128))])])])])),h.value?(l(),n("div",{key:2,class:"fixed inset-x-0 bottom-0 z-60 animate-slide-up",onClick:ve(ge,["self"])},[e("div",Et,[e("div",Ot,[e("button",{onClick:ge,class:"absolute top-4 right-4 w-8 h-8 bg-black/60 rounded-full flex items-center justify-center text-white z-10"}," âœ• "),e("div",Kt,[e("img",{src:h.value.image,alt:h.value.name,class:"w-full h-full object-cover"},null,8,Jt),s[27]||(s[27]=e("div",{class:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"},null,-1)),e("div",Yt,[e("h3",Wt,u(h.value.name),1),e("div",Zt,[e("span",null,u(h.value.area),1),s[26]||(s[26]=e("span",null,"â€¢",-1)),e("span",null,u(h.value.distance),1)])])]),e("div",Qt,[e("div",Xt,[e("span",{class:ne(["px-3 py-1 rounded-full text-xs font-medium",h.value.difficulty==="å…¥é—¨"?"bg-green-50 text-green-600":h.value.difficulty==="ä¸­ç­‰"?"bg-yellow-50 text-yellow-600":"bg-red-50 text-red-600"])},u(h.value.difficulty)+"éš¾åº¦ ",3),e("span",es,u(h.value.visitors)+" äººå»è¿‡ ",1),h.value.badge?(l(),n("span",ts,u(h.value.badge),1)):m("",!0)]),h.value.photos?(l(),n("div",ss,[s[28]||(s[28]=e("h4",{class:"text-sm font-bold text-gray-800"},"ğŸ“· å®æ™¯å›¾",-1)),e("div",os,[(l(!0),n(L,null,j(h.value.photos,(a,c)=>(l(),n("img",{key:c,src:a,class:"w-24 h-24 rounded-xl object-cover flex-shrink-0"},null,8,as))),128))])])):m("",!0),e("button",{onClick:s[7]||(s[7]=a=>_e(h.value.name)),class:"w-full py-4 bg-teal-500 text-white rounded-2xl font-bold text-base hover:bg-teal-600 transition"}," é€‰æ‹©æ­¤ç›®çš„åœ° ")])])])])):m("",!0)]))}}),ns=De(ls,[["__scopeId","data-v-99febea8"]]),rs={class:"create-activity-page min-h-screen bg-gray-50 pb-32"},is={class:"bg-white border-b border-gray-100 sticky top-0 z-10"},ds={class:"flex items-center justify-center relative px-4 py-4"},us={class:"text-lg font-bold text-gray-800"},cs={class:"px-4 py-6 space-y-4"},vs={class:"relative"},ps={class:"grid grid-cols-2 gap-3"},fs={class:"flex items-start justify-between"},gs={class:"flex-1"},xs={class:"font-semibold text-gray-800 mb-1"},ms={class:"text-sm text-gray-500"},bs={class:"bg-white border border-gray-200 rounded-2xl p-4"},ys={class:"flex gap-3"},hs=["onClick"],ws={class:"mt-6"},ks={class:"flex items-center justify-center gap-6"},_s={class:"text-3xl font-bold text-gray-800"},$s={class:"flex items-center justify-between mb-2"},Cs={class:"text-xs text-gray-500"},Ms={class:"flex gap-3 flex-wrap"},Ss=["src"],Ds={key:0,class:"absolute top-1 left-1 bg-teal-500 text-white text-xs px-2 py-0.5 rounded-full"},Ps=["onClick"],As={key:0,class:"w-24 h-24 border-2 border-dashed border-gray-300 rounded-2xl flex flex-col items-center justify-center cursor-pointer hover:border-teal-500 hover:bg-teal-50 transition"},zs={class:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 px-4 pt-4 pb-6 z-40 shadow-top",style:{"padding-bottom":"max(24px, env(safe-area-inset-bottom))"}},Ls={class:"flex gap-3"},js=["disabled"],Ts={class:"bg-white rounded-t-3xl w-full pb-safe animate-slide-up"},Is={class:"p-4 border-b border-gray-100"},Fs={class:"text-center text-gray-600 mb-2"},Bs={class:"p-4"},Us={class:"grid grid-cols-7 gap-2 mb-2"},Hs={class:"grid grid-cols-7 gap-2"},Ns=["onClick","disabled"],Rs={class:"px-4 pb-4"},qs={class:"bg-white rounded-t-3xl w-full pb-safe animate-slide-up"},Vs={class:"p-6 flex justify-center items-center gap-4"},Gs=["value"],Es=["value"],Os={class:"px-4 pb-4"},Ks={key:5,class:"fixed inset-0 bg-white z-[60]"},Js={class:"h-full flex flex-col"},Ys={class:"bg-white border-b border-gray-100 p-4"},Ws={class:"flex items-center gap-3"},Zs={class:"flex-1 relative"},Qs={class:"flex-1 overflow-y-auto p-4"},Xs={key:0,class:"text-center py-12 text-gray-400"},eo={key:1,class:"space-y-2"},to=["onClick"],so={class:"flex items-start gap-3"},oo={class:"flex-1 min-w-0"},ao={class:"font-semibold text-gray-800 mb-1"},lo={class:"text-sm text-gray-500 truncate"},no={class:"flex items-center gap-2 text-xs text-gray-400 mt-1"},ro={key:0},io={key:6,class:"fixed inset-0 bg-white z-[60]"},uo={class:"h-full flex flex-col"},co={class:"bg-white border-b border-gray-100"},vo={class:"flex items-center justify-center relative px-4 py-4"},po={class:"flex-1 overflow-y-auto p-4"},fo={key:0,class:"text-center py-12 text-gray-400"},go={key:1,class:"space-y-3"},xo=["onClick"],mo={class:"flex items-start justify-between gap-3"},bo={class:"flex items-start gap-3 flex-1 min-w-0"},yo={class:"flex-1 min-w-0"},ho={class:"font-semibold text-gray-800 mb-1"},wo={class:"text-sm text-gray-500"},ko={class:"flex items-center gap-2 text-xs text-gray-400 mt-2"},_o={key:0},$o=["onClick"],Co={class:"bg-white rounded-3xl w-full max-w-sm p-6 animate-scale-in"},Mo={class:"flex gap-3"},So=Me({__name:"CreateActivity",setup(P){const T=Be(),q=Ue(),M=He(),$=le(()=>M.loading),C=v(!1),w=v(null),r=v({title:"",destination:"",date:"",time:"",meetingPoint:"å¥¥æ—åŒ¹å…‹æ£®æ—å…¬å›­å—é—¨",meetingAddress:"åŒ—äº¬å¸‚æœé˜³åŒºç§‘èŸè·¯33å·",difficulty:"easy",maxParticipants:4,description:""}),F=async i=>{try{const o=await M.getActivityById(i);if(o){if(r.value.title=o.title,r.value.destination=o.location,r.value.difficulty=o.difficulty||"easy",r.value.maxParticipants=o.max_participants||4,r.value.description=o.description||"",o.start_time){const t=new Date(o.start_time),s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0"),g=String(t.getHours()).padStart(2,"0"),_=String(t.getMinutes()).padStart(2,"0");r.value.date=`${s}-${a}-${c}`,r.value.time=`${g}:${_}`,d.value=t,G.value=g,Y.value=_}o.photos&&o.photos.length>0?f.value=o.photos:o.cover_image_url&&(f.value=[o.cover_image_url]),b.success("æ´»åŠ¨æ•°æ®åŠ è½½æˆåŠŸ")}}catch(o){console.error("åŠ è½½æ´»åŠ¨æ•°æ®å¤±è´¥:",o),b.error("åŠ è½½æ´»åŠ¨æ•°æ®å¤±è´¥"),T.back()}};Se(async()=>{const i=q.query.id;i&&i!=="NaN"&&(C.value=!0,w.value=i,await F(i))});const z=[{value:"easy",label:"ç®€å•"},{value:"moderate",label:"ä¸­ç­‰"},{value:"hard",label:"å›°éš¾"}],f=v([]),N=i=>{const o=i.target,t=o.files;if(t){const s=6-f.value.length;Array.from(t).slice(0,s).forEach(c=>{if(!c.type.startsWith("image/")){b.warning("è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶");return}if(c.size>5*1024*1024){b.warning("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 5MB");return}const g=new FileReader;g.onload=_=>{var I;(I=_.target)!=null&&I.result&&f.value.length<6&&f.value.push(_.target.result)},g.readAsDataURL(c)}),o.value=""}},V=i=>{f.value.splice(i,1)},B=()=>{r.value.maxParticipants>1&&r.value.maxParticipants--},J=()=>{r.value.maxParticipants<99&&r.value.maxParticipants++},S=v(!1),k=v(new Date().getFullYear()),p=v(new Date().getMonth()+1),d=v(null),y=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],D=le(()=>{if(!d.value)return"";const i=String(d.value.getMonth()+1).padStart(2,"0"),o=String(d.value.getDate()).padStart(2,"0");return`${i}-${o}`}),x=le(()=>{const i=k.value,o=p.value,t=new Date(i,o-1,1),a=new Date(i,o,0).getDate(),c=t.getDay(),g=[],_=new Date;_.setHours(0,0,0,0);const I=new Date(i,o-1,0).getDate();for(let A=c-1;A>=0;A--)g.push({day:I-A,isCurrentMonth:!1,disabled:!0,isPast:!0,key:`prev-${I-A}`});for(let A=1;A<=a;A++){const Q=new Date(i,o-1,A);Q.setHours(0,0,0,0);const Ce=Q<_,xe=d.value&&Q.getTime()===d.value.getTime();g.push({day:A,date:Q,isCurrentMonth:!0,disabled:!1,isPast:Ce,isSelected:xe,key:`current-${A}`})}const U=42-g.length;for(let A=1;A<=U;A++)g.push({day:A,isCurrentMonth:!1,disabled:!0,isPast:!1,key:`next-${A}`});return g}),re=()=>{p.value===1?(p.value=12,k.value--):p.value--},h=()=>{p.value===12?(p.value=1,k.value++):p.value++},be=i=>{!i.disabled&&!i.isPast&&i.isCurrentMonth&&(d.value=i.date)},ie=()=>{if(d.value){const i=d.value.getFullYear(),o=String(d.value.getMonth()+1).padStart(2,"0"),t=String(d.value.getDate()).padStart(2,"0");r.value.date=`${i}-${o}-${t}`,S.value=!1}},te=v(!1),G=v("08"),Y=v("00"),pe=()=>{r.value.time=`${G.value}:${Y.value}`,te.value=!1},E=v(!1),W=i=>{r.value.destination=i,E.value=!1},se=v(!1),de=v(!1),ue=v(!1),Z=v(""),H=v(!1),ce=v({name:"æ¾æ—å¡åœè½¦åœºå…¥å£",address:"åŒ—äº¬å¸‚æ˜Œå¹³åŒºåä¸‰é™µé•‡åä¸‰é™µæ°´åº“è·¯ 168 å·é™¢"}),fe=v([{id:"1",name:"å¥¥æ—åŒ¹å…‹æ£®æ—å…¬å›­å—é—¨",address:"åŒ—äº¬å¸‚æœé˜³åŒºç§‘èŸè·¯33å·",distance:"è·ç¦» 2.5 km",category:"å…¬å›­"},{id:"2",name:"æ¾æ—å¡åœè½¦åœºå…¥å£",address:"åŒ—äº¬å¸‚æ˜Œå¹³åŒºåä¸‰é™µé•‡åä¸‰é™µæ°´åº“è·¯ 168 å·é™¢",distance:"è·ç¦» 5.3 km",category:"åœè½¦åœº"},{id:"3",name:"é¦™å±±å…¬å›­ä¸œé—¨",address:"åŒ—äº¬å¸‚æµ·æ·€åŒºä¹°å–è¡—40å·",distance:"è·ç¦» 8.7 km",category:"å…¬å›­"},{id:"4",name:"é¢å’Œå›­åŒ—å®«é—¨",address:"åŒ—äº¬å¸‚æµ·æ·€åŒºæ–°å»ºå®«é—¨è·¯19å·",distance:"è·ç¦» 6.2 km",category:"æ™¯åŒº"},{id:"5",name:"å…«è¾¾å²­é•¿åŸæ¸¸å®¢ä¸­å¿ƒ",address:"åŒ—äº¬å¸‚å»¶åº†åŒºG6äº¬è—é«˜é€Ÿ58å·å‡ºå£",distance:"è·ç¦» 45.8 km",category:"æ™¯åŒº"},{id:"6",name:"ç™¾æœ›å±±æ£®æ—å…¬å›­",address:"åŒ—äº¬å¸‚æµ·æ·€åŒºé»‘å±±æ‰ˆåŒ—å£19å·",distance:"è·ç¦» 7.1 km",category:"å…¬å›­"}]),O=v([{id:"1",name:"å¥¥æ—åŒ¹å…‹æ£®æ—å…¬å›­å—é—¨",address:"åŒ—äº¬å¸‚æœé˜³åŒºç§‘èŸè·¯33å·",distance:"è·ç¦» 2.5 km",category:"å…¬å›­"},{id:"3",name:"é¦™å±±å…¬å›­ä¸œé—¨",address:"åŒ—äº¬å¸‚æµ·æ·€åŒºä¹°å–è¡—40å·",distance:"è·ç¦» 8.7 km",category:"å…¬å›­"}]),oe=le(()=>{if(!Z.value.trim())return fe.value;const i=Z.value.toLowerCase();return fe.value.filter(o=>{var t;return o.name.toLowerCase().includes(i)||o.address.toLowerCase().includes(i)||((t=o.category)==null?void 0:t.toLowerCase().includes(i))})});le(()=>O.value.some(i=>i.name===ce.value.name));const ye=i=>{ce.value={name:i.name,address:i.address},de.value=!1},he=i=>{ce.value={name:i.name,address:i.address},ue.value=!1},we=i=>{const o=O.value.findIndex(t=>t.id===i);o>=0&&O.value.splice(o,1)},ke=i=>{r.value.meetingPoint=i.name,r.value.meetingAddress=i.address,se.value=!1},ge=()=>{H.value=!0},_e=()=>{H.value=!1,T.back()},ae=async()=>{if(!r.value.title){b.warning("è¯·è¾“å…¥æ´»åŠ¨åç§°");return}if(!r.value.destination){b.warning("è¯·é€‰æ‹©ç›®çš„åœ°ç‚¹");return}if(!r.value.date){b.warning("è¯·é€‰æ‹©æ´»åŠ¨æ—¥æœŸ");return}if(!r.value.time){b.warning("è¯·é€‰æ‹©æ´»åŠ¨æ—¶é—´");return}if(!r.value.difficulty){b.warning("è¯·é€‰æ‹©éš¾åº¦ç­‰çº§");return}try{const i=`${r.value.date}T${r.value.time}:00`,o=new Date(i),t=new Date(o.getTime()+4*60*60*1e3),s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0"),g=String(t.getHours()).padStart(2,"0"),_=String(t.getMinutes()).padStart(2,"0"),I=String(t.getSeconds()).padStart(2,"0"),U=`${s}-${a}-${c}T${g}:${_}:${I}`,Q=f.value.length>0?f.value:["https://images.unsplash.com/photo-1551632811-561732d1e306?w=800&h=600&fit=crop"],Ce=Q[0],xe={title:r.value.title,description:r.value.description||`${r.value.title} - æ¬¢è¿åŠ å…¥!`,location:r.value.destination,start_time:i,end_time:U,difficulty:r.value.difficulty,max_participants:r.value.maxParticipants,cover_image_url:Ce,photos:Q};let me=!1;C.value&&w.value?(me=!!await M.updateActivity(w.value,xe),me?(b.success("æ´»åŠ¨ä¿®æ”¹æˆåŠŸï¼"),T.push("/my-hiking?tab=created")):b.error("ä¿®æ”¹å¤±è´¥: "+M.error)):(me=!!await M.createActivity(xe),me?(b.success("æ´»åŠ¨å‘å¸ƒæˆåŠŸï¼"),T.push("/my-hiking?tab=created")):b.error("å‘å¸ƒå¤±è´¥: "+M.error))}catch(i){console.error("æäº¤æ´»åŠ¨å¤±è´¥:",i),b.error(C.value?"ä¿®æ”¹æ´»åŠ¨å¤±è´¥":"å‘å¸ƒæ´»åŠ¨å¤±è´¥")}},$e=()=>{T.back()};return(i,o)=>(l(),n("div",rs,[e("div",is,[e("div",ds,[e("button",{onClick:$e,class:"absolute left-4 w-10 h-10 flex items-center justify-center"},[...o[22]||(o[22]=[e("span",{class:"text-2xl"},"â†",-1)])]),e("h1",us,u(C.value?"ç¼–è¾‘æ´»åŠ¨":"åˆ›å»ºå¾’æ­¥æ´»åŠ¨"),1)])]),e("div",cs,[e("div",null,[o[23]||(o[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"æ´»åŠ¨åç§°",-1)),R(e("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>r.value.title=t),type:"text",placeholder:"è¯·è¾“å…¥æ´»åŠ¨åç§°",class:"w-full px-4 py-3 bg-white border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"},null,512),[[ee,r.value.title]])]),e("div",null,[o[24]||(o[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ç›®çš„åœ°ç‚¹",-1)),e("div",vs,[R(e("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>r.value.destination=t),type:"text",placeholder:"æœç´¢æˆ–è¾“å…¥åœ°ç‚¹",readonly:"",onClick:o[2]||(o[2]=t=>E.value=!0),class:"w-full px-4 py-3 pr-12 bg-white border border-gray-200 rounded-2xl focus:outline-none cursor-pointer"},null,512),[[ee,r.value.destination]]),e("button",{onClick:o[3]||(o[3]=t=>E.value=!0),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-teal-500 text-xl"}," ğŸ” ")])]),e("div",ps,[e("div",null,[o[26]||(o[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"æ—¥æœŸ",-1)),e("div",{onClick:o[4]||(o[4]=t=>S.value=!0),class:"flex items-center justify-between px-4 py-3 bg-white border border-gray-200 rounded-2xl cursor-pointer"},[e("span",{class:ne(r.value.date?"text-gray-800":"text-gray-400")},u(r.value.date||"é€‰æ‹©æ—¥æœŸ"),3),o[25]||(o[25]=e("span",{class:"text-teal-500 text-xl"},"ğŸ“…",-1))])]),e("div",null,[o[28]||(o[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"æ—¶é—´",-1)),e("div",{onClick:o[5]||(o[5]=t=>te.value=!0),class:"flex items-center justify-between px-4 py-3 bg-white border border-gray-200 rounded-2xl cursor-pointer"},[e("span",{class:ne(r.value.time?"text-gray-800":"text-gray-400")},u(r.value.time||"é€‰æ‹©æ—¶é—´"),3),o[27]||(o[27]=e("span",{class:"text-teal-500 text-xl"},"ğŸ•",-1))])])]),e("div",null,[o[30]||(o[30]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"é›†åˆåœ°ç‚¹",-1)),e("div",{onClick:o[6]||(o[6]=t=>se.value=!0),class:"bg-white border border-gray-200 rounded-2xl p-4 cursor-pointer hover:border-teal-500 transition"},[e("div",fs,[e("div",gs,[e("h3",xs,u(r.value.meetingPoint||"ç‚¹å‡»é€‰æ‹©é›†åˆåœ°ç‚¹"),1),e("p",ms,u(r.value.meetingAddress||"é€‰æ‹©æ´»åŠ¨é›†åˆçš„å…·ä½“ä½ç½®"),1)]),o[29]||(o[29]=e("button",{class:"ml-3 text-teal-500 text-2xl"},"ğŸ“",-1))])])]),e("div",bs,[o[32]||(o[32]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"éš¾åº¦ç­‰çº§",-1)),e("div",ys,[(l(),n(L,null,j(z,t=>e("button",{key:t.value,onClick:s=>r.value.difficulty=t.value,type:"button",class:ne(["flex-1 py-3 rounded-full font-medium text-base transition",r.value.difficulty===t.value?"bg-teal-500 text-white":"bg-gray-100 text-gray-700"])},u(t.label),11,hs)),64))]),e("div",ws,[o[31]||(o[31]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"æ‰€éœ€äººæ•°",-1)),e("div",ks,[e("button",{onClick:B,type:"button",class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center text-2xl text-gray-600 hover:bg-gray-200 transition"}," âˆ’ "),e("span",_s,u(r.value.maxParticipants)+"äºº",1),e("button",{onClick:J,type:"button",class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center text-2xl text-teal-500 hover:bg-teal-50 transition"}," + ")])])]),e("div",null,[o[33]||(o[33]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"æ´»åŠ¨æè¿°",-1)),R(e("textarea",{"onUpdate:modelValue":o[7]||(o[7]=t=>r.value.description=t),placeholder:"ç®€å•ä»‹ç»ä¸€ä¸‹æ´»åŠ¨å§...",class:"w-full px-4 py-3 bg-white border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent min-h-[120px] resize-none"},null,512),[[ee,r.value.description]])]),e("div",null,[e("div",$s,[o[34]||(o[34]=e("label",{class:"block text-sm font-medium text-gray-700"},"ä¸Šä¼ ç…§ç‰‡",-1)),e("span",Cs,u(f.value.length)+"/6å¼  Â· ç¬¬ä¸€å¼ ä¸ºå°é¢",1)]),e("div",Ms,[(l(!0),n(L,null,j(f.value,(t,s)=>(l(),n("div",{key:s,class:"relative w-24 h-24 rounded-2xl overflow-hidden group"},[e("img",{src:t,alt:"Uploaded",class:"w-full h-full object-cover"},null,8,Ss),s===0?(l(),n("div",Ds," å°é¢ ")):m("",!0),e("button",{onClick:a=>V(s),class:"absolute top-1 right-1 w-6 h-6 bg-black/70 rounded-full flex items-center justify-center text-white text-sm opacity-0 group-hover:opacity-100 transition-opacity"}," âœ• ",8,Ps)]))),128)),f.value.length<6?(l(),n("label",As,[e("input",{type:"file",accept:"image/*",multiple:"",onChange:N,class:"hidden"},null,32),o[35]||(o[35]=e("span",{class:"text-3xl text-teal-500"},"ğŸ–¼ï¸",-1)),o[36]||(o[36]=e("span",{class:"text-xs text-gray-500 mt-1"},"æ·»åŠ ç…§ç‰‡",-1))])):m("",!0)]),o[37]||(o[37]=e("p",{class:"text-xs text-gray-400 mt-2"}," æ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œæœ€å¤š 6 å¼ ï¼Œç¬¬ä¸€å¼ å°†ä½œä¸ºæ´»åŠ¨å°é¢ ",-1))])]),e("div",zs,[e("div",Ls,[C.value?(l(),n("button",{key:0,onClick:ge,class:"flex-1 py-4 bg-gray-200 text-gray-700 rounded-2xl font-bold text-lg hover:bg-gray-300 transition shadow-lg"}," å–æ¶ˆ ")):m("",!0),e("button",{onClick:ae,disabled:$.value,class:ne(["py-4 rounded-2xl font-bold text-lg transition shadow-lg",C.value?"flex-1 bg-teal-500 text-white hover:bg-teal-600":"w-full bg-teal-500 text-white hover:bg-teal-600","disabled:opacity-50 disabled:cursor-not-allowed"])},u($.value?"å¤„ç†ä¸­...":C.value?"ä¿å­˜ä¿®æ”¹":"å‘å¸ƒæ´»åŠ¨"),11,js)])]),S.value?(l(),n("div",{key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-end",onClick:o[8]||(o[8]=ve(t=>S.value=!1,["self"]))},[e("div",Ts,[e("div",Is,[e("div",{class:"flex items-center justify-between mb-4"},[e("button",{onClick:re,class:"text-teal-500 text-xl"},"â†"),o[38]||(o[38]=e("h3",{class:"text-lg font-bold text-gray-800"},"é€‰æ‹©æ´»åŠ¨æ—¥æœŸ",-1)),e("button",{onClick:h,class:"text-teal-500 text-xl"},"â†’")]),e("div",Fs,u(k.value)+"å¹´"+u(p.value)+"æœˆ",1)]),e("div",Bs,[e("div",Us,[(l(),n(L,null,j(y,t=>e("div",{key:t,class:"text-center text-sm text-gray-500 py-2"},u(t),1)),64))]),e("div",Hs,[(l(!0),n(L,null,j(x.value,t=>(l(),n("button",{key:t.key,onClick:s=>be(t),disabled:t.disabled||t.isPast,class:ne(["aspect-square flex items-center justify-center rounded-full text-base transition",t.isCurrentMonth?"text-gray-800":"text-gray-300",t.isSelected?"bg-teal-500 text-white font-bold":"",!t.isSelected&&t.isCurrentMonth&&!t.disabled&&!t.isPast?"hover:bg-gray-100":"",t.disabled||t.isPast?"opacity-30 cursor-not-allowed":""])},u(t.day),11,Ns))),128))])]),e("div",Rs,[e("button",{onClick:ie,class:"w-full py-4 bg-teal-500 text-white rounded-2xl font-bold text-base hover:bg-teal-600 transition"}," ç¡®å®šæ—¥æœŸ"+u(D.value?` (${D.value})`:""),1)])])])):m("",!0),te.value?(l(),n("div",{key:1,class:"fixed inset-0 bg-black/50 z-50 flex items-end",onClick:o[11]||(o[11]=ve(t=>te.value=!1,["self"]))},[e("div",qs,[o[40]||(o[40]=e("div",{class:"p-4 border-b border-gray-100"},[e("h3",{class:"text-lg font-bold text-gray-800 text-center"},"é€‰æ‹©æ—¶é—´")],-1)),e("div",Vs,[R(e("select",{"onUpdate:modelValue":o[9]||(o[9]=t=>G.value=t),class:"text-3xl font-bold text-gray-800 bg-transparent border-b-2 border-teal-500 px-4 py-2 focus:outline-none"},[(l(),n(L,null,j(24,t=>e("option",{key:t,value:String(t-1).padStart(2,"0")},u(String(t-1).padStart(2,"0")),9,Gs)),64))],512),[[ze,G.value]]),o[39]||(o[39]=e("span",{class:"text-3xl font-bold text-gray-800"},":",-1)),R(e("select",{"onUpdate:modelValue":o[10]||(o[10]=t=>Y.value=t),class:"text-3xl font-bold text-gray-800 bg-transparent border-b-2 border-teal-500 px-4 py-2 focus:outline-none"},[(l(),n(L,null,j(60,t=>e("option",{key:t,value:String(t-1).padStart(2,"0")},u(String(t-1).padStart(2,"0")),9,Es)),64))],512),[[ze,Y.value]])]),e("div",Os,[e("button",{onClick:pe,class:"w-full py-4 bg-teal-500 text-white rounded-2xl font-bold text-base hover:bg-teal-600 transition"}," ç¡®å®šæ—¶é—´ ("+u(G.value)+":"+u(Y.value)+") ",1)])])])):m("",!0),E.value?(l(),Ae(ns,{key:2,onClose:o[12]||(o[12]=t=>E.value=!1),onSelect:W})):m("",!0),se.value?(l(),Ae(at,{key:3,onClose:o[13]||(o[13]=t=>se.value=!1),onConfirm:ke})):m("",!0),m("",!0),de.value?(l(),n("div",Ks,[e("div",Js,[e("div",Ys,[e("div",Ws,[e("button",{onClick:o[17]||(o[17]=t=>de.value=!1),class:"text-2xl text-gray-700"}," â† "),e("div",Zs,[o[45]||(o[45]=e("span",{class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-xl"},"ğŸ”",-1)),R(e("input",{"onUpdate:modelValue":o[18]||(o[18]=t=>Z.value=t),type:"text",placeholder:"æœç´¢é›†åˆåœ°ç‚¹",class:"w-full pl-12 pr-4 py-3 bg-gray-100 rounded-2xl focus:outline-none focus:ring-2 focus:ring-teal-500",autofocus:""},null,512),[[ee,Z.value]])])])]),e("div",Qs,[oe.value.length===0?(l(),n("div",Xs,[o[46]||(o[46]=e("div",{class:"text-5xl mb-3"},"ğŸ”",-1)),e("p",null,u(Z.value?"æœªæ‰¾åˆ°ç›¸å…³åœ°ç‚¹":"è¾“å…¥å…³é”®è¯æœç´¢åœ°ç‚¹"),1)])):(l(),n("div",eo,[(l(!0),n(L,null,j(oe.value,t=>(l(),n("div",{key:t.id,onClick:s=>ye(t),class:"bg-white border border-gray-200 rounded-2xl p-4 hover:border-teal-500 hover:shadow-md transition cursor-pointer"},[e("div",so,[o[47]||(o[47]=e("div",{class:"w-10 h-10 bg-teal-50 rounded-full flex items-center justify-center flex-shrink-0"},[e("span",{class:"text-xl"},"ğŸ“")],-1)),e("div",oo,[e("h4",ao,u(t.name),1),e("p",lo,u(t.address),1),e("div",no,[e("span",null,u(t.distance),1),t.category?(l(),n("span",ro,"â€¢ "+u(t.category),1)):m("",!0)])])])],8,to))),128))]))])])])):m("",!0),ue.value?(l(),n("div",io,[e("div",uo,[e("div",co,[e("div",vo,[e("button",{onClick:o[19]||(o[19]=t=>ue.value=!1),class:"absolute left-4 text-2xl text-gray-700"}," â† "),o[48]||(o[48]=e("h2",{class:"text-lg font-bold text-gray-800"},"æˆ‘çš„æ”¶è—",-1))])]),e("div",po,[O.value.length===0?(l(),n("div",fo,[...o[49]||(o[49]=[e("div",{class:"text-5xl mb-3"},"ğŸ“‘",-1),e("p",{class:"text-base"},"æš‚æ— æ”¶è—åœ°ç‚¹",-1),e("p",{class:"text-sm mt-2"},"ç‚¹å‡»åœ°ç‚¹å³ä¸Šè§’æ˜Ÿæ ‡å³å¯æ”¶è—",-1)])])):(l(),n("div",go,[(l(!0),n(L,null,j(O.value,t=>(l(),n("div",{key:t.id,onClick:s=>he(t),class:"bg-white border border-gray-200 rounded-2xl p-4 hover:border-teal-500 hover:shadow-md transition cursor-pointer"},[e("div",mo,[e("div",bo,[o[50]||(o[50]=e("div",{class:"w-12 h-12 bg-teal-50 rounded-xl flex items-center justify-center flex-shrink-0"},[e("span",{class:"text-2xl"},"ğŸ“")],-1)),e("div",yo,[e("h4",ho,u(t.name),1),e("p",wo,u(t.address),1),e("div",ko,[e("span",null,u(t.distance),1),t.category?(l(),n("span",_o,"â€¢ "+u(t.category),1)):m("",!0)])])]),e("button",{onClick:ve(s=>we(t.id),["stop"]),class:"text-2xl flex-shrink-0"}," â­ ",8,$o)])],8,xo))),128))]))])])])):m("",!0),H.value?(l(),n("div",{key:7,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center px-4",onClick:o[21]||(o[21]=ve(t=>H.value=!1,["self"]))},[e("div",Co,[o[51]||(o[51]=e("div",{class:"text-center mb-6"},[e("div",{class:"text-5xl mb-4"},"âš ï¸"),e("h3",{class:"text-xl font-bold text-gray-800 mb-2"},"ç¡®å®šæ”¾å¼ƒä¿®æ”¹å—ï¼Ÿ"),e("p",{class:"text-gray-500 text-sm"},"å·²ä¿®æ”¹çš„å†…å®¹å°†ä¸ä¼šä¿å­˜")],-1)),e("div",Mo,[e("button",{onClick:o[20]||(o[20]=t=>H.value=!1),class:"flex-1 py-3 bg-gray-100 text-gray-700 rounded-2xl font-medium hover:bg-gray-200 transition"}," ç»§ç»­ç¼–è¾‘ "),e("button",{onClick:_e,class:"flex-1 py-3 bg-red-500 text-white rounded-2xl font-medium hover:bg-red-600 transition"}," æ”¾å¼ƒä¿®æ”¹ ")])])])):m("",!0)]))}}),jo=De(So,[["__scopeId","data-v-4d682e12"]]);export{jo as default};
