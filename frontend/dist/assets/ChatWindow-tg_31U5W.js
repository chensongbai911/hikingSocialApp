import{k as Le,J as Ee,E as Pe,r as u,d as Oe,l as He,w as Ve,W as Ne,v as o,q as i,z as a,x as m,y,A as C,L as te,M as se,N as T,O as he,P as xe,X as Fe,n as we,G as R}from"./vue-B6Xl8iL6.js";import{u as Ke,s as N,c as me,t as p,d as qe,b as Ge,e as ye,f as Je,r as Xe,h as Ye,j as Qe}from"./index-C2PV4XN9.js";import{u as Ze}from"./upload-XmIN79Aa.js";import"./state-BRWMog1q.js";const et={class:"fixed inset-0 bg-white flex flex-col z-50",style:{"max-height":"100dvh"}},tt={class:"bg-white border-b border-gray-100 p-4 flex items-center space-x-3 flex-shrink-0"},st={class:"relative flex-shrink-0"},nt=["src","alt"],at={class:"flex-1 min-w-0"},lt={class:"font-semibold text-gray-900 truncate text-base"},rt={class:"text-xs truncate flex items-center space-x-1"},ot={key:0,class:"text-red-500"},it={key:0,class:"flex items-center space-x-2"},ct={key:0,class:"bg-red-50 text-red-600 text-sm px-4 py-2"},ut={key:1,class:"bg-red-50 text-red-600 text-sm px-4 py-2"},dt={key:2,class:"bg-amber-50 text-amber-700 text-sm px-4 py-2"},vt={key:0,class:"text-center text-gray-400 py-8"},gt={key:1,class:"flex flex-col items-center justify-center py-16"},ft=["src","alt"],pt={class:"break-words"},ht={key:1,class:"rounded-2xl overflow-hidden"},xt=["src","onClick"],wt={key:2,class:"text-xs text-gray-400 px-3 py-2"},mt={class:"mt-1 text-xs text-gray-400"},yt={class:"whitespace-nowrap"},kt=["onClick"],bt=["onClick"],_t={key:2,class:"text-xs text-gray-500 mt-2"},Ct={class:"bg-white border-t border-gray-100 p-4 flex-shrink-0 pb-6"},It=["onClick"],Ut={class:"flex items-end space-x-1.5"},Mt={class:"flex-1 bg-gray-50 rounded-2xl flex items-center min-w-0"},St=["disabled"],Tt={key:1,class:"mt-3 text-center"},Rt={class:"inline-flex items-center space-x-2 bg-red-50 text-red-600 px-4 py-2 rounded-full"},Wt={class:"text-sm font-medium"},jt={key:3,class:"fixed inset-0 bg-black/40 flex items-center justify-center z-50"},$t={class:"bg-white rounded-2xl w-80 p-5"},Dt={class:"space-y-2 mb-3"},Bt=["onClick"],zt=["src"],Ht=Le({__name:"ChatWindow",setup(At){const ne=Ee(),W=Pe();W==null||W.state;const g=Ke(),w=u(W.params.id),j=u(""),F=u(),ae=u(),B=u(),I=u(!1),b=u(!1),$=u(0),z=u(null),U=u(!1),A=u(void 0),_=u(!1),K=u(new Set),Y=u(!1),q=u(null),L=u(""),E=u(""),ke=["åžƒåœ¾å¹¿å‘Š","éªšæ‰°è¾±éª‚","æ¶‰é»„ä½Žä¿—","è¿æ³•è¿è§„","å…¶ä»–"];let D=null,M=null,le=0;const f=u([]),P=u(1),O=u(1),G=u(!1),J=u(!0),H=u(""),re=e=>f.value.some(t=>t.id===e),v=u({id:"",name:"å¯¹æ–¹",avatar:"",isOnline:!0}),be=["ðŸ˜Š","ðŸ˜‚","â¤ï¸","ðŸ‘","ðŸ™","ðŸ˜","ðŸ˜­","ðŸ¤”","ðŸ‘","ðŸŽ‰","ðŸ”¥","ðŸ’ª","ðŸŒŸ","âœ¨","ðŸŒˆ","ðŸŒ¸","ðŸŒº","ðŸŒ»","ðŸŒž","ðŸŒ™","â­","ðŸ’«","âœ…","âŒ"],oe=async()=>{var t;const e=W.params.id;if(w.value=e,!w.value){p.error("æ— æ•ˆçš„å¯¹è¯"),ne.push({name:"Messages"});return}try{J.value=!0,H.value="",console.log("[ChatWindow] å¼€å§‹åŠ è½½å¯¹è¯ï¼ŒID:",e);let s={};try{s=await qe(e),console.log("[ChatWindow] èŽ·å–å¯¹è¯ä¿¡æ¯æˆåŠŸ:",s)}catch(n){console.error("[ChatWindow] èŽ·å–å¯¹è¯ä¿¡æ¯å¤±è´¥ï¼Œç»§ç»­åŠ è½½æ¶ˆæ¯:",n)}const{otherUserId:c,isLimited:l,remainingMessages:h,isBlacklisted:S}=s||{},x=c||e;v.value.id=x;try{console.log("[ChatWindow] èŽ·å–ç”¨æˆ·èµ„æ–™:",x);const n=await Ge.getUserProfile(x);console.log("[ChatWindow] ç”¨æˆ·èµ„æ–™å“åº”:",n);const r=((t=n==null?void 0:n.data)==null?void 0:t.data)||(n==null?void 0:n.data)||n;r?(v.value.name=r.nickname||r.name||r.email||`ç”¨æˆ·${x.slice(-4)}`,v.value.avatar=r.avatar_url||r.avatar||v.value.avatar,v.value.isOnline=r.is_online??r.isOnline??!1,console.log("[ChatWindow] ç”¨æˆ·ä¿¡æ¯å·²è®¾ç½®:",v.value)):(console.warn("[ChatWindow] ç”¨æˆ·æ•°æ®ä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤å€¼"),v.value.name=`ç”¨æˆ·${x.slice(-4)}`)}catch(n){console.error("[ChatWindow] èŽ·å–å¯¹æ–¹èµ„æ–™å¤±è´¥:",n),v.value.name=`ç”¨æˆ·${x.slice(-4)}`,(n==null?void 0:n.code)!==4001&&(n==null?void 0:n.code)!==404&&console.warn("[ChatWindow] å¿½ç•¥ç”¨æˆ·èµ„æ–™èŽ·å–é”™è¯¯ï¼Œç»§ç»­åŠ è½½æ¶ˆæ¯")}U.value=!!l,A.value=h,_.value=!!S,console.log("[ChatWindow] å¯¹è¯é™åˆ¶ä¿¡æ¯:",{isLimited:U.value,remainingMessages:A.value,isBlacklisted:_.value}),console.log("[ChatWindow] å¼€å§‹åŠ è½½æ¶ˆæ¯åˆ—è¡¨ï¼ŒconversationId:",e);const d=await ye(e);console.log("[ChatWindow] getMessages è¿”å›žå€¼:",d);const k=(d==null?void 0:d.messages)||d||[];console.log("[ChatWindow] èŽ·å–æ¶ˆæ¯åˆ—è¡¨:",{total:d==null?void 0:d.total,count:k.length,rawMessages:k}),d!=null&&d.pagination?O.value=d.pagination.totalPages||1:d!=null&&d.totalPages&&(O.value=d.totalPages),P.value=1,f.value=k.map(n=>({id:String(n.id),content:n.content||n.imageUrl||n.image_url||n.fileUrl||n.file_url||"",contentType:n.contentType||n.content_type||"text",senderId:String(n.senderId||n.sender_id),createdAt:n.createdAt||n.created_at,isRecalled:n.isRecalled||n.is_recalled,imageUrl:n.imageUrl||n.image_url,fileUrl:n.fileUrl||n.file_url,sender:n.sender?{id:String(n.sender.id),nickname:n.sender.nickname||n.sender.name||"ç”¨æˆ·",avatarUrl:n.sender.avatarUrl||n.sender.avatar_url}:void 0})),console.log("[ChatWindow] è½¬æ¢åŽçš„æ¶ˆæ¯æ•°ç»„ï¼Œé•¿åº¦:",f.value.length,"å†…å®¹:",f.value),await me(w.value),X()}catch(s){console.error("[ChatWindow] åŠ è½½å¯¹è¯å¼‚å¸¸:",s),H.value=(s==null?void 0:s.message)||"åŠ è½½å¤±è´¥",p.error(H.value)}finally{J.value=!1,console.log("[ChatWindow] åŠ è½½å®Œæˆï¼Œmessages.length:",f.value.length,"loading:",J.value)}},_e=()=>{ne.push({name:"Messages"})},Q=async(e="text",t)=>{var c,l,h,S,x,d,k;if(_.value){p.warning("ä½ å·²è¢«å¯¹æ–¹æ‹‰é»‘ï¼Œæ— æ³•å‘é€");return}if(U.value){p.warning("éœ€è¦äº’ç›¸å…³æ³¨æ‰èƒ½èŠå¤©");return}const s=j.value.trim();if(!(e==="text"&&!s))try{const n=await Je(w.value,e==="text"?s:"",e,t==null?void 0:t.imageUrl,void 0);console.log("[ChatWindow] å‘é€æ¶ˆæ¯å“åº”:",n);const r=(n==null?void 0:n.message)||((c=n==null?void 0:n.data)==null?void 0:c.message)||n;if(console.log("[ChatWindow] æå–çš„æ¶ˆæ¯å¯¹è±¡:",r),r&&!re(String(r.id))){const pe={id:String(r.id),content:r.content||r.imageUrl||r.image_url||r.fileUrl||r.file_url||"",contentType:r.contentType||r.content_type||e,senderId:String(r.senderId||r.sender_id||g.userId),createdAt:r.createdAt||r.created_at||new Date().toISOString(),isRecalled:r.isRecalled||r.is_recalled||!1,imageUrl:r.imageUrl||r.image_url,fileUrl:r.fileUrl||r.file_url,sender:r.sender?{id:String(r.sender.id),nickname:r.sender.nickname||((l=g.currentUser)==null?void 0:l.nickname)||"æˆ‘",avatarUrl:r.sender.avatarUrl||r.sender.avatar_url||((h=g.currentUser)==null?void 0:h.avatarUrl)}:{id:String(g.userId),nickname:((S=g.currentUser)==null?void 0:S.nickname)||"æˆ‘",avatarUrl:(x=g.currentUser)==null?void 0:x.avatarUrl}};console.log("[ChatWindow] æ·»åŠ æ–°æ¶ˆæ¯åˆ°åˆ—è¡¨:",pe),f.value.push(pe)}(n==null?void 0:n.remainingMessages)!==void 0&&(A.value=n.remainingMessages,console.log("[ChatWindow] æ›´æ–°å‰©ä½™æ¶ˆæ¯æ•°:",A.value)),e==="text"&&(j.value=""),ce(),await we(),X()}catch(n){console.error("[ChatWindow] å‘é€æ¶ˆæ¯å¤±è´¥:",n);const r=(n==null?void 0:n.message)||((k=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:k.message);if(r&&r.includes("äº’ç›¸å…³æ³¨")){U.value=!0,A.value=0,p.warning("éœ€è¦äº’ç›¸å…³æ³¨æ‰èƒ½èŠå¤©");return}p.error(r||"å‘é€å¤±è´¥")}},ie=Oe(()=>{const e=!j.value.trim();return _.value||U.value||e}),Ce=async e=>{var c;const t=e.target.files;if(!t||!t.length)return;const s=t[0];if(s.size>10*1024*1024){p.warning("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡10MB"),e.target.value="";return}try{const l=await Ze.uploadImage(s),h=((c=l==null?void 0:l.data)==null?void 0:c.url)||(l==null?void 0:l.url);if(!h)throw new Error("ä¸Šä¼ å¤±è´¥");await Q("image",{imageUrl:h})}catch(l){p.error((l==null?void 0:l.message)||"ä¸Šä¼ å¤±è´¥")}finally{e.target.value=""}},Ie=async e=>{try{await Qe(e),f.value=f.value.map(t=>t.id===e?{...t,isRecalled:!0}:t),p.success("å·²æ’¤å›ž")}catch(t){p.error((t==null?void 0:t.message)||"æ’¤å›žå¤±è´¥")}},Ue=e=>{q.value=e,L.value="",E.value="",Y.value=!0},Z=()=>{Y.value=!1,q.value=null},Me=async()=>{if(!q.value){Z();return}if(!L.value){p.warning("è¯·é€‰æ‹©ä¸¾æŠ¥åŽŸå› ");return}try{const e=E.value?{note:E.value}:void 0;await Xe(q.value,L.value,e),p.success("å·²ä¸¾æŠ¥"),Z()}catch(e){p.error((e==null?void 0:e.message)||"ä¸¾æŠ¥å¤±è´¥")}},Se=async()=>{try{await Ye(w.value),f.value=[],p.success("å·²æ¸…ç©ºå¹¶å½’æ¡£")}catch(e){p.error((e==null?void 0:e.message)||"æ¸…ç©ºå¤±è´¥")}},X=()=>{we(()=>{F.value&&(F.value.scrollTop=F.value.scrollHeight)})},Te=async()=>{if(!(G.value||P.value>=O.value))try{G.value=!0;const e=P.value+1,t=await ye(w.value,e);t!=null&&t.pagination&&(O.value=t.pagination.totalPages||1);const c=((t==null?void 0:t.messages)||(t==null?void 0:t.items)||[]).map(l=>({id:String(l.id),content:l.content||l.imageUrl||l.image_url||l.fileUrl||l.file_url||"",contentType:l.contentType||l.content_type||"text",senderId:String(l.senderId||l.sender_id),createdAt:l.createdAt||l.created_at,isRecalled:l.isRecalled||l.is_recalled,imageUrl:l.imageUrl||l.image_url,fileUrl:l.fileUrl||l.file_url,sender:l.sender?{id:String(l.sender.id),nickname:l.sender.nickname||l.sender.name||"ç”¨æˆ·",avatarUrl:l.sender.avatarUrl||l.sender.avatar_url}:void 0}));f.value.unshift(...c),P.value=e}catch(e){console.error("[ChatWindow] åŠ è½½æ›´å¤šæ¶ˆæ¯å¤±è´¥:",e)}finally{G.value=!1}},Re=e=>{const t=e.target;t&&t.scrollTop<100&&!G.value&&P.value<O.value&&Te()},We=e=>{if(!(e instanceof Date)||isNaN(e.getTime()))return"";const s=new Date().getTime()-e.getTime();if(s<6e4)return"åˆšåˆš";if(s<36e5)return`${Math.floor(s/6e4)}åˆ†é’Ÿå‰`;if(s<864e5)return`${Math.floor(s/36e5)}å°æ—¶å‰`;const c=l=>l.toString().padStart(2,"0");return`${e.getFullYear()}-${c(e.getMonth()+1)}-${c(e.getDate())} ${c(e.getHours())}:${c(e.getMinutes())}:${c(e.getSeconds())}`},ce=()=>{if(B.value){B.value.style.height="auto";const e=Math.min(B.value.scrollHeight,128);B.value.style.height=`${e}px`}},je=e=>{const t=new Date(e).getTime();return Date.now()-t<12e4},ue=e=>{N.sendTyping(w.value,e)},$e=()=>{ue(!0),D&&window.clearTimeout(D),D=window.setTimeout(()=>ue(!1),1500)},de=()=>{ce(),$e()},ve=()=>{I.value&&(I.value=!1)},De=()=>{var e;return(e=ae.value)==null?void 0:e.click()},Be=e=>{j.value+=e,de()},ze=()=>{I.value=!I.value},ge=()=>{b.value||(b.value=!0,le=Date.now(),$.value=0,M=window.setInterval(()=>{$.value=Math.floor((Date.now()-le)/1e3),$.value>=60&&ee()},200))},ee=()=>{b.value&&(b.value=!1,M&&(clearInterval(M),M=null),$.value=0)},fe=()=>{b.value&&(b.value=!1,M&&(clearInterval(M),M=null),$.value=0)},Ae=e=>{z.value=e},V=[];return He(async()=>{await oe(),X(),document.addEventListener("click",ve),V.push(N.onMessageReceived(e=>{var s,c,l,h,S,x,d,k,n,r;if(String(e.conversationId||e.conversation_id)!==w.value)return;const t=String(e.id||((s=e.message)==null?void 0:s.id)||Date.now());re(t)||(f.value.push({id:t,content:((c=e.message)==null?void 0:c.content)||e.content||((l=e.message)==null?void 0:l.image_url)||e.imageUrl||"",contentType:((h=e.message)==null?void 0:h.content_type)||e.contentType||"text",senderId:String(((S=e.message)==null?void 0:S.sender_id)||e.senderId||e.sender_id),createdAt:((x=e.message)==null?void 0:x.created_at)||e.createdAt||new Date().toISOString(),isRecalled:(d=e.message)==null?void 0:d.is_recalled,imageUrl:((k=e.message)==null?void 0:k.image_url)||e.imageUrl,fileUrl:((n=e.message)==null?void 0:n.file_url)||e.fileUrl}),String(((r=e.message)==null?void 0:r.sender_id)||e.senderId||e.sender_id)!==String(g.userId)&&me(w.value).catch(()=>{}),X())})),V.push(N.onRecall(e=>{String(e.conversationId)===w.value&&(f.value=f.value.map(t=>t.id===String(e.messageId)?{...t,isRecalled:!0}:t))})),V.push(N.onBlacklist(e=>{(String(e.targetUserId)===g.userId||String(e.userId)===v.value.id)&&(_.value=e.action==="added")})),V.push(N.onUserTyping(e=>{if(String(e.conversationId)!==w.value)return;const t=new Set(K.value);e.isTyping&&e.fromUserId!==g.userId?t.add(String(e.fromUserId)):t.delete(String(e.fromUserId)),K.value=t,D&&window.clearTimeout(D),D=window.setTimeout(()=>{K.value=new Set},3e3)}))}),Ve(()=>W.params.id,async(e,t)=>{e&&e!==t&&await oe()}),Ne(()=>{document.removeEventListener("click",ve),V.forEach(e=>e())}),(e,t)=>(i(),o("div",et,[a("div",tt,[a("button",{onClick:_e,class:"p-2 -ml-2"},[...t[8]||(t[8]=[a("svg",{class:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),a("div",st,[a("img",{src:v.value.avatar||"https://placehold.co/48x48",alt:v.value.name,class:"w-10 h-10 rounded-full object-cover"},null,8,nt),_.value?m("",!0):(i(),o("div",{key:0,class:y(["absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white",v.value.isOnline?"bg-green-500":"bg-gray-400"])},null,2))]),a("div",at,[a("h2",lt,C(v.value.name||"å¯¹æ–¹"),1),a("p",rt,[_.value?(i(),o("span",ot,"å·²è¢«å¯¹æ–¹æ‹‰é»‘")):(i(),o("span",{key:1,class:y(v.value.isOnline?"text-green-600":"text-gray-500")},C(v.value.isOnline?"åœ¨çº¿":"ç¦»çº¿"),3))])]),U.value?(i(),o("div",it,[...t[9]||(t[9]=[a("span",{class:"text-xs text-amber-700 bg-amber-100 px-2 py-1 rounded-full"},"éœ€äº’ç›¸å…³æ³¨",-1)])])):m("",!0),a("button",{onClick:Se,class:"p-2 text-gray-500 hover:text-red-500",title:"æ¸…ç©ºå¯¹è¯"},[...t[10]||(t[10]=[a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),H.value?(i(),o("div",ct,C(H.value),1)):_.value?(i(),o("div",ut," å¯¹æ–¹å·²å°†ä½ æ‹‰é»‘ï¼Œæ— æ³•å‘é€æ¶ˆæ¯ ")):U.value?(i(),o("div",dt," éœ€è¦äº’ç›¸å…³æ³¨æ‰èƒ½èŠå¤© ")):m("",!0),a("div",{ref_key:"messagesContainer",ref:F,class:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",onScroll:Re},[J.value?(i(),o("div",vt,"åŠ è½½ä¸­...")):f.value.length?m("",!0):(i(),o("div",gt,[...t[11]||(t[11]=[a("svg",{class:"w-20 h-20 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),a("p",{class:"text-gray-400 text-center mb-2"},"æš‚æ—¶æ²¡æœ‰æ¶ˆæ¯",-1),a("p",{class:"text-gray-400 text-sm text-center"},"å¼€å§‹ä½ ä»¬çš„ç¬¬ä¸€æ¬¡å¯¹è¯å§ï½ž",-1)])])),(i(!0),o(te,null,se(f.value,s=>{var c,l;return i(),o("div",{key:s.id,class:y(["flex",s.senderId===R(g).userId?"justify-end":"justify-start"])},[a("div",{class:y(["flex",s.senderId===R(g).userId?"flex-row-reverse":"flex-row","items-end space-x-2 w-[100%]"])},[s.senderId!==R(g).userId?(i(),o("img",{key:0,src:((c=s.sender)==null?void 0:c.avatarUrl)||v.value.avatar||"https://placehold.co/48x48",alt:((l=s.sender)==null?void 0:l.nickname)||v.value.name,class:"w-8 h-8 rounded-full object-cover flex-shrink-0"},null,8,ft)):m("",!0),a("div",{class:y(["max-w-[70%]",s.senderId===R(g).userId?"mr-2":"ml-2"])},[s.contentType==="text"&&!s.isRecalled?(i(),o("div",{key:0,class:y(["px-4 py-2 rounded-2xl break-words whitespace-pre-wrap",s.senderId===R(g).userId?"bg-teal-500 text-white rounded-br-sm":"bg-white text-gray-800 rounded-bl-sm"])},[a("p",pt,C(s.content),1)],2)):s.contentType==="image"&&!s.isRecalled?(i(),o("div",ht,[a("img",{src:s.imageUrl||s.content,alt:"å›¾ç‰‡",class:"max-w-full h-auto cursor-pointer",onClick:h=>Ae(s.imageUrl||s.content)},null,8,xt)])):(i(),o("div",wt,"æ¶ˆæ¯å·²æ’¤å›ž")),a("div",mt,[a("div",{class:y(["flex items-center gap-3 whitespace-nowrap",s.senderId===R(g).userId?"justify-end":"justify-start"])},[a("span",yt,C(We(new Date(s.createdAt))),1),s.senderId===R(g).userId&&!s.isRecalled&&je(s.createdAt)?(i(),o("button",{key:0,class:"hover:text-red-500",onClick:h=>Ie(s.id)},"æ’¤å›ž",8,kt)):s.isRecalled?m("",!0):(i(),o("button",{key:1,class:"hover:text-amber-600",onClick:h=>Ue(s.id)},"ä¸¾æŠ¥",8,bt))],2)])],2)],2)],2)}),128)),K.value.size>0?(i(),o("div",_t,"å¯¹æ–¹æ­£åœ¨è¾“å…¥...")):m("",!0)],544),a("div",Ct,[I.value?(i(),o("div",{key:0,class:"mb-3 p-3 bg-gray-50 rounded-2xl grid grid-cols-8 gap-2 max-h-48 overflow-y-auto",onClick:t[0]||(t[0]=T(()=>{},["stop"]))},[(i(),o(te,null,se(be,s=>a("button",{key:s,onClick:c=>Be(s),class:"text-2xl hover:scale-125 transition-transform"},C(s),9,It)),64))])):m("",!0),a("div",Ut,[a("button",{onMousedown:ge,onMouseup:ee,onMouseleave:fe,onTouchstart:T(ge,["prevent"]),onTouchend:T(ee,["prevent"]),onTouchcancel:T(fe,["prevent"]),class:y(["p-2.5 rounded-full transition-all duration-200 flex-shrink-0",b.value?"bg-red-500 text-white scale-110":"bg-gray-100 text-gray-600 hover:bg-gray-200"])},[...t[12]||(t[12]=[a("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[a("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),a("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})],-1)])],34),a("div",Mt,[he(a("textarea",{ref_key:"textInput",ref:B,"onUpdate:modelValue":t[1]||(t[1]=s=>j.value=s),placeholder:"è¾“å…¥æ¶ˆæ¯...",rows:"1",class:"flex-1 bg-transparent px-3 py-2.5 focus:outline-none resize-none max-h-32 overflow-y-auto text-sm",onInput:de,onKeydown:t[2]||(t[2]=Fe(T(s=>Q(),["exact","prevent"]),["enter"])),onFocus:t[3]||(t[3]=s=>I.value=!1)},null,544),[[xe,j.value]]),a("button",{onClick:T(ze,["stop"]),class:y(["p-2 transition-colors flex-shrink-0",I.value?"text-teal-500":"text-gray-600"])},[...t[13]||(t[13]=[a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],2),a("button",{onClick:De,class:"p-2 text-gray-600 hover:text-teal-500 transition-colors flex-shrink-0"},[...t[14]||(t[14]=[a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])]),a("input",{ref_key:"imageInput",ref:ae,type:"file",accept:"image/*",class:"hidden",onChange:Ce},null,544)]),a("button",{onClick:t[4]||(t[4]=s=>Q()),disabled:ie.value,class:y(["p-2.5 rounded-full transition-all duration-200 flex-shrink-0",ie.value?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-teal-500 text-white hover:bg-teal-600"])},[...t[15]||(t[15]=[a("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],10,St)]),b.value?(i(),o("div",Tt,[a("div",Rt,[t[16]||(t[16]=a("div",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1)),a("span",Wt,"æ­£åœ¨å½•éŸ³ "+C($.value)+'"',1)]),t[17]||(t[17]=a("p",{class:"text-xs text-gray-500 mt-2"},"æ¾å¼€å‘é€ï¼Œæ»‘å‡ºå–æ¶ˆ",-1))])):m("",!0)]),Y.value?(i(),o("div",jt,[a("div",$t,[t[18]||(t[18]=a("h3",{class:"text-lg font-semibold text-gray-800 mb-3"},"ä¸¾æŠ¥æ¶ˆæ¯",-1)),a("div",Dt,[(i(),o(te,null,se(ke,s=>a("button",{key:s,onClick:c=>L.value=s,class:y(["w-full text-left px-3 py-2 rounded-lg text-sm",L.value===s?"bg-teal-50 text-teal-700 border border-teal-200":"bg-gray-50 text-gray-700"])},C(s),11,Bt)),64))]),he(a("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>E.value=s),placeholder:"è¡¥å……è¯´æ˜Žï¼ˆå¯é€‰ï¼‰",rows:"3",class:"w-full px-3 py-2 text-sm bg-gray-50 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"},null,512),[[xe,E.value]]),a("div",{class:"flex justify-end gap-2 mt-4"},[a("button",{class:"px-3 py-2 text-sm text-gray-600",onClick:Z},"å–æ¶ˆ"),a("button",{class:"px-3 py-2 text-sm bg-teal-500 text-white rounded-lg",onClick:Me},"æäº¤")])])])):m("",!0),z.value?(i(),o("div",{key:4,onClick:t[7]||(t[7]=s=>z.value=null),class:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4"},[a("img",{src:z.value,alt:"é¢„è§ˆ",class:"max-w-full max-h-full object-contain"},null,8,zt),a("button",{onClick:t[6]||(t[6]=T(s=>z.value=null,["stop"])),class:"absolute top-4 right-4 p-2 bg-white/20 rounded-full text-white"},[...t[19]||(t[19]=[a("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):m("",!0)]))}});export{Ht as default};
