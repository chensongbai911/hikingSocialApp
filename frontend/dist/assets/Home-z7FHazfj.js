import{k as G,J as K,r as d,d as W,l as O,F as Q,v as o,q as r,x as A,z as t,A as l,G as c,s as M,u as D,K as z,L as _,M as y,y as X}from"./vue-B6Xl8iL6.js";import{u as Y,a as w,t as H,_ as Z}from"./index-CIMimzwA.js";import{u as I}from"./activity-tIQDsGgk.js";import"./state-BRWMog1q.js";import"./activity-D84O0kU3.js";const ee={class:"home-page min-h-screen bg-gray-50 pb-20"},te={key:0,class:"fixed top-4 left-4 right-4 bg-green-500 text-white px-4 py-3 rounded-lg shadow-lg z-50"},se={class:"bg-gradient-to-r from-teal-500 to-green-500 text-white"},ne={class:"px-4 py-6"},oe={class:"flex items-center justify-between"},re={class:"text-2xl font-bold mb-1"},le={class:"px-4 -mt-4 mb-4"},ae={class:"bg-white rounded-2xl shadow-md p-4 grid grid-cols-4 gap-2"},ie={key:0,class:"absolute top-2 right-2 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-xs text-white"},de={class:"px-4 mb-6"},ue={class:"flex items-center justify-between mb-3"},ce={class:"flex gap-2"},xe={key:0,class:"space-y-3"},ge={key:1,class:"space-y-3"},pe=["onClick"],fe={class:"relative h-48 overflow-hidden"},me=["src","alt"],ve={class:"absolute top-3 left-3"},he={class:"p-4"},be={class:"font-bold text-base text-gray-800 mb-2"},_e={class:"space-y-1 text-sm text-gray-600 mb-3"},ye={class:"flex items-center gap-2"},we={class:"flex items-center gap-2"},ke={class:"flex items-center justify-between pt-3 border-t border-gray-100"},je={class:"flex items-center gap-2 flex-1"},Ce=["src","alt"],Se={class:"text-xs text-gray-600"},$e={class:"flex items-center gap-3"},Ae={class:"flex items-center gap-1 text-xs text-gray-500"},Me=["onClick","disabled"],De={key:1,class:"px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-full"},ze={key:2,class:"px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-full"},He={key:2,class:"bg-white rounded-2xl p-8 text-center"},Ue={class:"px-4 mb-6"},Ne={class:"flex items-center justify-between mb-3"},Re={class:"flex gap-3 overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide"},Te=["onClick"],Ve=["src","alt"],Be={class:"text-sm font-medium text-gray-800 text-center truncate"},Je={class:"text-xs text-gray-500 text-center"},Le=G({__name:"Home",setup(Pe){const u=K(),U=Y(),N=I(),v=d(!1),x=d([]),h=d([]),p=d(0),k=d(1),f=d(null),m=d(""),j=s=>typeof s=="string"&&s.startsWith("preset-activity-"),C=s=>!(!s||!s.id||j(s.id)||s.is_joined||s.status&&!["approved","recruiting"].includes(s.status)||s.max_participants&&s.participant_count>=s.max_participants),R=s=>!s||!s.id?"ä¸å¯åŠ å…¥":j(s.id)?"é¢„è®¾æ´»åŠ¨":s.is_joined?"å·²åŠ å…¥":s.status==="pending"?"å¾…å‘å¸ƒ":s.status==="cancelled"?"å·²å–æ¶ˆ":s.status==="completed"?"å·²ç»“æŸ":s.max_participants&&s.participant_count>=s.max_participants?"å·²æ»¡":"ä¸å¯åŠ å…¥",T=W(()=>{const s=new Date().getHours();return s<12?"æ—©ä¸Šå¥½":s<18?"ä¸‹åˆå¥½":"æ™šä¸Šå¥½"}),S=async()=>{var s;try{v.value=!0;const e=await w.get("/discovery/activities",{params:{page:k.value,page_size:5}});console.log("æŽ¨èæ´»åŠ¨å“åº”:",e),(s=e==null?void 0:e.data)!=null&&s.items?(x.value=e.data.items,console.log("åŠ è½½æˆåŠŸ,æ•°é‡:",x.value.length)):console.warn("å“åº”æ•°æ®ç»“æž„ä¸åˆé¢„æœŸ:",e)}catch(e){console.error("åŠ è½½æŽ¨èæ´»åŠ¨å¤±è´¥:",e)}finally{v.value=!1}},$=async()=>{var s;try{const e=await w.get("/discovery/users",{params:{page:1,page_size:10}});console.log("æŽ¨èç”¨æˆ·å“åº”:",e),(s=e==null?void 0:e.data)!=null&&s.items?(h.value=e.data.items,console.log("åŠ è½½æˆåŠŸ,æ•°é‡:",h.value.length)):console.warn("å“åº”æ•°æ®ç»“æž„ä¸åˆé¢„æœŸ:",e)}catch(e){console.error("åŠ è½½æŽ¨èç”¨æˆ·å¤±è´¥:",e)}},V=async()=>{try{const s=await w.get("/messages/unread-count");s.data&&(p.value=s.data.count||0)}catch(s){console.error("åŠ è½½æœªè¯»æ¶ˆæ¯æ•°å¤±è´¥:",s)}},B=async()=>{k.value=Math.floor(Math.random()*5)+1,S(),$()},J=s=>{u.push(`/activity/${s}`)},b=d(new Set),L=async(s,e)=>{if(s.stopPropagation(),b.value.has(e)){H.warning("æ­£åœ¨å¤„ç†ä¸­...");return}b.value.add(e);try{f.value=e,await N.joinActivity(e);const a=x.value.find(i=>i.id===e);a&&(a.participant_count=(a.participant_count||0)+1,a.is_joined=!0),m.value="æˆåŠŸåŠ å…¥æ´»åŠ¨ï¼",setTimeout(()=>{m.value=""},3e3),console.log("æˆåŠŸåŠ å…¥æ´»åŠ¨:",e)}catch(a){console.error("åŠ å…¥æ´»åŠ¨å¼‚å¸¸:",a);const i=a.message||"åŠ å…¥æ´»åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥";H.error(i)}finally{f.value=null,b.value.delete(e)}},P=s=>{if(!s)return"";try{const e=new Date(s),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),g=String(e.getMinutes()).padStart(2,"0");return`${a}-${i} ${n}:${g}`}catch{return s}},F=s=>{switch(s){case"easy":return"bg-green-500";case"moderate":return"bg-yellow-500";case"hard":return"bg-red-500";default:return"bg-gray-500"}},q=s=>{switch(s){case"easy":return"ç®€å•";case"moderate":return"ä¸­ç­‰";case"hard":return"å›°éš¾";default:return"æœªçŸ¥"}},E=s=>{switch(s){case"beginner":return"æ–°æ‰‹";case"intermediate":return"ä¸­çº§";case"advanced":return"èµ„æ·±";default:return"æ–°æ‰‹"}};return O(()=>{S(),$(),V()}),(s,e)=>{var i;const a=Q("router-link");return r(),o("div",ee,[m.value?(r(),o("div",te,l(m.value),1)):A("",!0),t("div",se,[t("div",ne,[t("div",oe,[t("div",null,[t("h1",re,l(T.value)+", "+l(((i=c(U).currentUser)==null?void 0:i.nickname)||"å¾’æ­¥è€…")+"! ",1),e[5]||(e[5]=t("p",{class:"text-teal-100 text-sm"},"å‘çŽ°ç²¾å½©çš„å¾’æ­¥æ´»åŠ¨",-1))]),e[6]||(e[6]=t("div",{class:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center"},[t("span",{class:"text-3xl"},"ðŸ”ï¸")],-1))])])]),t("div",le,[t("div",ae,[t("button",{onClick:e[0]||(e[0]=n=>c(u).push("/create-activity")),class:"flex flex-col items-center py-3 hover:bg-gray-50 rounded-xl transition"},[...e[7]||(e[7]=[t("div",{class:"w-12 h-12 bg-teal-100 rounded-full flex items-center justify-center mb-2"},[t("span",{class:"text-2xl"},"âž•")],-1),t("span",{class:"text-xs text-gray-700"},"å‘èµ·æ´»åŠ¨",-1)])]),t("button",{onClick:e[1]||(e[1]=n=>c(u).push("/my-hiking")),class:"flex flex-col items-center py-3 hover:bg-gray-50 rounded-xl transition"},[...e[8]||(e[8]=[t("div",{class:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-2"},[t("span",{class:"text-2xl"},"ðŸ“‹")],-1),t("span",{class:"text-xs text-gray-700"},"æˆ‘çš„æ´»åŠ¨",-1)])]),t("button",{onClick:e[2]||(e[2]=n=>c(u).push("/discover")),class:"flex flex-col items-center py-3 hover:bg-gray-50 rounded-xl transition"},[...e[9]||(e[9]=[t("div",{class:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mb-2"},[t("span",{class:"text-2xl"},"ðŸ”")],-1),t("span",{class:"text-xs text-gray-700"},"å‘çŽ°ç”¨æˆ·",-1)])]),t("button",{onClick:e[3]||(e[3]=n=>c(u).push("/messages")),class:"flex flex-col items-center py-3 hover:bg-gray-50 rounded-xl transition relative"},[e[10]||(e[10]=t("div",{class:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mb-2"},[t("span",{class:"text-2xl"},"ðŸ’¬")],-1)),e[11]||(e[11]=t("span",{class:"text-xs text-gray-700"},"æ¶ˆæ¯",-1)),p.value>0?(r(),o("div",ie,l(p.value>9?"9+":p.value),1)):A("",!0)])])]),t("div",de,[t("div",ue,[e[13]||(e[13]=t("h2",{class:"text-lg font-bold text-gray-800"},"ðŸ”¥ æŽ¨èæ´»åŠ¨",-1)),t("div",ce,[t("button",{onClick:B,class:"text-sm text-teal-600 hover:text-teal-700"}," æ¢ä¸€æ‰¹ "),M(a,{to:"/activities",class:"text-sm text-teal-600 hover:text-teal-700"},{default:D(()=>[...e[12]||(e[12]=[z(" æŸ¥çœ‹æ›´å¤š ",-1)])]),_:1})])]),v.value?(r(),o("div",xe,[(r(),o(_,null,y(3,n=>t("div",{key:n,class:"bg-white rounded-2xl p-4 animate-pulse"},[...e[14]||(e[14]=[t("div",{class:"h-40 bg-gray-200 rounded-xl mb-3"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded w-3/4 mb-2"},null,-1),t("div",{class:"h-3 bg-gray-200 rounded w-1/2"},null,-1)])])),64))])):x.value.length>0?(r(),o("div",ge,[(r(!0),o(_,null,y(x.value,n=>(r(),o("div",{key:n.id,onClick:g=>J(n.id),class:"bg-white rounded-2xl shadow-sm overflow-hidden hover:shadow-md transition cursor-pointer"},[t("div",fe,[t("img",{src:n.cover_image_url||"https://images.unsplash.com/photo-1551632811-561732d1e306?w=800&h=400&fit=crop",alt:n.title,class:"w-full h-full object-cover"},null,8,me),t("div",ve,[t("span",{class:X(["px-3 py-1 rounded-full text-xs font-medium text-white",F(n.difficulty)])},l(q(n.difficulty)),3)])]),t("div",he,[t("h3",be,l(n.title),1),t("div",_e,[t("div",ye,[e[15]||(e[15]=t("span",null,"ðŸ“",-1)),t("span",null,l(n.location),1)]),t("div",we,[e[16]||(e[16]=t("span",null,"ðŸ•",-1)),t("span",null,l(P(n.start_time)),1)])]),t("div",ke,[t("div",je,[t("img",{src:n.creator.avatar_url||"/default-avatar.png",alt:n.creator.nickname,class:"w-6 h-6 rounded-full object-cover"},null,8,Ce),t("span",Se,l(n.creator.nickname),1)]),t("div",$e,[t("div",Ae,[e[17]||(e[17]=t("span",null,"ðŸ‘¥",-1)),t("span",null,l(n.participant_count||0)+"äºº",1)]),C(n)&&!n.is_joined?(r(),o("button",{key:0,onClick:g=>L(g,n.id),disabled:f.value===n.id,class:"px-3 py-1 bg-teal-500 text-white text-xs rounded-full hover:bg-teal-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition"},l(f.value===n.id?"åŠ å…¥ä¸­...":"åŠ å…¥"),9,Me)):C(n)?(r(),o("span",ze," å·²åŠ å…¥ ")):(r(),o("span",De,l(R(n)),1))])])])],8,pe))),128))])):(r(),o("div",He,[e[18]||(e[18]=t("div",{class:"text-6xl mb-3"},"ðŸ”ï¸",-1)),e[19]||(e[19]=t("p",{class:"text-gray-500 mb-4"},"æš‚æ— æŽ¨èæ´»åŠ¨",-1)),t("button",{onClick:e[4]||(e[4]=n=>c(u).push("/create-activity")),class:"px-6 py-2 bg-teal-500 text-white rounded-full text-sm hover:bg-teal-600 transition"}," å‘èµ·ç¬¬ä¸€ä¸ªæ´»åŠ¨ ")]))]),t("div",Ue,[t("div",Ne,[e[21]||(e[21]=t("h2",{class:"text-lg font-bold text-gray-800"},"ðŸ‘¥ æŽ¨èä¼™ä¼´",-1)),M(a,{to:"/discover",class:"text-sm text-teal-600 hover:text-teal-700"},{default:D(()=>[...e[20]||(e[20]=[z(" æŸ¥çœ‹æ›´å¤š ",-1)])]),_:1})]),t("div",Re,[(r(!0),o(_,null,y(h.value,n=>(r(),o("div",{key:n.id,onClick:g=>c(u).push(`/user/${n.id}`),class:"flex-shrink-0 bg-white rounded-2xl p-4 w-32 hover:shadow-md transition cursor-pointer"},[t("img",{src:n.avatar_url||"/default-avatar.png",alt:n.nickname,class:"w-16 h-16 rounded-full object-cover mx-auto mb-2"},null,8,Ve),t("p",Be,l(n.nickname),1),t("p",Je,l(E(n.hiking_level)),1)],8,Te))),128))])])])}}}),We=Z(Le,[["__scopeId","data-v-fe6b2bba"]]);export{We as default};
