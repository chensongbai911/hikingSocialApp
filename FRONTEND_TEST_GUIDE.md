# ğŸ§ª å‰ç«¯é›†æˆæµ‹è¯•æŒ‡å— - èŠå¤©åŠŸèƒ½éªŒè¯

## å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶
- âœ… åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆ115.190.252.62:3000ï¼‰
- âœ… å‰ç«¯å·²å¯åŠ¨ï¼ˆhttp://localhost:5173 æˆ– 115.190.252.62ï¼‰
- âœ… æœ‰æœ‰æ•ˆçš„ç”¨æˆ·è´¦å·å’ŒJWT token

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1ï¸âƒ£: éªŒè¯å¯¹è¯åˆ—è¡¨æ˜¾ç¤º

**é¢„æœŸç»“æœ**:
```
âœ… å¯¹è¯åˆ—è¡¨æ˜¾ç¤ºå¤šä¸ªå¯¹è¯
âœ… æ¯ä¸ªå¯¹è¯æ˜¾ç¤ºå¯¹æ–¹çš„æ˜µç§°ï¼ˆuser2.nicknameï¼‰
âœ… æ¯ä¸ªå¯¹è¯æ˜¾ç¤ºå¯¹æ–¹çš„å¤´åƒï¼ˆuser2.avatarUrlï¼‰
âœ… å¤´åƒèƒ½å¤Ÿæ­£ç¡®åŠ è½½å’Œæ˜¾ç¤º
```

**å‰ç«¯ä»£ç ä½ç½®**: [Messages.vue](frontend/src/components/pages/Messages.vue)

**éªŒè¯æ­¥éª¤**:
1. ç™»å½•åº”ç”¨
2. è¿›å…¥æ¶ˆæ¯é¡µé¢ï¼ˆMessagesï¼‰
3. è§‚å¯Ÿå¯¹è¯åˆ—è¡¨ï¼š
   - [ ] æ˜¾ç¤ºå¯¹è¯åˆ—è¡¨
   - [ ] æ¯ä¸ªå¯¹è¯æ˜¾ç¤ºå¯¹æ‰‹çš„æ˜µç§°
   - [ ] æ¯ä¸ªå¯¹è¯æ˜¾ç¤ºå¯¹æ‰‹çš„å¤´åƒï¼ˆDiceBear SVGï¼‰
   - [ ] å¤´åƒæ­£å¸¸åŠ è½½æ— 404

---

### åœºæ™¯ 2ï¸âƒ£: éªŒè¯æ¶ˆæ¯å†å²æ˜¾ç¤º

**é¢„æœŸç»“æœ**:
```
âœ… æ‰“å¼€å¯¹è¯åæ˜¾ç¤ºæ¶ˆæ¯å†å²
âœ… æ¯æ¡æ¶ˆæ¯æ˜¾ç¤ºå‘é€è€…ä¿¡æ¯
âœ… æ¯æ¡æ¶ˆæ¯æ˜¾ç¤ºå‘é€è€…çš„æ˜µç§°
âœ… æ¯æ¡æ¶ˆæ¯æ˜¾ç¤ºå‘é€è€…çš„å¤´åƒ
```

**APIè·¯å¾„**: `/api/v1/messages/conversations/{conversationId}`

**éªŒè¯æ­¥éª¤**:
1. åœ¨å¯¹è¯åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªå¯¹è¯
2. è§‚å¯Ÿæ¶ˆæ¯å†å²ï¼š
   - [ ] æ˜¾ç¤ºæ¶ˆæ¯åˆ—è¡¨
   - [ ] æ¯æ¡æ¶ˆæ¯æ˜¾ç¤ºå‘é€è€…çš„æ˜µç§°
   - [ ] æ¯æ¡æ¶ˆæ¯æ˜¾ç¤ºå‘é€è€…çš„å¤´åƒ
   - [ ] å¤´åƒèƒ½å¤Ÿæ­£ç¡®æ˜¾ç¤º

---

### åœºæ™¯ 3ï¸âƒ£: éªŒè¯é»˜è®¤å¤´åƒç”Ÿæˆ

**é¢„æœŸç»“æœ**:
```
âœ… æ–°ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨æœ‰å¤´åƒ
âœ… å¤´åƒURLä¸º https://api.dicebear.com/7.x/avataaars/svg?seed=user{userId}
âœ… å¤´åƒåœ¨æ‰€æœ‰é¡µé¢ä¸€è‡´æ˜¾ç¤º
```

**éªŒè¯æ­¥éª¤**:
1. æ³¨å†Œæ–°ç”¨æˆ·
2. è¿›å…¥ç”¨æˆ·èµ„æ–™é¡µé¢
3. æ£€æŸ¥ç”¨æˆ·å¤´åƒï¼š
   - [ ] æ˜¾ç¤ºäº†ä¸€ä¸ªSVGå¤´åƒ
   - [ ] å¤´åƒä¸æ˜¯ç©ºç™½æˆ–å ä½ç¬¦
   - [ ] åˆ·æ–°é¡µé¢åå¤´åƒä»ç„¶å­˜åœ¨

---

## ğŸ”§ è°ƒè¯•å‘½ä»¤

### æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—
```javascript
// åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æ‰§è¡Œ
localStorage.getItem('token')  // æŸ¥çœ‹ä¿å­˜çš„token
```

### æŸ¥çœ‹ç½‘ç»œè¯·æ±‚
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° Network æ ‡ç­¾
3. åˆ·æ–°é¡µé¢å¹¶æŸ¥çœ‹APIè¯·æ±‚ï¼š
   - `GET /api/v1/messages/conversations`
   - `GET /api/v1/messages/conversations/{id}`

### æ£€æŸ¥å“åº”æ•°æ®æ ¼å¼
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹å“åº”
fetch('http://115.190.252.62/api/v1/messages/conversations?page=1&limit=20', {
  headers: { 'Authorization': 'Bearer YOUR_TOKEN' }
})
.then(r => r.json())
.then(data => console.log(data))
```

---

## âœ… æ£€æŸ¥æ¸…å•

### å¯¹è¯åˆ—è¡¨éªŒè¯
- [ ] APIè¿”å› HTTP 200ï¼ˆå¦‚æœå·²è®¤è¯ï¼‰æˆ– 401ï¼ˆéœ€è¦tokenï¼‰
- [ ] å“åº”åŒ…å« `data.conversations` æ•°ç»„
- [ ] æ¯ä¸ªå¯¹è¯åŒ…å« `user2` å¯¹è±¡ï¼š
  - [ ] `user2.id` - å¯¹æ–¹ç”¨æˆ·ID
  - [ ] `user2.nickname` - å¯¹æ–¹æ˜µç§°
  - [ ] `user2.avatarUrl` - å¯¹æ–¹å¤´åƒURLï¼ˆåŒ…å«https://api.dicebear...ï¼‰
- [ ] å‰ç«¯æ­£ç¡®æ˜¾ç¤ºäº†å¯¹è¯åˆ—è¡¨å’Œå¯¹æ–¹å¤´åƒ

### æ¶ˆæ¯å†å²éªŒè¯
- [ ] APIè¿”å› HTTP 200ï¼ˆå¦‚æœå·²è®¤è¯ï¼‰
- [ ] å“åº”åŒ…å« `data.messages` æ•°ç»„
- [ ] æ¯æ¡æ¶ˆæ¯åŒ…å« `sender` å¯¹è±¡ï¼š
  - [ ] `sender.id` - å‘é€è€…ç”¨æˆ·ID
  - [ ] `sender.nickname` - å‘é€è€…æ˜µç§°
  - [ ] `sender.avatarUrl` - å‘é€è€…å¤´åƒURL
- [ ] å‰ç«¯æ­£ç¡®æ˜¾ç¤ºäº†æ¯æ¡æ¶ˆæ¯å’Œå‘é€è€…å¤´åƒ

### ç”¨æˆ·å¤´åƒéªŒè¯
- [ ] æ–°æ³¨å†Œç”¨æˆ·æœ‰ `avatar_url` å­—æ®µ
- [ ] `avatar_url` å€¼ä¸º `https://api.dicebear.com/7.x/avataaars/svg?seed=user{userId}`
- [ ] å¤´åƒURLèƒ½è¢«æ­£å¸¸è®¿é—®å’ŒåŠ è½½

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¸âƒ£: å¤´åƒæ˜¾ç¤ºä¸º404æˆ–æŸå

**åŸå› **: DiceBear API URLé”™è¯¯

**è§£å†³**:
1. æ£€æŸ¥æ•°æ®åº“ä¸­çš„ `avatar_url` æ ¼å¼
2. ç¡®ä¿URLæ ¼å¼: `https://api.dicebear.com/7.x/avataaars/svg?seed=user{userId}`
3. åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®è¯¥URLæµ‹è¯•

```bash
# æµ‹è¯•é»˜è®¤å¤´åƒURL
curl -I "https://api.dicebear.com/7.x/avataaars/svg?seed=user-001"
# åº”è¯¥è¿”å› HTTP 200ï¼ŒContent-Type: image/svg+xml
```

### é—®é¢˜ 2ï¸âƒ£: user2ä¿¡æ¯ä¸ºnull

**åŸå› **: æ¶ˆæ¯åˆ—è¡¨ä¸ºç©ºæˆ–æ•°æ®åº“æŸ¥è¯¢é—®é¢˜

**è§£å†³**:
1. æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦æœ‰å¯¹è¯æ•°æ®
2. ç¡®è®¤å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨å¯¹è¯ä¸­
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—: `pm2 logs hiking-app-backend`

### é—®é¢˜ 3ï¸âƒ£: å¯¹è¯åˆ—è¡¨ä¸ºç©º

**åŸå› **: ç”¨æˆ·æ²¡æœ‰å¯¹è¯æˆ–APIè¯·æ±‚å¤±è´¥

**è§£å†³**:
1. ç¡®ä¿ä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„JWT token
2. æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIç«¯ç‚¹
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

---

## ğŸ“Š APIå“åº”ç¤ºä¾‹

### å¯¹è¯åˆ—è¡¨å“åº”
```json
{
  "code": 0,
  "data": {
    "conversations": [
      {
        "id": 4,
        "userId1": "user-001",
        "userId2": "user-002",
        "lastMessageContent": "Hi there!",
        "lastMessageAt": "2026-01-17T10:30:00Z",
        "user1UnreadCount": 0,
        "user2UnreadCount": 2,
        "user1": {
          "id": "user-001",
          "nickname": "Current User",
          "avatarUrl": "https://api.dicebear.com/7.x/avataaars/svg?seed=useruser-001"
        },
        "user2": {
          "id": "user-002",
          "nickname": "Alice",
          "avatarUrl": "https://api.dicebear.com/7.x/avataaars/svg?seed=useruser-002"
        }
      }
    ],
    "total": 5,
    "totalPages": 1
  }
}
```

### æ¶ˆæ¯å†å²å“åº”
```json
{
  "code": 0,
  "data": {
    "messages": [
      {
        "id": 101,
        "conversationId": 4,
        "senderId": "user-003",
        "content": "Hello!",
        "contentType": "text",
        "isRead": true,
        "readAt": "2026-01-17T10:25:10Z",
        "createdAt": "2026-01-17T10:25:00Z",
        "sender": {
          "id": "user-003",
          "nickname": "Bob",
          "avatarUrl": "https://api.dicebear.com/7.x/avataaars/svg?seed=useruser-003"
        }
      }
    ],
    "total": 25,
    "totalPages": 1
  }
}
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœéªŒè¯ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹åç«¯æ—¥å¿—:
   ```bash
   ssh root@115.190.252.62 "pm2 logs hiking-app-backend --lines 50"
   ```

2. æ£€æŸ¥æ•°æ®åº“:
   ```bash
   ssh root@115.190.252.62 "mysql -u hiking_user -psenbochen hiking_social_db -e 'SELECT * FROM conversations LIMIT 5;'"
   ```

3. æµ‹è¯•APIç«¯ç‚¹:
   ```bash
   curl -H "Authorization: Bearer YOUR_TOKEN" \
     http://115.190.252.62/api/v1/messages/conversations
   ```

---

**æœ€åæ›´æ–°**: 2026-01-17
**ç‰ˆæœ¬**: 1.0
**çŠ¶æ€**: âœ… å·²å®Œæˆéƒ¨ç½²
