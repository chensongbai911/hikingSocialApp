# 🚀 地图功能快速启动指南

## ⚡ 一键启动

### Windows 用户

```bash
# 方式1：使用现有启动脚本
start_app.bat

# 方式2：手动启动
# 终端1 - 启动后端
cd backend
npm run dev

# 终端2 - 启动前端
cd frontend
npm run dev
```

### Mac/Linux 用户

```bash
# 方式1：使用启动脚本
./start_app.sh

# 方式2：手动启动
# 终端1
cd backend && npm run dev

# 终端2
cd frontend && npm run dev
```

---

## 🗺️ 测试地图功能

### 步骤 1：访问应用

打开浏览器访问：http://localhost:5173

### 步骤 2：进入创建活动

1. 登录应用（如果还没登录）
2. 点击底部导航的 "+" 按钮
3. 进入创建活动页面

### 步骤 3：打开地图选择器

1. 找到"活动地点"字段
2. 点击"选择目的地"
3. 在弹出的选择器中点击顶部的 **"地图找山 🗺️"** 卡片

### 步骤 4：体验地图功能

#### 查看标记点

- 🟢 绿色标记 = 简单难度（香山公园、奥森）
- 🟡 黄色标记 = 中等难度（凤凰岭、云蒙山等）
- 🔴 红色标记 = 困难难度（灵山）

#### 点击标记

- 点击任意山峰标记
- 地图会自动居中到该位置
- 底部弹出目的地详情卡片
- 查看目的地的照片、难度、距离等信息
- 点击"选择此目的地"按钮确认

#### 搜索地点

- 在底部搜索框输入"香山"或"凤凰岭"
- 地图会自动定位到搜索结果
- 显示"找到 X 个结果"提示

#### 定位功能

- 点击搜索框右侧的 📍 按钮
- 授权浏览器获取位置
- 地图会定位到你的当前位置
- 可以查看附近的徒步目的地

#### 切换视图

- 点击右上角的 "📝 列表" 按钮返回列表模式
- 再次点击 "地图找山" 重新进入地图模式

---

## 🧪 测试后端 API

### 快速测试

```bash
# 安装 axios（如果还没安装）
npm install axios

# 运行测试脚本
node test-destination-api.js
```

### 预期输出

```
========================================
🧪 目的地 API 测试
========================================

1️⃣ 测试：获取所有目的地
✅ 成功！共 8 个目的地
   前3个：香山公园, 凤凰岭自然风景区, 灵山

2️⃣ 测试：获取热门目的地
✅ 成功！热门目的地 TOP 5：
   1. 香山公园 - 人气分数 5000
   2. 凤凰岭自然风景区 - 人气分数 4500
   ...

3️⃣ 测试：获取附近目的地（北京坐标）
✅ 成功！50km 内找到 6 个目的地
   1. 香山公园 - 12.5km
   2. 奥林匹克森林公园 - 3.2km
   ...

========================================
✅ 所有测试通过！
========================================
```

---

## 📊 数据库验证

### 查看所有目的地

```bash
mysql -u root -psenbochen hiking_app -e "SELECT id, name, difficulty, popularity_score FROM destinations;"
```

### 查看表结构

```bash
mysql -u root -psenbochen hiking_app -e "DESCRIBE destinations;"
```

### 验证坐标数据

```bash
mysql -u root -psenbochen hiking_app -e "SELECT name, latitude, longitude FROM destinations WHERE latitude IS NOT NULL;"
```

---

## 🎯 功能检查清单

### 地图显示

- [ ] 地图正常加载
- [ ] 显示清新的 whitesmoke 风格
- [ ] 默认中心点为北京或用户位置
- [ ] 缩放级别合适（zoom=11）

### 标记点

- [ ] 显示 8 个目的地标记
- [ ] 标记颜色正确（绿/黄/红）
- [ ] 标记显示目的地名称
- [ ] 标记样式美观（山峰 emoji）

### 交互功能

- [ ] 点击标记显示详情
- [ ] 点击标记地图居中
- [ ] 详情卡片滑入动画流畅
- [ ] "选择此目的地"按钮有效

### 搜索功能

- [ ] 输入关键词触发搜索
- [ ] 搜索有防抖效果（500ms）
- [ ] 搜索结果自动定位
- [ ] 显示搜索结果提示

### 定位功能

- [ ] 点击定位按钮触发
- [ ] 请求浏览器位置权限
- [ ] 定位成功显示提示
- [ ] 地图居中到当前位置

### 模式切换

- [ ] 列表/地图切换正常
- [ ] 地图资源正确释放
- [ ] 重新进入地图正常初始化

---

## 🐛 常见问题

### 1. 地图不显示

**可能原因**：

- 高德地图 API key 失效
- 网络连接问题
- 浏览器控制台有错误

**解决方法**：

- 检查 `frontend/index.html` 中的 AMap 脚本标签
- 打开浏览器控制台查看错误信息
- 确认网络可以访问 `webapi.amap.com`

### 2. 标记点不显示

**可能原因**：

- 数据库没有目的地数据
- 坐标为空
- 地图还在初始化

**解决方法**：

```bash
# 重新初始化数据库
cd backend
npx tsx src/scripts/initDestinations.ts

# 验证数据
mysql -u root -psenbochen hiking_app -e "SELECT COUNT(*) FROM destinations WHERE latitude IS NOT NULL;"
```

### 3. 搜索无响应

**可能原因**：

- PlaceSearch 插件未加载
- 搜索关键词为空
- 网络问题

**解决方法**：

- 打开控制台检查插件加载状态
- 等待地图完全加载后再搜索
- 检查网络连接

### 4. 定位失败

**可能原因**：

- 浏览器拒绝位置权限
- 使用非 HTTPS 连接
- 定位服务不可用

**解决方法**：

- 授权浏览器获取位置
- 使用 localhost 或 HTTPS
- 检查浏览器设置

---

## 📚 相关文档

- [完整实现报告](./MAP_INTEGRATION_COMPLETE.md)
- [目的地功能文档](./DESTINATION_FEATURE_COMPLETE.md)
- [快速开始指南](./DESTINATION_QUICKSTART.md)

---

## 🎉 恭喜！

地图功能已完全集成并可用。现在你可以：

- 🗺️ 在地图上查看所有徒步目的地
- 🏔️ 点击标记查看详细信息
- 🔍 搜索感兴趣的地点
- 📍 定位到你的当前位置
- 🎨 享受美观流畅的用户体验

**立即开始体验吧！** 🚀
