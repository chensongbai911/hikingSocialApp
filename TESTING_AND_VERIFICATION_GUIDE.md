# 地点选择功能 + 新用户引导 - 测试和验证指南

## 🧪 测试环境设置

### 前置条件
- ✅ Node.js 18+ 已安装
- ✅ npm 或 yarn 可用
- ✅ 浏览器开发工具 (Chrome/Safari/Firefox)
- ✅ 网络连接正常
- ✅ GPS/定位权限可用 (仅地点定位测试)

---

## 🚀 快速启动

### 1. 开始开发服务器
```bash
cd /Users/chensongbai/Desktop/gigiigigi/hikingSocialApp

# 安装依赖 (如果还未安装)
npm install

# 启动前端开发服务器
cd frontend
npm run dev

# 输出应该显示:
# ➜  Local:   http://localhost:5173/
```

### 2. 启动后端服务
```bash
# 在另一个终端
cd backend
npm run dev

# 输出应该显示:
# Server is running on http://localhost:3000
```

---

## 📝 测试场景

### 场景 1: 新用户完整注册登录流程 ✅

#### 步骤
1. 打开浏览器 http://localhost:5173
2. 点击"注册"链接或直接访问 `/register`
3. 填写注册表单:
   - 邮箱: `test@example.com`
   - 昵称: `徒步爱好者`
   - 密码: `Password123`
4. 点击"注册"按钮

#### 第一次验证 - 注册成功
- ✅ 显示 "注册成功！即将跳转到登录页面" 的 Toast 通知
- ✅ 等待 1.5 秒后自动跳转到 `/login`
- ✅ 邮箱字段自动填充已注册的邮箱

#### 第二步 - 登录
1. 登录页面的邮箱已自动填充
2. 输入刚才注册的密码
3. 点击"登录"按钮

#### 第二次验证 - 登录成功后跳转到引导页
- ✅ 显示 "登录成功" 的 Toast 通知
- ✅ 自动跳转到 `/user-guide` (因为是新用户)
- ✅ 进入新用户引导页面

#### 验证点
```
□ 注册成功后跳转到登录页，不是直接引导页
□ 登录页邮箱字段自动填充
□ 登录成功后自动跳转到引导页
□ 页面平滑过渡动画
□ 步骤指示器显示 "1. 基本信息"
□ 不会出现 JavaScript 错误 (检查控制台)
```

---

### 场景 2: 引导页面 - 步骤 1 (基本信息) ✅

#### 步骤
1. 在引导页面，查看第一步
2. 填写表单:
   - 昵称: `张三` (观察字符计数变化)
   - 年龄: 选择 `25岁`
   - 性别: 选择 `男`
   - 简介: `喜欢登山和露营` (可选，观察字符计数)
3. 点击"继续 →"按钮

#### 预期结果
- ✅ 字符计数实时更新
- ✅ 尼称必填，年龄必填，性别必填
- ✅ 简介为可选字段
- ✅ 在所有必填字段填写后，"继续"按钮变为可点击状态
- ✅ 点击后进入步骤 2

#### 验证点
```
□ 清除昵称后，按钮变为灰色不可点击
□ 字符计数显示正确 (如: 3/20)
□ 下拉菜单选项完整 (18-87 岁)
□ 没有垂直滚动问题
```

---

### 场景 3: 引导页面 - 步骤 2 (头像上传) ✅

#### 步骤
1. 在步骤 2，查看头像上传界面
2. 点击"📁 选择图片"按钮
3. 选择一个本地图片文件 (JPG/PNG, <5MB)
4. 确认图片预览显示
5. 点击"继续 →"按钮

#### 预期结果
- ✅ 文件选择对话框打开
- ✅ 选择图片后显示预览
- ✅ 预览尺寸为 132x132px 圆形
- ✅ 图片正确裁剪显示
- ✅ 头像为可选，可以跳过继续

#### 验证点
```
□ 预览圆形容器边界清晰
□ 预览图像裁剪得当
□ 大文件选择会显示错误提示 "图片大小不能超过 5MB"
□ 不支持的格式会被文件选择器过滤
□ 没有选择图片也能点击"继续"
```

---

### 场景 4: 引导页面 - 步骤 3 (徒步偏好) ✅

#### 步骤
1. 在步骤 3，查看偏好选择界面
2. 点击难度等级:
   - 点击"入门"(绿色)
   - 取消并点击"中等"(黄色)
3. 选择兴趣标签 (点击至少 2 个):
   - 点击"周末出发"
   - 点击"自然风景"
   - 点击"摄影"
4. 观察验证提示
5. 点击"继续 →"按钮

#### 预期结果
- ✅ 难度按钮切换正确的颜色
- ✅ 只能选择一个难度等级
- ✅ 兴趣标签显示颜色变化
- ✅ 选择少于 2 个标签时显示警告 "请至少选择 2 个偏好"
- ✅ 选择超过 5 个标签时显示提示 "最多选择 5 个偏好"
- ✅ 选择 2-5 个标签后可点击"继续"

#### 验证点
```
□ 难度选择互斥 (同时只有一个高亮)
□ 标签最多 5 个限制生效
□ 警告提示正确显示和隐藏
□ 标签字体和颜色清晰可见
□ 标签按钮悬停效果正常
```

---

### 场景 5: 引导页面 - 步骤 4 (完成确认) ✅

#### 步骤
1. 在步骤 4，查看完成页面
2. 验证信息摘要卡片显示所有信息:
   - 昵称
   - 年龄
   - 性别
   - 偏好 (难度 + 标签)
3. 观察庆祝图标动画
4. 点击"✓ 完成"按钮

#### 预期结果
- ✅ 显示 🎉 庆祝图标带动画
- ✅ 信息摘要卡片显示正确
- ✅ 所有步骤指示器都是青色(完成状态)
- ✅ 点击完成后跳转到发现页 (`/discover`)
- ✅ 显示 "✓ 引导完成！" 的 Toast 通知

#### 验证点
```
□ 信息显示无格式错误
□ 性别显示为中文 (男/女/其他)
□ 偏好显示为用"、"分隔的列表
□ 庆祝图标有脉冲动画
□ 跳转到发现页后没有闪烁
□ 没有 404 或路由错误
```

---

### 场景 6: 引导页面 - "上一步"导航 ✅

#### 步骤
1. 在步骤 3，点击"上一步"按钮
2. 验证回到步骤 2
3. 继续点击"上一步"返回步骤 1
4. 在步骤 1 再点击"上一步"

#### 预期结果
- ✅ 每点击一次回到前一个步骤
- ✅ 步骤指示器更新
- ✅ 内容区域动画切换
- ✅ 在步骤 1 时不显示"上一步"按钮 (没有更前的步骤)
- ✅ 所有表单数据保持

#### 验证点
```
□ 步骤指示器同步更新
□ 内容平滑淡入淡出
□ 表单值不丢失 (返回后数据仍在)
□ 没有错误或 JavaScript 警告
```

---

### 场景 7: 引导页面 - "跳过引导" ✅

#### 步骤
1. 在步骤 1 或 2，点击"跳过引导"按钮
2. 验证跳转

#### 预期结果
- ✅ 显示 "已跳过引导" 的 Toast 通知
- ✅ 立即跳转到发现页 (`/discover`)
- ✅ 不保存任何引导数据

#### 验证点
```
□ 不出现警告确认对话框 (或根据需求添加)
□ 跳转流畅
□ 用户不丢失登录状态
```

---

### 场景 8: 地点选择 - 定位功能 📍

#### 步骤
1. 登录已有账号或完成新用户引导
2. 进入"创建活动"页面
3. 在地点选择器中，点击"📍 定位到我的位置"按钮
4. 浏览器询问定位权限时，选择"允许"

#### 预期结果
- ✅ 按钮显示加载状态
- ✅ 2-5 秒内地图移动到当前位置
- ✅ 显示"📍 定位成功" Toast 通知
- ✅ 选中位置更新为当前位置

#### 错误场景预期
- ✅ 如果用户拒绝权限，显示"❌ 定位失败: 用户拒绝定位"
- ✅ 如果网络无效，显示"❌ 定位出错: 网络错误"
- ✅ 如果 15 秒无响应，自动恢复按钮状态

#### 验证点
```
□ 按钮在定位过程中显示禁用状态
□ 地图平滑移动到新位置
□ 位置信息卡片更新
□ Toast 消息清晰可见
□ 没有控制台错误
□ 错误提示准确
```

---

### 场景 9: 地点选择 - 搜索功能 🔍

#### 步骤 A: 地图模式搜索
1. 在地点选择器地图模式
2. 在搜索框输入位置名称，例如:"天安门"
3. 观察搜索结果下拉框
4. 点击一个搜索结果

#### 预期结果
- ✅ 输入时显示最多 10 个结果
- ✅ 每个结果显示:
  - 📍 位置名称 (粗体)
  - 📌 详细地址 (灰色小字)
- ✅ 搜索框有清除按钮 (✕)
- ✅ 点击结果后，地图移动到该位置
- ✅ 下拉框自动隐藏
- ✅ 已选位置卡片更新

#### 验证点
```
□ 下拉框显示位置最多 10 条
□ 地址信息准确完整
□ 清除按钮功能正常 (一键清空搜索框)
□ 选择结果后下拉框隐藏
□ 地图平滑过渡
□ 没有重复或无关结果
```

#### 步骤 B: 列表模式搜索
1. 在地点选择器列表模式
2. 在搜索框输入地点名称
3. 观察下拉建议

#### 预期结果
- ✅ 显示最多 8 个匹配的目的地
- ✅ 每个建议显示:
  - 🖼️ 目的地缩略图
  - 名称
  - 📍 位置
- ✅ 有清除按钮 (✕)
- ✅ 点击建议项目后选中

#### 验证点
```
□ 缩略图显示正确
□ 模糊搜索工作正常 (不需要精确匹配)
□ 最多显示 8 项
□ 点击后自动关闭建议框
```

---

### 场景 10: 地点选择 - 已选位置卡片 💳

#### 步骤
1. 任何方式选中位置 (搜索、地图、定位)
2. 滚动到页面底部

#### 预期结果
- ✅ 卡片显示:
  - ✓ 勾选图标
  - 位置名称 (粗体)
  - 📍 完整地址
- ✅ 背景为渐变色 (teal-50 → emerald-50)
- ✅ 有两个按钮:
  - "取消选择" 按钮
  - "确认选择" 按钮
- ✅ 底部有足够的 padding (特别是在移动设备)
- ✅ 按钮宽度完全占满卡片

#### 验证点
```
□ 渐变背景显示清晰
□ 没有文字截断或溢出
□ 底部 padding 足够 (env(safe-area-inset-bottom) 正确)
□ 按钮可点击且反馈清晰
□ 在 iPhone 等刘海屏设备测试
□ 在 Android 设备测试
```

---

### 场景 11: 移动设备自适应 📱

#### 步骤
1. 使用 Chrome 开发工具的设备模拟器
2. 选择不同设备:
   - iPhone 12 (390x844)
   - iPhone SE (375x667)
   - Pixel 5 (393x851)
   - iPad (1024x1366)

#### 预期结果
- ✅ 所有内容正确显示
- ✅ 文字大小适当
- ✅ 按钮可轻松点击
- ✅ 没有水平滚动条
- ✅ 底部导航不被遮挡

#### 验证点 (每个设备)
```
□ 没有文字截断
□ 按钮边距适当
□ 下拉框定位准确
□ 图片显示清晰
□ 没有布局抖动
```

---

## 🔍 浏览器开发工具检查

### 检查清单

#### 1. 控制台 (Console)
```
□ 没有红色错误消息
□ 没有黄色警告 (除非是已知的)
□ 没有"undefined is not an object"
□ 没有路由相关错误
```

#### 2. 网络 (Network)
```
□ 所有请求返回 200 或 304
□ 没有 404 错误
□ JS 和 CSS 文件加载成功
□ API 调用成功
□ 加载时间在可接受范围内 (<2s)
```

#### 3. 应用 (Application)
```
□ LocalStorage 数据正确保存
□ SessionStorage 没有异常
□ Cookies 有效
□ Service Worker (如果有) 正常注册
```

#### 4. 性能 (Performance)
```
□ 首页加载时间 <3s
□ 引导页面切换流畅 >60fps
□ 没有布局抖动
□ 动画播放顺畅
```

---

## ✅ 完整的功能检查清单

### 新用户引导流程
- [ ] 步骤 1 - 基本信息表单验证和导航
- [ ] 步骤 2 - 头像上传和预览
- [ ] 步骤 3 - 偏好选择和限制
- [ ] 步骤 4 - 完成确认和跳转
- [ ] "上一步"按钮正常工作
- [ ] "跳过引导"按钮正常工作
- [ ] 步骤指示器同步更新
- [ ] 背景动画流畅
- [ ] 页面过渡动画完整
- [ ] 所有 Toast 通知正确显示

### 地点选择功能
- [ ] 定位按钮成功定位
- [ ] 定位错误处理和提示
- [ ] 定位超时恢复
- [ ] 地图模式搜索显示结果
- [ ] 列表模式搜索显示建议
- [ ] 搜索结果下拉框显示和隐藏
- [ ] 清除按钮功能
- [ ] 已选位置卡片显示
- [ ] 底部 padding 正确
- [ ] 地图移动平滑

### 性能和兼容性
- [ ] 移动设备 (iOS) 正常
- [ ] 移动设备 (Android) 正常
- [ ] 平板设备正常
- [ ] 桌面浏览器正常
- [ ] 没有控制台错误
- [ ] 没有网络错误
- [ ] 动画帧率 >60fps
- [ ] 加载时间 <3s

---

## 🐛 问题报告模板

如果发现问题，请按以下格式报告:

```
标题: [简要描述问题]

设备/浏览器:
- 设备: iPhone 12 / Android 12 / MacBook Pro
- 浏览器: Chrome 120 / Safari 17 / Firefox 121
- 屏幕尺寸: 390x844

步骤:
1. [第一步]
2. [第二步]
3. [第三步]

预期结果:
[应该发生什么]

实际结果:
[实际发生了什么]

截图/视频:
[如果可能请附加]

控制台错误:
[粘贴任何错误信息]
```

---

## 📋 部署前检查清单

```
发布前确保完成:

代码质量:
- [ ] 所有 TypeScript 编译错误已修复
- [ ] 所有 ESLint 警告已解决
- [ ] 代码风格一致
- [ ] 注释清晰完整

功能完整性:
- [ ] 所有 6 个需求都已实现
- [ ] 所有 11 个测试场景都已验证
- [ ] 没有功能回归
- [ ] 性能满足要求

文档:
- [ ] 用户指南已编写
- [ ] API 文档已更新
- [ ] 部署说明已记录
- [ ] 更新日志已记录

安全性:
- [ ] 输入验证正确
- [ ] XSS 防护有效
- [ ] CSRF 保护完整
- [ ] 敏感数据处理安全

数据库:
- [ ] 迁移脚本已准备
- [ ] 数据库备份已进行
- [ ] 回滚计划已制定
- [ ] 测试数据已清理
```

---

## 📞 技术支持

### 常见问题

**Q: 定位一直显示失败?**
A:
- 检查浏览器是否请求了定位权限
- 检查浏览器设置 → 隐私 → 位置服务
- 在 HTTPS 或 localhost 上运行
- 检查网络连接

**Q: 搜索下拉框不显示?**
A:
- 检查高德地图 API key 是否有效
- 检查网络请求是否成功 (F12 → Network)
- 检查搜索词是否返回结果
- 检查浏览器是否支持该功能

**Q: 头像上传失败?**
A:
- 检查文件大小是否 <5MB
- 检查文件格式是否为 JPG/PNG
- 检查浏览器是否支持 FileReader API
- 检查内存是否充足

**Q: 页面加载缓慢?**
A:
- 在 Network 标签检查具体是哪个请求慢
- 清除浏览器缓存
- 检查网络连接速度
- 考虑使用 CDN

---

## 🎉 测试完成后

1. 记录所有测试结果
2. 修复发现的任何问题
3. 再次进行完整测试
4. 获得产品经理批准
5. 合并到主分支
6. 打标签版本 (例如 v1.3.0)
7. 部署到生产环境
8. 监控用户反馈

---

**文档版本**: 1.0
**最后更新**: 2026-01-17
**维护者**: 开发团队
