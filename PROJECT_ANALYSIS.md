# 项目功能闭环分析报告

经过对代码库的深度分析，发现当前项目在“活动发布”、“图片上传”、“申请管理”等核心链路存在多处断点（未闭环）。以下是详细的问题清单及修复建议。

## 1. 核心功能阻断 (Critical)

这些问题会导致功能完全不可用或系统报错。

### 1.1 图片上传链路未闭环
- **现象**: 在创建活动页面 (`CreateActivity.vue`)，用户选择图片后，前端将其转换为 Base64 字符串 (DataURL) 并直接作为 `cover_image_url` 发送给后端。
- **原因**: 后端数据库 `activities` 表中 `cover_image_url` 字段限制为 `VARCHAR(500)`。Base64 图片数据通常远超此长度（几百KB到几MB），导致数据库写入失败或被截断。
- **修复方案**:
  1. 后端需要提供文件上传接口 (如 `/api/upload`)。
  2. 前端应先调用上传接口，获取返回的图片 URL。
  3. 前端将图片 URL 提交给创建活动接口。

### 1.2 活动编辑功能缺失
- **现象**: `CreateActivity.vue` 模板中包含“编辑活动”的文案，但 Script 部分**完全缺失**编辑模式的逻辑。
- **具体缺失**:
  - 缺少 `isEditMode` 和 `activityId` 变量定义。
  - 缺少 `onMounted` 钩子来从 URL 获取 `id` 并加载原有活动数据。
  - `editActivity` 路由跳转虽然存在 (`/create-activity?id=xxx`)，但页面无法回显数据。
- **修复方案**: 补充 `CreateActivity.vue` 中的编辑逻辑，实现数据回显和更新接口调用。

### 1.3 “查看申请” 路由 404
- **现象**: “我的徒步”页面中，点击“查看申请”按钮跳转至 `/activity/:id/applicants`。
- **原因**: 前端路由文件 `router/index.ts` 中**不存在**该路由定义。
- **修复方案**:
  1. 新增路由 `/activity/:id/applicants`。
  2. 创建对应的页面组件 `ActivityApplicants.vue`。

## 2. 业务逻辑缺失 (Major)

这些问题意味着功能虽然表面存在，但实际业务流程不通。

### 2.1 报名审核流程数据库不支持
- **现象**: PRD 要求活动发布者可以“查看申请”并审核。
- **原因**: 数据库 `participations` 表的 `status` 字段仅支持 `'joined', 'completed', 'cancelled'`，**缺少 `'pending'` (待审核)** 状态。这意味着用户点击报名后，系统只能直接算作“已加入”，无法实现“申请-审核”流程。
- **修复方案**:
  1. 修改数据库 `participations` 表，增加 `pending` 状态。
  2. 后端增加“同意/拒绝”申请的 API。

### 2.2 前端数据展示硬编码
- **现象**: “我的徒步”页面 (`MyHiking.vue`) 即使后端返回了参与者数据，前端在 `transformActivity` 函数中也强制将 `participants` 和 `applicants` 设为 **空数组 `[]`** (第 351-352 行)。
- **后果**: 用户永远无法在列表中看到谁参加了活动，也看不到有多少人申请。
- **修复方案**: 移除硬编码，正确映射后端返回的用户数据。

## 3. 待办事项与未完成功能 (Minor)

代码中明确标记为 TODO 或功能入口存在但无响应。

- **隐私设置**: `PrivacySettings.vue` 中存在大量 TODO，未连接 API（保存设置、黑名单管理）。
- **分享功能**: 活动详情页的“微信分享”、“朋友圈”功能未实现。
- **消息中心**: `MessageCenter.vue` 使用伪造数据，未对接真实消息 API。
- **个人资料**: 设置页面路由缺失，部分用户偏好数据硬编码。

## 4. 总结

目前项目处于**半成品状态**。核心的“发布-报名-审核”闭环在数据库层、API层和前端逻辑层均有断裂。建议优先修复 **1.1 图片上传** 和 **1.2 编辑功能**，并修正 **2.1 数据库Schema** 以支持审核流程。
